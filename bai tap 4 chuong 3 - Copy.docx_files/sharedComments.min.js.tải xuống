(window.wordOnlineExpChunks=window.wordOnlineExpChunks||[]).push([[416],{1e3:function(e,t,n){var a=n(643)("wks"),o=n(642),r=n(374).Symbol,i="function"==typeof r;(e.exports=function(e){return a[e]||(a[e]=i&&r[e]||(i?r:o)("Symbol."+e))}).store=a},1001:function(e,t,n){var a=n(994),o=n(644),r=n(1002),i=n(998),s=n(1653);e.exports=function(e,t){var n=1==e,d=2==e,c=3==e,l=4==e,m=6==e,u=5==e||m,p=t||s;return function(t,s,f){for(var g,h,C=r(t),v=o(C),b=a(s,f,3),y=i(v.length),T=0,I=n?p(t,y):d?p(t,0):void 0;y>T;T++)if((u||T in v)&&(h=b(g=v[T],T,C),e))if(n)I[T]=h;else if(h)switch(e){case 3:return!0;case 5:return g;case 6:return T;case 2:I.push(g)}else if(l)return!1;return m?-1:c||l?l:I}}},1002:function(e,t,n){var a=n(645);e.exports=function(e){return Object(a(e))}},1638:function(e,t,n){n(1639),e.exports=n(236).Array.includes},1639:function(e,t,n){"use strict";var a=n(373),o=n(995)(!0);a(a.P,"Array",{includes:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),n(646)("includes")},1640:function(e,t,n){var a=n(1641),o=n(1642),r=n(1644),i=Object.defineProperty;t.f=n(471)?Object.defineProperty:function(e,t,n){if(a(e),t=r(t,!0),a(n),o)try{return i(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},1641:function(e,t,n){var a=n(470);e.exports=function(e){if(!a(e))throw TypeError(e+" is not an object!");return e}},1642:function(e,t,n){e.exports=!n(471)&&!n(472)((function(){return 7!=Object.defineProperty(n(1643)("div"),"a",{get:function(){return 7}}).a}))},1643:function(e,t,n){var a=n(470),o=n(374).document,r=a(o)&&a(o.createElement);e.exports=function(e){return r?o.createElement(e):{}}},1644:function(e,t,n){var a=n(470);e.exports=function(e,t){if(!a(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!a(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!a(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!a(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},1645:function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},1646:function(e,t,n){var a=n(374),o=n(641),r=n(993),i=n(642)("src"),s=n(1647),d=(""+s).split("toString");n(236).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,n,s){var c="function"==typeof n;c&&(r(n,"name")||o(n,"name",t)),e[t]!==n&&(c&&(r(n,i)||o(n,i,e[t]?""+e[t]:d.join(String(t)))),e===a?e[t]=n:s?e[t]?e[t]=n:o(e,t,n):(delete e[t],o(e,t,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[i]||s.call(this)}))},1647:function(e,t,n){e.exports=n(643)("native-function-to-string",Function.toString)},1648:function(e,t){e.exports=!1},1649:function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},1650:function(e,t,n){var a=n(999),o=Math.max,r=Math.min;e.exports=function(e,t){return(e=a(e))<0?o(e+t,0):r(e,t)}},1651:function(e,t,n){n(1652),e.exports=n(236).Array.find},1652:function(e,t,n){"use strict";var a=n(373),o=n(1001)(5),r=!0;"find"in[]&&Array(1).find((function(){r=!1})),a(a.P+a.F*r,"Array",{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),n(646)("find")},1653:function(e,t,n){var a=n(1654);e.exports=function(e,t){return new(a(e))(t)}},1654:function(e,t,n){var a=n(470),o=n(1655),r=n(1e3)("species");e.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)||(t=void 0),a(t)&&null===(t=t[r])&&(t=void 0)),void 0===t?Array:t}},1655:function(e,t,n){var a=n(997);e.exports=Array.isArray||function(e){return"Array"==a(e)}},1656:function(e,t,n){n(1657),e.exports=n(236).String.trimRight},1657:function(e,t,n){"use strict";n(1658)("trimRight",(function(e){return function(){return e(this,2)}}),"trimEnd")},1658:function(e,t,n){var a=n(373),o=n(645),r=n(472),i=n(1659),s="["+i+"]",d=RegExp("^"+s+s+"*"),c=RegExp(s+s+"*$"),l=function(e,t,n){var o={},s=r((function(){return!!i[e]()||"​"!="​"[e]()})),d=o[e]=s?t(m):i[e];n&&(o[n]=d),a(a.P+a.F*s,"String",o)},m=l.trim=function(e,t){return e=String(o(e)),1&t&&(e=e.replace(d,"")),2&t&&(e=e.replace(c,"")),e};e.exports=l},1659:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},1660:function(e,t,n){n(1661),e.exports=n(236).Array.findIndex},1661:function(e,t,n){"use strict";var a=n(373),o=n(1001)(6),r="findIndex",i=!0;r in[]&&Array(1)[r]((function(){i=!1})),a(a.P+a.F*i,"Array",{findIndex:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),n(646)(r)},1662:function(e,t,n){n(1663),e.exports=n(236).Object.assign},1663:function(e,t,n){var a=n(373);a(a.S+a.F,"Object",{assign:n(1664)})},1664:function(e,t,n){"use strict";var a=n(471),o=n(1665),r=n(1669),i=n(1670),s=n(1002),d=n(644),c=Object.assign;e.exports=!c||n(472)((function(){var e={},t={},n=Symbol(),a="abcdefghijklmnopqrst";return e[n]=7,a.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=a}))?function(e,t){for(var n=s(e),c=arguments.length,l=1,m=r.f,u=i.f;c>l;)for(var p,f=d(arguments[l++]),g=m?o(f).concat(m(f)):o(f),h=g.length,C=0;h>C;)p=g[C++],a&&!u.call(f,p)||(n[p]=f[p]);return n}:c},1665:function(e,t,n){var a=n(1666),o=n(1668);e.exports=Object.keys||function(e){return a(e,o)}},1666:function(e,t,n){var a=n(993),o=n(996),r=n(995)(!1),i=n(1667)("IE_PROTO");e.exports=function(e,t){var n,s=o(e),d=0,c=[];for(n in s)n!=i&&a(s,n)&&c.push(n);for(;t.length>d;)a(s,n=t[d++])&&(~r(c,n)||c.push(n));return c}},1667:function(e,t,n){var a=n(643)("keys"),o=n(642);e.exports=function(e){return a[e]||(a[e]=o(e))}},1668:function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},1669:function(e,t){t.f=Object.getOwnPropertySymbols},1670:function(e,t){t.f={}.propertyIsEnumerable},236:function(e,t){var n=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},2902:function(e,t,n){"use strict";n.r(t),n.d(t,"initializeRuntime",(function(){return ie})),n.d(t,"instantiate",(function(){return Oo})),n.d(t,"setWebpackPublicPath",(function(){return o.a})),n.d(t,"setDarkModeColorHandler",(function(){return _o})),n.d(t,"ScreenReaderNotifierManagerFactoryGlobal",(function(){return K.a})),n.d(t,"RichContentEditAPIFactoryGlobal",(function(){return f.a}));var a=n(5),o=n(279);n(1638),n(1651),n(1656);var r=n(222);n(378);var i=n(278),s=n(15),d=n(2832),c=n(507),l=n(18),m=n(1363),u=(n(379),n(243)),p=n(80),f=(n(1660),n(1662),n(326)),g=n(513),h=n(268),C=n(328),v=n(719),b=n(19),y=function(){function e(){this._listeners=[]}return e.prototype.add=function(e){this._listeners.push(e)},e.prototype.remove=function(e){var t=this._listeners.indexOf(e);t>=-1&&this._listeners.splice(t,1)},Object.defineProperty(e.prototype,"invoke",{get:function(){var e=this;return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._listeners.forEach((function(e){return e.apply(void 0,Object(a.__spreadArray)([],Object(a.__read)(t),!1))}))}},enumerable:!1,configurable:!0}),e}(),T=function(){function e(){var e=this;this.changedEvent=new y,this.fireEvent=function(t){e.changedEvent.invoke(t)}}return e.prototype.registerForViewContainerEvents=function(e){this.changedEvent.add(e)},e.prototype.unregisterForViewContainerEvents=function(e){this.changedEvent.remove(e)},e}(),I=function(){function e(e,t,n){this.viewContainerBase=e,this.containerType=e.containerType,this.onReadyToRender=e.onReadyToRender,this.onReadyToRender&&(this.onReadyToRender=this.onReadyToRender.bind(e)),this.invokeModalConfirmationDialog=e.invokeModalConfirmationDialog,this.invokeModalConfirmationDialog&&(this.invokeModalConfirmationDialog=this.invokeModalConfirmationDialog.bind(e)),this.setDisplayConfiguration=e.setDisplayConfiguration,this.setDisplayConfiguration&&(this.setDisplayConfiguration=this.setDisplayConfiguration.bind(e)),this.closeView=e.closeView.bind(e),this.identifier=e.identifier}return e.prototype.openView=function(){this.viewContainerBase.openView&&this.viewContainerBase.openView()},e.prototype.moveFocusToCanvas_donotuse=function(){this.viewContainerBase.moveFocusToCanvas_donotuse&&this.viewContainerBase.moveFocusToCanvas_donotuse()},e}(),O=n(4),_=n(30),S=n(66),j=n(92);function k(e,t){return"".concat(e,"-").concat(t)}var x,E=n(192),D=n(168),A=n(468);!function(e){e[e.Invalid=0]="Invalid",e[e.DataReceived=1]="DataReceived"}(x||(x={}));var w={sendCodeMarker:function(e){},onStartEvent:new A.EventImpl((function(){})),onStopEvent:new A.EventImpl((function(){}))},P=function(e){this.onMockUIAction=new A.EventImpl((function(){}))},R=n(649),V=n(266),F=n(478),N=n(74),M=function(e,t){var n=this;this.commentViewManager=e,this.correlationId=t,this.visit=function(e){e.attachContext(n.commentViewManager.apiContext),n.correlationId&&e.addDataField("InstanceCorrelationId",n.correlationId,l.d.SystemMetadata)}};function L(e){return new M(U(e),e.correlationId)}var H=function(){throw new Error("ViewManagerFactory not set")},U=H;var B=new(function(){function e(){this.instanceMap=new Map,this.initialized=!1}return e.prototype.getTelemetryVisitor=function(e){var t=this;return this.instanceMap.get(e)||{visit:function(n){var a=t.instanceMap.get(e);if(!a)return n.attachContext(e),void n.addDataField("MissingInstanceTelemetry",!0,l.d.SystemMetadata);a.visit(n)}}},e.prototype.closeViewManager=function(e){var t=this.instanceMap.get(e);t&&(t.commentViewManager.teardown(),this.instanceMap.delete(e))},e.prototype.disposeViewManager=function(){var e=this;this.instanceMap.forEach((function(t,n){Object(D.e)(n),e.closeViewManager(n)}))},e.prototype.doesViewManagerExist=function(e){return this.instanceMap.has(e)},e.prototype.ensureViewManager=function(e){var t=e.apiContext,n=e.displayMode,a=e.contentNavigationAPIMockSettings,o=e.contentFilteredRangeHostAPIMockSettings;this.initialized||this.ensureInitialized();var r=this.instanceMap.get(t);return r?this.updateInstanceObject(r,n):(this.initializeContentNavigationAPI(t,a),this.initializeContentFilteredRangeAPI(t,o),r=L(e),this.instanceMap.set(t,r)),r.commentViewManager},e.prototype.getCorrelationId=function(e){var t=this.instanceMap.get(e);return t&&t.correlationId},e.prototype.getStore=function(e){var t=this.instanceMap.get(e);if(!t)throw new N.a("Instance is not initialized",s.d.reserveTag(589103622),-2130957512);return t.commentViewManager.getCommentStore()},e.prototype.getViewManager=function(e){var t=this.tryGetViewManager(e);if(!t)throw new N.a("Instance is not initialized",s.d.reserveTag(589103623),-2130957512);return t},e.prototype.tryGetViewManager=function(e){var t;return null===(t=this.instanceMap.get(e))||void 0===t?void 0:t.commentViewManager},e.prototype.ensureInitialized=function(){var e=this;b.t()&&w.onStartEvent.subscribe((function(t){e.initializeContentNavigationAPI(t.context,void 0),e.initializeContentFilteredRangeAPI(t.context,void 0),e.initializeViewManager(t.context,t.correlationId,t.useMockMode)})),w.onStopEvent.subscribe((function(t){e.closeViewManager(t.context),Object(D.e)(t.context)})),this.initialized=!0},e.prototype.initializeViewManager=function(e,t,n){var a=this.instanceMap.get(e);if(a)a.correlationId=t;else{var o=void 0;n&&b.p()&&(Object(l.k)().createActivityObject("OnMockUIDriverCreated",this.getTelemetryVisitor(e),Object(l.n)({diagnosticLevel:l.b.FullEvent})).successTag(592511450),o=new P(e)),this.instanceMap.set(e,L({apiContext:e,correlationId:t,initializationReason:F.a.PaneOpen,displayMode:V.b.FullPane,foldableLayoutState:R.a.Indeterminate,paneVisible:!1,initializeImmediately:!0,mockDriver:o}))}},e.prototype.updateInstanceObject=function(e,t){var n=e.commentViewManager.viewProvider;n.getViewContainer().containerType!==t&&n.changeViewContainerType(t)},e.prototype.initializeContentNavigationAPI=function(e,t){if(!Object(D.g)(e)){if(t)return void(t.useMock&&Object(D.h)(t.mock,e));var n=new D.b(e);n.isAPIEnabled()&&Object(D.h)(n,e)}},e.prototype.initializeContentFilteredRangeAPI=function(e,t){if(!Object(E.f)(e)){if(t)return void(t.useMock&&Object(E.g)(e,t.mock));Object(E.g)(e,new E.b(e))}},e}()),z=n(151),W=n(476),G=function(){function e(e,t,n){var a=this;this.viewContainerBase=e,this.context=t,this.viewContainerProvider=n,this.rootNode=null,this.lastRenderFailed=!1,this.processVisibilityEvent=function(e){switch(e.viewContainerVisibilityState){case z.a.Visible:a.viewContainerBase.identifier?a.rootNode=document.getElementById(a.viewContainerBase.identifier):Object(l.k)().assertConditionTag(!1,"View container base identifier expected",558401364),a.providerPromise.then((function(e){a.renderIntoView(e)})).catch(Object(j.a)(s.d.reserveTag(558401365)));break;case z.a.Closed:a.viewContainerBase.identifier&&a.rootNode&&(Object(_.unmountComponentAtNode)(a.rootNode),a.rootNode=null);break;case z.a.Hidden:Object(l.k)().assertConditionTag(!1,"ViewContainerVisibilityState.Hidden is not currently supported for web.",558401366);break;default:Object(s.m)(e.viewContainerVisibilityState)}},this.containerType=e.containerType,this.onReadyToRender=e.onReadyToRender,this.onReadyToRender&&(this.onReadyToRender=this.onReadyToRender.bind(e)),this.invokeModalConfirmationDialog=e.invokeModalConfirmationDialog,this.invokeModalConfirmationDialog&&(this.invokeModalConfirmationDialog=this.invokeModalConfirmationDialog.bind(e)),this.setDisplayConfiguration=e.setDisplayConfiguration,this.setDisplayConfiguration&&(this.setDisplayConfiguration=this.setDisplayConfiguration.bind(e)),this.closeView=e.closeView.bind(e),this.onViewEventReceived=this.onViewEventReceived.bind(this),this.onProviderStateChange=this.onProviderStateChange.bind(this);var o=k("SharedCommentPane",t);this.viewContainerProvider&&(this.viewContainerProvider.registerForViewContainerEvents(this.onViewEventReceived),this.providerPromise=Object(u.d)().getComponent(o),this.providerPromise.then((function(e){e.onStateChanged.subscribe(a.onProviderStateChange)})).catch(Object(j.a)(s.d.reserveTag(558401359))))}return Object.defineProperty(e.prototype,"identifier",{get:function(){return this.viewContainerBase.identifier},enumerable:!1,configurable:!0}),e.prototype.renderIntoView=function(e){this.renderPane(e)},e.prototype.renderPane=function(e){var t=this,n=e.component,a=Object(l.k)().createActivityObject("RenderPaneIntoView",B.getTelemetryVisitor(this.context),Object(l.j)());if(!n)return this.lastRenderFailed&&a.failTag(558401360,-2130957502),void(this.lastRenderFailed=!0);Object(_.render)(O.createElement(n,{resource:{id:"CommentPane"}}),this.rootNode,(function(){var e=document.getElementById(S.z());e&&e.focus(),t.lastRenderFailed=!1})),a.successTag(558401361)},e.prototype.onProviderStateChange=function(e){var t=this;this.rootNode&&(e===u.a.Registered?this.providerPromise.then((function(e){t.renderIntoView(e)})).catch((function(e){Object(l.k)().assertConditionTag(!1,"Unexpected promise rejection from component provider promise",558401362)})):e===u.a.Unregistered&&Object(_.unmountComponentAtNode)(this.rootNode))},e.prototype.onViewEventReceived=function(e){var t;switch(e.eventType){case W.a.VisibilityChanged:this.processVisibilityEvent(e);break;case W.a.ViewContainerChanged:e.newViewContainer!==this&&(null===(t=this.viewContainerProvider)||void 0===t||t.unregisterForViewContainerEvents(this.onViewEventReceived));break;case W.a.FoldableLayoutStateChanged:case W.a.FocusTriggered:break;default:Object(s.m)(e)}},e.prototype.openView=function(){this.viewContainerBase.openView&&this.viewContainerBase.openView()},e.prototype.closeView=function(){this.viewContainerBase.closeView()},e.prototype.moveFocusToCanvas_donotuse=function(){},e}(),Y=function(e){function t(t,n){var a=e.call(this)||this;return a.viewContainerProvider=n,a.apiContext=t,n.registerForViewContainerEvents(a.fireEvent),a}return Object(a.__extends)(t,e),t.prototype.getViewContainer=function(){return this.currentContainer||(b.J()?this.currentContainer=new I(this.viewContainerProvider.getViewContainer(),this.apiContext,this):this.currentContainer=new G(this.viewContainerProvider.getViewContainer(),this.apiContext,this)),this.currentContainer},t.prototype.changeViewContainerType=function(e){},t}(T);var K=n(400),q=n(806),Q=Object(q.c)((function(){return{offscreenLiveRegion:{clip:"rect(1px, 1px, 1px, 1px)",height:0,overflow:"hidden",position:"absolute",whiteSpace:"nowrap",width:0}}})),X=function(e){function t(t){var n=e.call(this,t)||this;return n.state={liveRegionUpdate:t.liveRegionUpdate,liveRegionCounter:0},n}return Object(a.__extends)(t,e),t.prototype.appendLiveRegionUpdate=function(e){var t=this,n=this.state.liveRegionCounter+1;this.setState({liveRegionUpdate:e,liveRegionCounter:n}),setTimeout((function(){t.state.liveRegionCounter===n&&t.setState({liveRegionUpdate:void 0,liveRegionCounter:0})}),1e3)},t.prototype.render=function(){var e=Q();return O.createElement("span",{role:"region","aria-live":"assertive","aria-atomic":"true","aria-relevant":"additions",style:e.offscreenLiveRegion},this.state.liveRegionUpdate)},t}(O.PureComponent),J=void 0;function Z(){J=document.createElement("div"),document.body.appendChild(J),_.render(O.createElement(X,{ref:ee}),J),Object(K.c)({announceToScreenReader:function(e){var t=$;t&&!function(e){return null==e}(e)&&t.appendLiveRegionUpdate(e)}})}var $=void 0;function ee(e){$=e}var te=n(308),ne=(n(457),n(458)),ae=n(1003),oe=n(469);function re(){return B.getViewManager(i.a)}function ie(){re().beginInitialization()}var se=n(100),de=n(166),ce=n(330),le=n(712),me=function(){function e(e,t,n,a,o){var r=this;this.hostCommentAPI=e,this.author=t,this._anchorHintText=n,this.sessionConfiguration=a,this._insertIndex=o,this._active=!0,this._propertiesToUpdate={},this.updateDraft=function(e){e.draftId===r.sessionConfiguration.draftId&&(e.anchorHintText&&(r._anchorHintText=e.anchorHintText),void 0!==e.insertIndex&&(r._insertIndex=e.insertIndex))},this.handleCommentEvents=function(e,t){e===ce.e.CommentContextChanged&&Object(le.b)(t)&&t.contextDrafts?t.contextDrafts.forEach((function(e){return r.updateDraft(e)})):e===ce.e.UpdateDraftThread&&Object(le.d)(t)&&r.updateDraft(t)},this.hostCommentAPI.registerForCommentEvents(this.handleCommentEvents)}return Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchorHintText",{get:function(){return this._anchorHintText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"insertIndex",{get:function(){return this._insertIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"propertiesToUpdate",{get:function(){return this._propertiesToUpdate},enumerable:!1,configurable:!0}),e.prototype.updateProperties=function(e,t){this._propertiesToUpdate[e]=Object(a.__assign)({},t)},e.prototype.commit=function(e){if(!this.hostCommentAPI.commit)throw new N.a(de.h,s.d.reserveTag(589103689),-2130957526);if(!this._active)throw new N.a(de.b,s.d.reserveTag(589103690),-2130957525);var t=b.b()||b.a(),n=t&&this.sessionConfiguration.sessionType===ce.i;if(void 0===e&&!n||n&&void 0!==e)throw new N.a(de.c,s.d.reserveTag(589103691),-2130957507);return t?this.hostCommentAPI.commit(this.sessionConfiguration.draftId,e,this._propertiesToUpdate):this.hostCommentAPI.commit(this.sessionConfiguration.draftId,e)},e.prototype.endDrafting=function(){this._active=!1,this.hostCommentAPI.unregisterForCommentEvents(this.handleCommentEvents),this.hostCommentAPI.endCommentSession(this.sessionConfiguration.draftId)},e}(),ue=function(){function e(e){this.hostCommentAPI=e,this.loadThreads=e.loadThreads.bind(e),this.deleteComment=e.deleteComment.bind(e),this.selectComment=e.selectComment.bind(e),this.highlightComment=e.highlightComment.bind(e),this.setThreadResolvedState=e.setThreadResolvedState.bind(e),this.selectFirstThreadInNextCommentContext=e.selectFirstThreadInNextCommentContext.bind(e),this.selectLastThreadInPreviousCommentContext=e.selectLastThreadInPreviousCommentContext.bind(e),this.registerForCommentEvents=e.registerForCommentEvents.bind(e),this.unregisterForCommentEvents=e.unregisterForCommentEvents.bind(e),this.registerForAction=e.registerForAction.bind(e),this.unregisterForAction=e.unregisterForAction.bind(e),this.checkAtMentionCapability=e.checkAtMentionCapability.bind(e),e.getCommentReactionData&&(this.getCommentReactionData=e.getCommentReactionData.bind(e)),b.x()&&(this.presentLinkToComment=e.presentLinkToComment.bind(e)),e.registerForInterruptableCommands&&(this.registerForInterruptableCommands=e.registerForInterruptableCommands.bind(e)),e.unregisterForInterruptableCommands&&(this.unregisterForInterruptableCommands=e.unregisterForInterruptableCommands.bind(e)),e.onClickableTextClicked&&(this.onClickableTextClicked=e.onClickableTextClicked.bind(e)),b.o()&&e.diagnosticHeartbeat&&setInterval((function(){var t;null===(t=e.diagnosticHeartbeat)||void 0===t||t.call(e)}),1e3)}return e.prototype.beginDraftingAsync=function(e){var t=this;if(!this.hostCommentAPI.beginDraftingAsync||!this.hostCommentAPI.commit)throw new N.a("Drafting APIs are undefined on Host Comment API",s.d.reserveTag(589103700),-2130957527);var n=Object(d.a)(),o=Object(a.__assign)(Object(a.__assign)({},e),{draftId:n});return this.hostCommentAPI.beginDraftingAsync(o).then((function(e){return new me(t.hostCommentAPI,Object(se.e)(e),e.anchorHintText,e.updatedDraftSessionConfiguration||o,e.insertIndex)}))},e}(),pe=n(83),fe={themeId:1,palette:{ButtonBorder:pe.a.GRAY_B,CardAccent:pe.a.GRAY_B,CardBackground:pe.a.WHITE,CardHoveredBackground:pe.a.GRAY_20,CardDraftBoxBackgroundHovered:pe.a.WHITE,CardDraftBoxBorderHovered:pe.a.GRAY_160,CardDraftBoxBorder:pe.a.GRAY_110,CardDraftBoxBackground_HalfPane:pe.a.WHITE,CardDraftBoxBackground:pe.a.GRAY_A,CardExpandButtonBorder:pe.a.GRAY_B,CardHeroBarBackground_HalfPane:pe.a.GRAY_A,CardHeroBarBackground:pe.a.WHITE,CardReplyBackground_HalfPane:pe.a.GRAY_A,CardReplyBackground:pe.a.GRAY_A,CardReplyTopBorder:pe.a.GRAY_B,CardSelectionColor:pe.a.COMMENTS_PURPLE,CardShadowColor:pe.a.BLACK,CardBorder:pe.a.GRAY_B,CardBorderEmphasis:pe.a.COMMENTS_PURPLE,CommandBarBorder:pe.a.GRAY_B,CommandBarTopBorder:pe.a.GRAY_B,IconButtonDisabledTint:pe.a.GRAY_C,IconButtonFocusedTint:pe.a.GRAY_I,NavigationBarBackground:pe.a.WHITE,NavigationBarBorder:pe.a.GRAY_B,PaneBackground_HalfPane:pe.a.WHITE,PaneBackground:pe.a.GRAY_A,UnreadDotColor:pe.a.DOT_BLUE,UnreadDotBorderColor:pe.a.WHITE,ExpandButtonHoverBackground:"transparent",ExpandButtonBackground:"transparent",FocusBorderColor:pe.a.GRAY_150,CardPlaceholderColor:pe.a.GRAY_130,ResolvedCardBackground:pe.a.GRAY_20}},ge=function(){function e(){}return e.prototype.getTheme=function(){return Object(l.k)().assertConditionTag(!1,"Should not be called",592986821),fe},e.prototype.registerForThemeChange=function(e){},e.prototype.unregisterForThemeChange=function(e){},e}(),he=n(2837),Ce=n(127),ve=n(267),be=n(117),ye=n(90),Te=n(105),Ie=n(237),Oe=n(483),_e=n(68),Se=n(270),je=n(119),ke=n(139),xe=n(65),Ee=n(173),De=n(125),Ae=n(118),we=n(238),Pe=n(209),Re=n(676),Ve=n(61),Fe=n(320),Ne=n(172),Me=n(140),Le=n(677),He=n(485),Ue=n(1007),Be=n(486),ze=n(239);function We(e,t){return!!(Object(ze.c)(t)?e.getComponentById(t):e.getComponent(t.componentType))}function Ge(e,t){if(n=e.componentTreeId.renderContextType,!("win32"===Object(Ne.a)()||"web"===Object(Ne.a)()&&b.J())&&Object(Me.b)(n)){var n;if(e.getComponent(ze.a.ClosePaneButton))return Object(He.a)(void 0,{componentType:ze.a.ClosePaneButton},{priorityArgs:t});Object(l.k)().assertConditionTag(!1,"cant find close button on platform where we should be able to find it",579086371)}}function Ye(e,t,n){var a,o;if(void 0===n&&(n={priority:1}),Object(Me.b)(e.componentTreeId.renderContextType)){var r=null!==(o=null!==(a=function(e,t,n){if(b.B()&&e.componentTreeId.renderContextType===Ve.a.FullPane){var a=t.getState();if(xe.p(a).newThread){if(e.getComponent(ze.a.NewCommentButton))return Object(He.a)(void 0,{componentType:ze.a.NewCommentButton},{priorityArgs:n});Object(l.k)().assertConditionTag(!1,"cant find new comment button, but its enabled",579086400)}}}(e,t,n))&&void 0!==a?a:Ge(e,n))&&void 0!==o?o:function(e){if("web"!==Object(Ne.a)())return Object(He.a)(void 0,{componentType:ze.a.CommentsList},{priorityArgs:e})}(n);if(r)return r;Object(l.k)().assertConditionTag(!1,"Couldn't find a focus target",576337158)}else Object(l.k)().assertConditionTag(!1,"Shouldn't be called with renderContextType: ".concat(e.componentTreeId.renderContextType),576337157)}var Ke=function(e){function t(t){var n=e.call(this,t)||this,a=t.nativeEvent,o=a.altKey,r=a.shiftKey,i=a.ctrlKey,s=a.metaKey,d=a.key;return n.altKey=o,n.shiftKey=r,n.ctrlKey=i,n.metaKey=s,n.key=Object(Ce.f)(d),n}return Object(a.__extends)(t,e),t}(function(){function e(e){this._sourceEvent=e,this.eventPhase=e.eventPhase}return e.prototype.isEventTarget=function(e){return e===this._sourceEvent.target},e.prototype.stopPropagation=function(){this._sourceEvent.stopPropagation()},e.prototype.preventDefault=function(){this._sourceEvent.preventDefault()},e}());function qe(e,t,n,o,r){var i=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return o.apply(void 0,Object(a.__spreadArray)([e],Object(a.__read)(t),!1))},s=function(o){for(var s=[],d=1;d<arguments.length;d++)s[d-1]=arguments[d];var c=i.apply(void 0,Object(a.__spreadArray)([o],Object(a.__read)(s),!1));r(c,o,e(),t,n)};return s.processCommand=i,s}function Qe(e,t,n,o,r){var i=function(t,n){var o,i=Object(a.__read)(n),d=i[0],c=i.slice(1),l=d();r(s.apply(void 0,Object(a.__spreadArray)([(o=t,new Ke(o)),l],Object(a.__read)(c),!1)),l,e(),(function(){}),(function(){}))},s=function(e,r){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];if(n(r)){var d=Object(Ce.d)(Object(Ce.f)(e.key),t),c=o[Ce.b[d]];return c?c.handler.apply(c,Object(a.__spreadArray)([e,r],Object(a.__read)(i),!1)):void 0}},d=Object.keys(o).map((function(e){return{key:e,eventPhase:o[e].phase}})),c=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{onKeyDown:function(t){return i(t,e)},getKeyDownEvents:function(){return d}}};return c.processEvent=s,c}var Xe,Je,Ze=n(383),$e=n(678),et=n(207),tt=n(138),nt=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=!1),this.model=e,this.startPostIndex=t,this.pointer=0,this.ignoreResolvedThreads=!1,t>e.length?this.pointer=e.length:this.pointer=t<0?-1:t,this.ignoreResolvedThreads=n}return e.prototype.getRootCommentForCurrentElement=function(e){if(this.model[this.pointer]){var t=Object(tt.b)(this.model[this.pointer]);return e&&e.commentId===t?e:this.model.find((function(e){return e.commentId===t}))}},e.prototype.next=function(){var e,t=this.pointer;if(this.pointer<this.model.length-1)if(this.ignoreResolvedThreads)do{++this.pointer,e=this.getRootCommentForCurrentElement(e)}while(this.pointer<this.model.length&&e&&e.commentFlags&ce.f.Resolved);else++this.pointer;return this.pointer<this.model.length-1||this.pointer===this.model.length-1&&t<this.model.length-1?{done:!1,value:this.model[this.pointer]}:{done:!0}},e.prototype.previous=function(){var e,t=this.pointer;if(this.pointer>0)if(this.ignoreResolvedThreads)do{--this.pointer,e=this.getRootCommentForCurrentElement(e)}while(this.pointer>-1&&e&&e.commentFlags&ce.f.Resolved);else--this.pointer;return this.pointer>0||0===this.pointer&&t>0?{done:!1,value:this.model[this.pointer]}:{done:!0}},e.prototype.currentIndex=function(){return this.pointer},e}(),at=n(674),ot=n(152),rt=n(205),it=n(319),st=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=!1),this.items=e,this.startItemIndex=t,this.ignoreResolvedThreads=n,this.pointer=0,t>e.length?this.pointer=e.length:this.pointer=t<0?-1:t}return e.prototype.getRootCommentForCurrentElement=function(e){if(this.items[this.pointer]){var t=ot.i(this.items[this.pointer]);if(e&&e.commentId===t)return e;for(var n=this.pointer;n>=0;--n){var a=this.items[n];if(Object(it.a)(a)&&a.commentModel.commentId===t)return a.commentModel}for(n=this.pointer+1;n<this.items.length;++n){a=this.items[n];if(Object(it.a)(a)&&a.commentModel.commentId===t)return a.commentModel}}},e.prototype.next=function(){var e,t=this.pointer;if(this.pointer<this.items.length-1)if(this.ignoreResolvedThreads)do{++this.pointer,e=this.getRootCommentForCurrentElement(e)}while(this.pointer<this.items.length&&e&&e.commentFlags&rt.a.Resolved);else++this.pointer;return this.pointer<this.items.length-1||this.pointer===this.items.length-1&&t<this.items.length-1?{done:!1,value:this.items[this.pointer]}:{done:!0}},e.prototype.previous=function(){var e,t=this.pointer;if(this.pointer>0)if(this.ignoreResolvedThreads)do{--this.pointer,e=this.getRootCommentForCurrentElement(e)}while(this.pointer>-1&&e&&e.commentFlags&rt.a.Resolved);else--this.pointer;return this.pointer>0||0===this.pointer&&t>0?{done:!1,value:this.items[this.pointer]}:{done:!0}},e.prototype.currentIndex=function(){return this.pointer},e}(),dt=n(1009),ct=function(){function e(e,t,n){this.commentStore=e,this.telemetryVisitor=t,this.useContentNavigationAPI=n}return e.prototype.selectThreadInCurrentContext=function(e,t,n,a,o){return Object(Le.a)(e,ye.selectComment(t,n,void 0,a?ye.SelectActionType.ExpandCard:ye.SelectActionType.SelectCard,o))},e.prototype.collapseThreadInCurrentContext=function(e,t,n){return Object(Le.a)(e,ye.collapseCard(t,n))},e.prototype.selectPost=function(e,t,n,a,o){return Object(Le.a)(e,ye.selectComment(t,n,a,ye.SelectActionType.SelectPost,o))},e.prototype.selectFirstThreadInCurrentContext=function(e,t,n,a,o){if(!b.U()&&b.W()){var r=xe.g(this.commentStore.getState(),!0,a),i=Object(_e.G)(xe.h(this.commentStore.getState()),!0,a);if(i&&r&&0===r.flatIndex)return this.selectThreadInCurrentContext(e,{renderContextType:a,trackback:s.d.reserveTag(588129411),telemetryVisitor:this.telemetryVisitor},i,!1,n)}var d=void 0,c=o?xe.a(this.commentStore.getState()):xe.k(this.commentStore.getState());if(Object(Ae.f)(c))d=o?new at.b(c,xe.d(this.commentStore.getState()),-1).next().value:c[0];else{var l=void 0;if(o)l=new at.a(c,-1,o).next().value;else l=c[0];d=null==l?void 0:l.commentId}if(d)return this.selectThreadInCurrentContext(e,{renderContextType:a,trackback:s.d.reserveTag(593278811),telemetryVisitor:this.telemetryVisitor},d,t,n)},e.prototype.selectLastThreadInCurrentContext=function(e,t,n,a,o){var r=xe.d(this.commentStore.getState());if(!Object(Ae.c)(r)&&b.W()){var i=xe.g(this.commentStore.getState(),!0,a),d=Object(_e.G)(xe.h(this.commentStore.getState()),!0,a);if(d&&i&&i.flatIndex===r.length)return this.selectThreadInCurrentContext(e,{renderContextType:a,trackback:s.d.reserveTag(588129412),telemetryVisitor:this.telemetryVisitor},d,!1,n)}var c=o?xe.a(this.commentStore.getState()):xe.k(this.commentStore.getState());if(Object(_e.d)(c,r,o)){var m=void 0;if(Object(Ae.f)(c))m=o?new at.b(c,r,c.length).previous().value:c[c.length-1];else{var u=new at.a(c,c.length,o).previous().value;m=null==u?void 0:u.commentId}if(m)return this.selectThreadInCurrentContext(e,{renderContextType:a,trackback:s.d.reserveTag(593278813),telemetryVisitor:this.telemetryVisitor},m,t,n);Object(l.k)().assertConditionTag(!1,"Unable to find last thread",593278812)}},e.prototype.focusAndCollapseSelectedThread=function(e,t){var n=xe.t(this.commentStore.getState());if(n){if(b.W()&&Object(_e.G)(xe.h(this.commentStore.getState()))===n.selectedCardId)return;var a=xe.j(this.commentStore.getState());if(Object(Fe.a)(n.selectedCardId,a,t)===we.a.Expanded)return Object(dt.a)(e,Object(He.a)(e,{componentType:ze.a.Card,id:n.selectedCardId,renderContextType:t}),this.collapseThreadInCurrentContext(e,{renderContextType:t,trackback:s.d.reserveTag(593278814),telemetryVisitor:this.telemetryVisitor},n.selectedCardId))}},e.prototype.selectNextOrPreviousGetIdOrFocusCommandIfNecessary_deprecated=function(e,t,n,a,o,r,i,d){var c,l=t.direction===D.d.Next?e.next():e.previous();if(b.W()&&n&&a&&o.selectedCardId!==n&&(t.direction===D.d.Next?r<a.flatIndex&&(l.done||e.currentIndex()>=a.flatIndex):r>=a.flatIndex&&(l.done||e.currentIndex()<a.flatIndex)))return this.selectThreadInCurrentContext(i,{renderContextType:d,trackback:s.d.reserveTag(588289059),telemetryVisitor:this.telemetryVisitor},n,!1,t.source);return l.done||(c=l.value.commentId),c},e.prototype.selectNextOrPreviousThread=function(e,t,n,a,o){var r=this.commentStore.getState(),i=xe.t(r);if(this.useContentNavigationAPI&&(!i||a===Ve.a.DiscreteIntegrated||a===Ve.a.None&&De.e(r)!==z.a.Visible)){if(void 0!==n)return Object(Le.a)(e,ye.selectContent({renderContextType:a,trackback:s.d.reserveTag(578352064),telemetryVisitor:this.telemetryVisitor},t.direction,t.iterableContentTypes,!!t.restrictToCurrentContext,!!t.restrictToCurrentContext,i?{contentId:i.selectedCardId,contentType:p.b.CommentThread}:void 0,n));Object(l.k)().assertConditionTag(!1,"contentNavigationReason undefined when expecting to use content navigation",560756106)}var d=o?xe.a(this.commentStore.getState()):xe.k(this.commentStore.getState()),c=xe.f(r).nextPopulatedContextDetails,m=t.direction===D.d.Next,u=xe.g(r,!0,a);if(void 0!==i&&(o||Object(Ie.b)(this.commentStore.getState(),i.selectedCardId))){var f=Object(_e.G)(xe.h(r),!0,a),g=void 0;g=!Object(Ae.f)(d)&&b.W()&&u&&i.selectedCardId===f?u.flatIndex+(m?-1:0):this.getSelectedThreadIndex(d);var h=void 0;if(Object(Ae.f)(d))if(o){var C=new at.b(d,xe.d(r),g);h=m?C.next().value:C.previous().value}else h=d[g+(m?1:-1)];else{C=new at.a(d,g,o);var v=this.selectNextOrPreviousGetIdOrFocusCommandIfNecessary_deprecated(C,t,f,u,i,g,e,a);if(v&&"string"!=typeof v)return v;h=v}if(h)return this.selectThreadInCurrentContext(e,{renderContextType:a,trackback:s.d.reserveTag(593278816),telemetryVisitor:this.telemetryVisitor},h,t.expandCard,t.source);if(!t.restrictToCurrentContext)return this.selectAcrossContexts(e,t,a,c,o)}else{if(Object(_e.d)(o?xe.a(this.commentStore.getState()):xe.k(this.commentStore.getState()),xe.d(r),o)||!b.U()&&b.W()&&u)return this.selectFirstThreadInCurrentContext(e,t.expandCard,t.source,a,o);if(!t.restrictToCurrentContext&&c!==et.a.NoComments)return this.selectAcrossContexts(e,t,a,c,o)}},e.prototype.selectAcrossContexts=function(e,t,n,a,o){return this.useContentNavigationAPI&&!De.a(this.commentStore.getState())&&Object(l.k)().assertConditionTag(!1,"This method should not be used for DHC iteration across contexts when the content navigation API is being used.",560551957),t.direction===D.d.Next?a===et.a.OnlyCommentsInCurrent?this.selectFirstThreadInCurrentContext(e,t.expandCard,t.source,n,o):Object(Le.a)(e,ye.selectFirstThreadInNextCommentContext({renderContextType:n,trackback:s.d.reserveTag(593278817),telemetryVisitor:this.telemetryVisitor})):a===et.a.OnlyCommentsInCurrent?this.selectLastThreadInCurrentContext(e,t.expandCard,t.source,n,o):Object(Le.a)(e,ye.selectLastThreadInPreviousCommentContext({renderContextType:n,trackback:s.d.reserveTag(593278818),telemetryVisitor:this.telemetryVisitor}))},e.prototype.selectNextPostWithinCard=function(e,t,n){var a=xe.t(this.commentStore.getState());if(void 0!==a){if(!b.b()){var o=xe.d(this.commentStore.getState()),r=this.getSelectedIndex(),i=void 0,d=void 0;if(Object(Ae.c)(o)){var c=xe.b(this.commentStore.getState())[a.selectedCardId];c&&r<c.length-1&&(i=a.selectedCardId,d=c[r+1])}else{var m=new nt(o,r).next(),u=o[r];!m.done&&m.value.parentId&&m.value.parentId===Object(tt.b)(u)&&(i=m.value.parentId,d=m.value.commentId)}return i&&d?this.selectPost(e,{renderContextType:t,trackback:s.d.reserveTag(593278854),telemetryVisitor:this.telemetryVisitor},i,d,Te.a.SharedComments):void 0}if(n){var p=this.getSelectedIndexFromRenderableItems(n);if(!(p<0)){var f=new st(n,p).next(),g=n[p],h=ot.i(g);return f.done||ot.i(f.value)!==h?void 0:this.selectPost(e,{renderContextType:t,trackback:s.d.reserveTag(593278856),telemetryVisitor:this.telemetryVisitor},ot.i(f.value),ot.e(f.value),Te.a.SharedComments)}Object(l.k)().assertConditionTag(!1,"Selection not found in renderableItems",571777352)}else Object(l.k)().assertConditionTag(!1,"renderableItems must not be undefined",593278855)}else Object(l.k)().assertConditionTag(!1,"Expected selectedComment",593278853)},e.prototype.selectPreviousPostWithinCard=function(e,t,n){var a=xe.t(this.commentStore.getState());if(void 0!==a){if(!b.b()){var o=xe.d(this.commentStore.getState()),r=this.getSelectedIndex(),i=void 0,d=void 0;if(Object(Ae.c)(o)){var c=xe.b(this.commentStore.getState())[a.selectedCardId];c&&r>0&&(i=a.selectedCardId,d=c[r-1])}else{var m=o[r];if(m.parentId)(p=new nt(o,r).previous()).done||Object(tt.b)(p.value)!==m.parentId||(i=Object(tt.b)(p.value),d=p.value.commentId)}return i&&d?this.selectPost(e,{renderContextType:t,trackback:s.d.reserveTag(593278858),telemetryVisitor:this.telemetryVisitor},i,d,Te.a.SharedComments):void 0}if(n){var u=this.getSelectedIndexFromRenderableItems(n);if(u<0)Object(l.k)().assertConditionTag(!1,"Selection not found in renderableItems",571777353);else{var p,f=n[u],g=ot.g(f);if(g)if(!(p=new st(n,u).previous()).done&&ot.i(p.value)===g)return this.selectPost(e,{renderContextType:t,trackback:s.d.reserveTag(593278860),telemetryVisitor:this.telemetryVisitor},ot.i(p.value),ot.e(p.value),Te.a.SharedComments)}}else Object(l.k)().assertConditionTag(!1,"renderableItems must not be undefined",593278859)}else Object(l.k)().assertConditionTag(!1,"Expected selectedComment",593278857)},e.prototype.selectRootPostOfSelectedThread=function(e,t){var n=xe.t(this.commentStore.getState());if(n&&!Object(ke.j)(n.selectionDetails))return this.selectPost(e,{renderContextType:t,trackback:s.d.reserveTag(593278861),telemetryVisitor:this.telemetryVisitor},n.selectedCardId,n.selectedCardId,Te.a.SharedComments)},e.prototype.focusAndSelectSiblingThread=function(e,t){if(!(t<0)){var n=xe.k(this.commentStore.getState()),a=Object(Ae.f)(n)?n:n.filter((function(e){return!e.parentId}));if(0!==a.length&&(0!==t||1!==a.length)){var o;t>a.length?(Object(l.k)().assertConditionTag(!1,"Passed in threadIndex too large.",526660886),o=a.length-1):o=t>=1?t-1:t+1;var r=Object(Ae.f)(a)?a[o]:a[o].commentId;return Object(dt.a)(void 0,Object(He.a)(void 0,{componentType:ze.a.Card,id:r,renderContextType:e}),Object(Le.a)(void 0,ye.selectComment({renderContextType:e,trackback:s.d.reserveTag(593278862),telemetryVisitor:this.telemetryVisitor},r,void 0,ye.SelectActionType.SelectCard,Te.a.SharedComments)))}}},e.prototype.getSelectedIndex=function(){var e=this.commentStore.getState();return Object(_e.u)(xe.d(e),xe.b(e),xe.t(e))},e.prototype.getSelectedThreadIndex=function(e){return Object(_e.M)(e,xe.t(this.commentStore.getState()))},e.prototype.getSelectedIndexFromRenderableItems=function(e){var t=xe.t(this.commentStore.getState());if(!t)return-1;var n=Object(ke.b)(t);return e.findIndex((function(e){return ot.e(e)===n}))},e}(),lt=function(){function e(e,t){var n=this;this.isRTL=e,this.telemetryVisitor=t,this.focusToRetry=void 0,this.draftToFocus=void 0,this._commentStore=void 0,this.commandExecutor=Object(Ue.b)(Ue.a,[Ze.a.FocusComponent]),this.pendingOnComponentFocusedRequest=void 0,this.clearPendingOnComponentFocusedRequest=function(e){var t=e?Object(Be.d)(e):"";!n.pendingOnComponentFocusedRequest||""!==t&&t===Object(Be.d)(n.pendingOnComponentFocusedRequest.targetedComponent)||(be.a&&Object(s.i)("Pending component focused request cleared."),clearTimeout(n.pendingOnComponentFocusedRequest.token),n.pendingOnComponentFocusedRequest=void 0)},this.commandOnWillFocusCallback=function(e){n.clearPendingOnComponentFocusedRequest(e)},this.commandExecuteCallback=function(e,t){e&&Object(He.b)(e)&&(t===Re.a.ShouldRetry?n.focusToRetry={command:e,timestamp:Date.now()}:t===Re.a.Handled&&(n.focusToRetry=void 0))},this.commentContentsKeyDown=Qe((function(){return n.commentStore}),this.isRTL,(function(e){var t=xe.h(n.commentStore.getState());if(b.W()){var a=Object(_e.I)(t);if(a&&e.isFocusOnOrWithin({componentType:ze.a.CardEditor,id:a,renderContextType:t.drafts[t.cardIdToDraftIdMap[a]].renderContextType}))return!1;var o=Object(_e.J)(t);if(o&&e.isFocusOnOrWithin({componentType:ze.a.PostEditor,id:o,renderContextType:t.drafts[t.postIdToDraftIdMap[o]].renderContextType}))return!1}else if(Object(je.c)(t))return!1;return!e.isFocusOn({componentType:ze.a.GhostCard})}),{ArrowDown:{handler:function(e,t,a){var o=n.onDownKey(e,t,a?a():void 0);return o&&(o.stopPropagation=!0,o.preventDefault=!0),o},phase:Ce.a.Bubbling},ArrowUp:{handler:function(e,t,a){var o=n.onUpKey(e,t,a?a():void 0);return o&&(o.stopPropagation=!0,o.preventDefault=!0),o},phase:Ce.a.Bubbling},ArrowRight:{handler:function(e,t){if(t.componentTreeId.renderContextType!==Ve.a.HalfPane){var a=n.onRightKey(e,t);return a&&(a.stopPropagation=!0,a.preventDefault=!0),a}},phase:Ce.a.Bubbling},ArrowLeft:{handler:function(e,t){if(t.componentTreeId.renderContextType!==Ve.a.HalfPane){var a=n.onLeftKey(e,t.componentTreeId.renderContextType);return a&&(a.stopPropagation=!0,a.preventDefault=!0),a}},phase:Ce.a.Bubbling},Home:{handler:function(e,t){if(t.componentTreeId.renderContextType===Ve.a.FullPane){var a=n.selectionCommandFactory.selectFirstThreadInCurrentContext(e,!0,Te.a.SharedComments,t.componentTreeId.renderContextType,!1);return a&&(a.stopPropagation=!0,a.preventDefault=!0),a}},phase:Ce.a.Capturing},End:{handler:function(e,t){if(t.componentTreeId.renderContextType===Ve.a.FullPane){var a=n.selectionCommandFactory.selectLastThreadInCurrentContext(e,!0,Te.a.SharedComments,t.componentTreeId.renderContextType,!1);return a&&(a.stopPropagation=!0,a.preventDefault=!0),a}},phase:Ce.a.Capturing},F12:{handler:function(e,t){var a=e.altKey?n.handleMoveFocusEvent(e,t):void 0;return a&&(a.stopPropagation=!0),a},phase:Ce.a.None},Escape:{handler:function(e,t){var a="win32"===Object(Ne.a)()?n.handleMoveFocusEvent(e,t):void 0;return a&&(a.stopPropagation=!0),a},phase:Ce.a.None}},this.commandExecutor),this.focusCommentCardCommand=qe((function(){return n.commentStore}),this.commandExecuteCallback,this.commandOnWillFocusCallback,(function(e,t){var a=xe.h(n.commentStore.getState()),o=Object(_e.K)(a),r=void 0;return(r=n.checkForRetryOfEditorFocus(e,a))||!b.W()&&(null==o?void 0:o.threadId)===t&&(r=n.checkForActiveEditorFocus(void 0,e.componentTreeId.renderContextType,a))?r:Object(He.a)(void 0,{componentType:Object(Be.c)(t,a),id:t,renderContextType:e.componentTreeId.renderContextType},{priorityArgs:{priority:1},preventScroll:e.componentTreeId.renderContextType===Ve.a.DiscreteIntegrated})}),this.commandExecutor),this.focusCommentPostCommand=qe((function(){return n.commentStore}),this.commandExecuteCallback,this.commandOnWillFocusCallback,(function(e,t){var a=xe.h(n.commentStore.getState());if(!b.W()&&a.postIdToDraftIdMap[t]){var o=n.checkForActiveEditorFocus(void 0,e.componentTreeId.renderContextType,a);if(o)return o}return Object(He.a)(void 0,{componentType:ze.a.Post,id:t,renderContextType:e.componentTreeId.renderContextType},{priorityArgs:{priority:2,phase:1}})}),this.commandExecutor),this.focusCommentPaneCommand=qe((function(){return n.commentStore}),this.commandExecuteCallback,this.commandOnWillFocusCallback,(function(e){if(Object(Me.b)(e.componentTreeId.renderContextType)){var t=xe.h(n.commentStore.getState()),a=xe.t(n.commentStore.getState()),o=void 0;if(o=n.checkForRetryOfEditorFocus(e,t))return o;if(!e.isFocusWithinPane()||e.isFocusOn({componentType:ze.a.PaneRoot})){if(!b.W()&&(o=n.checkForActiveEditorFocus(void 0,e.componentTreeId.renderContextType,t)))return o;if(o=n.checkForCommentSelectionFocus(e.componentTreeId.renderContextType,a,t))return o;if(!b.B()&&!e.getComponent(ze.a.ClosePaneButton)){var r=xe.k(n.commentStore.getState());return r.length>0?n.focusCommentCardCommand.processCommand(e,Object(Ae.f)(r)?r[0]:r[0].commentId):void Object(l.k)().assertConditionTag("win32"===Object(Ne.a)(),"Shouldn't be reached on current config",575239243)}return Ye(e,n.commentStore)}}else Object(l.k)().assertConditionTag(!1,"paneContainerFocusHandler called outside of a pane render context",575239242)}),this.commandExecutor),this.commentCardMounted=qe((function(){return n.commentStore}),this.commandExecuteCallback,this.commandOnWillFocusCallback,(function(e,t){var a,o=xe.h(n.commentStore.getState()),r={componentType:Object(Be.c)(t.id,o),id:t.id,renderContextType:e.componentTreeId.renderContextType};if(a=n.handleFocusRetry(e,r,o,1))return a;if(t.selected&&!e.isFocusWithin(r)){var i=Object(Me.b)(e.componentTreeId.renderContextType);if((!i||e.isFocusWithinPane())&&(i||e.isFocusWithinAny(ze.a.Card)||e.isFocusWithinAny(ze.a.DraftCard)))return n.focusCommentCardCommand.processCommand(e,t.id)}}),this.commandExecutor),this.commentCardEditorMounted=qe((function(){return n.commentStore}),this.commandExecuteCallback,this.commandOnWillFocusCallback,(function(e,t){return n.handleFocusRetry(e,{componentType:ze.a.CardEditor,id:t,renderContextType:e.componentTreeId.renderContextType},xe.h(n.commentStore.getState()),1)}),this.commandExecutor),this.commentPostMounted=qe((function(){return n.commentStore}),this.commandExecuteCallback,this.commandOnWillFocusCallback,(function(e,t){return n.handleFocusRetry(e,{componentType:ze.a.Post,id:t,renderContextType:e.componentTreeId.renderContextType},xe.h(n.commentStore.getState()),1)}),this.commandExecutor),this.commentPostEditorMounted=qe((function(){return n.commentStore}),this.commandExecuteCallback,this.commandOnWillFocusCallback,(function(e,t){return n.handleFocusRetry(e,{componentType:ze.a.PostEditor,id:t,renderContextType:e.componentTreeId.renderContextType},xe.h(n.commentStore.getState()),1)}),this.commandExecutor),this.commentPanePropsUpdated=qe((function(){return n.commentStore}),this.commandExecuteCallback,this.commandOnWillFocusCallback,(function(e,t,a){var o=void 0;if(o=n.checkForRetryCommandOnPropsUpdated(e,a.draftState,!1))return o;var r=t.draftState,i=a.draftState,s=t.selectedComment,d=a.selectedComment;return(o=n.checkForDiscard(e,r,i,s,d))||(o=n.checkForHalfPaneFullTransition(e,t,a))?o:e.isFocusWithinPane()?(o=n.checkForLowFidelityWarning(e,s,d))||(o=n.checkForSelectionChange(e,i,s,d))||(o=n.checkForCardPendingChange(e,t.cardViewStates,a.cardViewStates,i))||(o=n.checkForReplyFinished(e,d,t.draftState,a.draftState,d&&a.cardViewStates[d.selectedCardId]))?o:n.checkForLowFidelityWarning(e,s,d):void 0}),this.commandExecutor),this.discreteCommentCardRootRefMounted=function(e){},this.discreteCommentCardPropsUpdated=qe((function(){return n.commentStore}),this.commandExecuteCallback,this.commandOnWillFocusCallback,(function(e,t,a){var o=void 0;return(o=n.checkForRetryCommandOnDiscreteCardPropsUpdated(e,a))||(o=n.checkForDiscard(e,t.draftState,a.draftState,t.selectedState,a.selectedState))?o:e.isFocusWithinAny(ze.a.Card)||e.isFocusWithinAny(ze.a.DraftCard)?n.shouldFocusFromCardPendingStateChange(t.cardState,a.cardState)?Object(He.a)(void 0,{renderContextType:e.componentTreeId.renderContextType,componentType:Object(Be.b)(a.isDraftThread),id:a.threadId}):(o=n.checkForLowFidelityWarning(e,t.selectedState,a.selectedState))||(o=n.checkForSelectionChange(e,a.draftState,t.selectedState,a.selectedState))||(o=n.checkForReplyFinished(e,a.selectedState,t.draftState,a.draftState,a.cardState))?o:n.checkForLowFidelityWarning(e,t.selectedState,a.selectedState):void 0}),this.commandExecutor),this.paneContainerKeyDown=Qe((function(){return n.commentStore}),this.isRTL,(function(e){return!!Object(Me.b)(e.componentTreeId.renderContextType)||(Object(l.k)().assertConditionTag(!1,"paneContainerKeyDownHandler called outside of a pane render context",575239244),!1)}),{Escape:{handler:function(e,t){return Object(Le.a)(e,ye.requestClosePane({renderContextType:t.componentTreeId.renderContextType,trackback:s.d.reserveTag(575239245),telemetryVisitor:n.telemetryVisitor}))},phase:Ce.a.Capturing},Tab:{handler:function(e,t){return n.paneContainerTabHandling(e,t)},phase:Ce.a.None}},this.commandExecutor),this.commentEditorKeyDown=Qe((function(){return n.commentStore}),this.isRTL,(function(){return!0}),{F12:{handler:function(e,t){var a=e.altKey?n.handleMoveFocusEvent(e,t):void 0;return a&&(a.stopPropagation=!0),a},phase:Ce.a.None}},this.commandExecutor),this.onUserAction=qe((function(){return n.commentStore}),this.commandExecuteCallback,this.commandOnWillFocusCallback,(function(e,t){var a;switch(t.userAction){case $e.a.RequestNewCommentFromHost:if(!Object(Me.b)(e.componentTreeId.renderContextType))return;return Ye(e,n.commentStore);case $e.a.CancelReplyDraft:return Object(He.a)(void 0,{componentType:ze.a.Card,id:t.cardId,renderContextType:e.componentTreeId.renderContextType});case $e.a.DeleteThread:case $e.a.CancelNewThreadDraft:if(!Object(Me.b)(e.componentTreeId.renderContextType))return;if(e.componentTreeId.renderContextType===Ve.a.HalfPane&&t.userAction===$e.a.CancelNewThreadDraft)return;return null!==(a=Ye(e,n.commentStore,{priority:3,phase:0}))&&void 0!==a?a:n.selectionCommandFactory.focusAndSelectSiblingThread(e.componentTreeId.renderContextType,t.threadIndex);case $e.a.ResolveThread:if("android"!==Object(Ne.a)())return;return Object(He.a)(void 0,{componentType:ze.a.ReopenThreadButton,id:t.cardId,renderContextType:e.componentTreeId.renderContextType},{priorityArgs:{priority:2,phase:3}});default:Object(s.m)(t)}}),this.commandExecutor)}return e.prototype.postOnComponentFocusedRequest=function(e,t){this.clearPendingOnComponentFocusedRequest();var n=setTimeout(t,500);this.pendingOnComponentFocusedRequest={callback:t,token:n,targetedComponent:e},be.a&&Object(s.i)("Pending component focused request added for ".concat(Object(Be.d)(e),"."))},e.prototype.initialize=function(e,t,n){if(this._commentStore)throw new N.a("FocusManager already initialized",s.d.reserveTag(575239239),-2130957489);this._commentStore=e,this.selectionCommandFactory=null!=n?n:new ct(e,this.telemetryVisitor,t)},Object.defineProperty(e.prototype,"commentStore",{get:function(){if(!this._commentStore)throw new N.a("FocusManager not initialized",s.d.reserveTag(575239240),-2130957490);return this._commentStore},enumerable:!1,configurable:!0}),e.prototype.setDeferredActiveEditorFocusCommand=function(e){this.draftToFocus={draftId:e,timestamp:Date.now(),isPendingSetFocus:!0}},e.prototype.handleFocusRetry=function(e,t,n,a){var o;if(o=this.checkForRetryOfEditorFocus(e,n))return o;if(this.focusToRetry&&t){var r=this.focusToRetry.command.component,i=Date.now()-this.focusToRetry.timestamp;if(i>15e3)return Object(l.k)().assertConditionTag(!1,"Took too long to mount component type ".concat(r.componentType," for focus retry: ").concat(i," ms"),575239241),void(this.focusToRetry=void 0);if(this.shouldRetryFocusForPhase(this.focusToRetry,a)&&Object(ze.b)(r,t)){var s=this.focusToRetry.command;return this.focusToRetry=void 0,s}}},e.prototype.shouldArrowNavigatePosts=function(e,t,n){return Object(Fe.a)(e.selectedCardId,t,n.componentTreeId.renderContextType)!==we.a.Collapsed&&(e.selectedCardId!==Object(_e.G)(xe.h(this.commentStore.getState()))&&n.isFocusWithinAny(ze.a.Post))},e.prototype.onDownKey=function(e,t,n){var a=b.p()&&!De.a(this.commentStore.getState()),o=xe.t(this.commentStore.getState()),r=xe.j(this.commentStore.getState());if(o){if(!this.shouldArrowNavigatePosts(o,r,t)){if(t.componentTreeId.renderContextType===Ve.a.DiscreteIsolated)return;var i={direction:D.d.Next,source:Te.a.SharedComments,expandCard:!1,restrictToCurrentContext:!0,iterableContentTypes:void 0};return this.selectionCommandFactory.selectNextOrPreviousThread(e,i,D.c.Keyboarding,t.componentTreeId.renderContextType,a)}return this.selectionCommandFactory.selectNextPostWithinCard(e,t.componentTreeId.renderContextType,n)}if(t.componentTreeId.renderContextType!==Ve.a.DiscreteIsolated)return this.selectionCommandFactory.selectFirstThreadInCurrentContext(e,!1,Te.a.SharedComments,t.componentTreeId.renderContextType,a);Object(l.k)().assertConditionTag(!1,"selectedComment missing on down key handler for DiscreteIsolated card",575239249)},e.prototype.onUpKey=function(e,t,n){var a=b.p()&&!De.a(this.commentStore.getState()),o=xe.t(this.commentStore.getState()),r=xe.j(this.commentStore.getState());if(o){if(!this.shouldArrowNavigatePosts(o,r,t)){if(t.componentTreeId.renderContextType===Ve.a.DiscreteIsolated)return;var i={direction:D.d.Previous,source:Te.a.SharedComments,expandCard:!1,restrictToCurrentContext:!0,iterableContentTypes:void 0};return this.selectionCommandFactory.selectNextOrPreviousThread(e,i,D.c.Keyboarding,t.componentTreeId.renderContextType,a)}return this.selectionCommandFactory.selectPreviousPostWithinCard(e,t.componentTreeId.renderContextType,n)}if(t.componentTreeId.renderContextType!==Ve.a.DiscreteIsolated)return this.selectionCommandFactory.selectFirstThreadInCurrentContext(e,!1,Te.a.SharedComments,t.componentTreeId.renderContextType,a);Object(l.k)().assertConditionTag(!1,"selectedComment missing on up key handler for DiscreteIsolated card",575239250)},e.prototype.onRightKey=function(e,t){var n=xe.t(this.commentStore.getState());if(!b.W()||!n||n.selectedCardId!==Object(_e.G)(xe.h(this.commentStore.getState()))){var a=this.selectionCommandFactory.selectRootPostOfSelectedThread(e,t.componentTreeId.renderContextType);return a||(n&&Object(ke.j)(n.selectionDetails)&&t.isFocusOn({componentType:ze.a.Card,id:n.selectedCardId,renderContextType:t.componentTreeId.renderContextType})&&(a=this.focusCommentPostCommand.processCommand(t,n.selectionDetails.selectedPostId)),a||void 0)}},e.prototype.onLeftKey=function(e,t){return this.selectionCommandFactory.focusAndCollapseSelectedThread(e,t)},e.prototype.onTabKeyInPane=function(e,t){var n=xe.t(this.commentStore.getState());return void 0!==n&&Object(Ie.b)(this.commentStore.getState(),n.selectedCardId)||!xe.m(this.commentStore.getState())?b.W()?void 0:this.checkForActiveEditorFocus(e,t,xe.h(this.commentStore.getState())):this.selectionCommandFactory.selectFirstThreadInCurrentContext(e,!1,Te.a.SharedComments,t,!1)},e.prototype.isDraftInOtherContext=function(){var e=xe.v(this.commentStore.getState());return!!e&&!e.isInCurrentContext},e.prototype.logEditorRetryError=function(e,t,n,o){var r,i,s;null===(i=(r=Object(l.k)()).logDiagnosticTrace)||void 0===i||i.call(r,Object(he.a)(Xe||(Xe=Object(a.__makeTemplateObject)(["CommentsEditorFocusRetry"],["CommentsEditorFocusRetry"]))),o,l.h.Info,l.c.ProductServiceUsage,this.telemetryVisitor,Object(l.o)("RenderContextType",t.componentTreeId.renderContextType,l.d.SystemMetadata),Object(l.o)("IsDraftInCurrentContext",!!e&&e.isInCurrentContext,l.d.SystemMetadata),Object(l.o)("DraftRenderContextType",null!==(s=null==e?void 0:e.renderContextType)&&void 0!==s?s:Ve.a.None,l.d.SystemMetadata),Object(l.o)("ComponentType",null!=n?n:0,l.d.SystemMetadata))},e.prototype.checkForRetryOfEditorFocus=function(e,t){var n=this;if(void 0!==this.draftToFocus){if(!this.draftToFocus.isPendingSetFocus)return{causedBy:void 0,type:Ze.a.PreserveFocus,priorityArgs:{priority:1}};var o=t.drafts[this.draftToFocus.draftId],r=Date.now()-this.draftToFocus.timestamp;if(r>15e3)return Object(l.k)().assertConditionTag(!1,"Took too long to focus draft editor: ".concat(r," ms, expected draft still exists: ").concat(!!o),575239251),this.draftToFocus=void 0,void this.logEditorRetryError(o,e,void 0,s.d.reserveTag(556607431));if(o&&o.renderContextType===e.componentTreeId.renderContextType){var i=this.checkForActiveEditorFocus(void 0,e.componentTreeId.renderContextType,t,{priority:2,phase:0});if(i&&We(e,i.component))return this.draftToFocus=Object(a.__assign)(Object(a.__assign)({},this.draftToFocus),{isPendingSetFocus:!1}),setTimeout((function(){return n.draftToFocus=void 0})),this.clearPendingOnComponentFocusedRequest(),i;this.logEditorRetryError(o,e,null==i?void 0:i.component.componentType,s.d.reserveTag(556794947))}else this.logEditorRetryError(o,e,void 0,s.d.reserveTag(556794945))}},e.prototype.checkForActiveEditorFocus=function(e,t,n,a){if(void 0===a&&(a={priority:1}),!this.isDraftInOtherContext()){var o=Object(_e.J)(n);if(o)return Object(He.a)(e,{componentType:ze.a.PostEditor,id:o,renderContextType:t},{priorityArgs:a});var r=Object(_e.I)(n);return r?Object(He.a)(e,{componentType:ze.a.CardEditor,id:r,renderContextType:t},{priorityArgs:a}):void 0}},e.prototype.handleMoveFocusEvent=function(e,t){var n=xe.t(this.commentStore.getState()),a=n?{contentId:null==n?void 0:n.selectedCardId,contentType:p.b.CommentThread}:void 0;return Object(Le.a)(e,ye.moveFocusToCanvas({renderContextType:t.componentTreeId.renderContextType,trackback:s.d.reserveTag(575239252),telemetryVisitor:this.telemetryVisitor},a))},e.prototype.checkForCommentSelectionFocus=function(e,t,n){if(b.W()||!this.isDraftInOtherContext())return t&&t.selectedCardId?Object(He.a)(void 0,{componentType:Object(Be.c)(t.selectedCardId,n),id:t.selectedCardId,renderContextType:e},{priorityArgs:{priority:2,phase:1}}):void 0},e.prototype.checkForDiscard=function(e,t,n,a,o){if("web"!==Object(Ne.a)()&&a&&o){var r=a.selectionDetails,i=o.selectionDetails;if(Object(je.j)(t)&&!Object(je.c)(n))return this.focusCommentCardCommand.processCommand(e,o.selectedCardId);if(Object(ke.j)(r)===Object(ke.j)(i)&&a.selectedCardId===o.selectedCardId&&Object(je.m)(t,n)){if(!Object(ke.j)(r)||!Object(ke.j)(i))return Object(He.a)(void 0,{componentType:ze.a.CardEditor,id:o.selectedCardId,renderContextType:e.componentTreeId.renderContextType},{priorityArgs:{priority:3,phase:1}});if(r.selectedPostId===i.selectedPostId)return Object(He.a)(void 0,{componentType:ze.a.PostEditor,id:i.selectedPostId,renderContextType:e.componentTreeId.renderContextType},{priorityArgs:{priority:3,phase:1}})}}},e.prototype.paneContainerTabHandling=function(e,t){if("win32"!==Object(Ne.a)()){var n=this.commentStore.getState(),a=xe.p(n).virtualized;if(!Object(Oe.a)(xe.q(n),a,!!Ee.g(n)))return(c=Object(He.a)(e,{componentType:ze.a.ClosePaneButton})).stopPropagation=!0,c.preventDefault=!0,c;var o=t.getComponent(ze.a.ClosePaneButton),r=t.getComponent(ze.a.NewCommentButton),i=!xe.p(n).newThread||!r?o:r;if(b.j()){var s=xe.t(n),d=xe.h(n),c=void 0;return s&&Object(Ie.b)(n,s.selectedCardId)?b.W()||t.isFocusWithin({componentType:Object(Be.c)(s.selectedCardId,d),id:s.selectedCardId,renderContextType:t.componentTreeId.renderContextType})||(c=this.checkForActiveEditorFocus(e,t.componentTreeId.renderContextType,d)):i&&e.isEventTarget(i)&&!e.shiftKey&&(c=this.onTabKeyInPane(e,t.componentTreeId.renderContextType)),c&&(c.stopPropagation=!0,c.preventDefault=!0),c}if(o&&e.isEventTarget(o)&&e.shiftKey)return(c=this.onTabKeyInPane(e,t.componentTreeId.renderContextType))&&(c.preventDefault=!0,c.stopPropagation=!0),c;if(i&&e.isEventTarget(i)&&!e.shiftKey)return(c=this.onTabKeyInPane(e,t.componentTreeId.renderContextType))&&(c.preventDefault=!0,c.stopPropagation=!0),c}},e.prototype.checkForSelectionChange=function(e,t,n,a){if(a&&((!n||Object(ke.b)(n)!==Object(ke.b)(a)||Object(ke.j)(n.selectionDetails)!==Object(ke.j)(a.selectionDetails))&&(this.clearPendingOnComponentFocusedRequest(),(b.W()||!Object(je.d)(t))&&!e.isFocusOn({componentType:ze.a.NextCommentButton})&&!e.isFocusOn({componentType:ze.a.PreviousCommentButton})))){if(!Object(ke.j)(a.selectionDetails)){if(e.isFocusOnOrWithin({componentType:a.selectedCardId!==(null==n?void 0:n.selectedCardId)?Object(Be.c)(a.selectedCardId,t):ze.a.CardEditor,id:a.selectedCardId,renderContextType:e.componentTreeId.renderContextType},!0))return;return this.focusCommentCardCommand.processCommand(e,a.selectedCardId)}if(!e.isFocusOnOrWithin({componentType:ze.a.Post,id:a.selectionDetails.selectedPostId,renderContextType:e.componentTreeId.renderContextType}))return this.focusCommentPostCommand.processCommand(e,a.selectionDetails.selectedPostId)}},e.prototype.checkForReplyFinished=function(e,t,n,a,o){var r=Object(_e.I)(n),i=Object(_e.I)(a);if(o&&o.pending!==Se.a.Editor)return r&&!i&&(null==t?void 0:t.selectedCardId)===r&&e.isFocusWithin({componentType:ze.a.Card,id:r,renderContextType:e.componentTreeId.renderContextType})?this.focusCommentCardCommand.processCommand(e,r):void 0},e.prototype.checkForHalfPaneFullTransition=function(e,t,n){if(e.componentTreeId.renderContextType===Ve.a.HalfPane&&Object(ve.b)(n.displayConfigurationState)&&n.displayConfigurationState.displayMode===ve.a.Normal&&(!Object(ve.b)(t.displayConfigurationState)||t.displayConfigurationState.displayMode===ve.a.Variable))return Object(He.a)(void 0,{componentType:ze.a.ClosePaneButton})},e.prototype.shouldFocusFromCardPendingStateChange=function(e,t){return!!e&&(e.pending!==t.pending&&t.pending!==Se.a.Editor)},e.prototype.checkForCardPendingChange=function(e,t,n,a){var o=this,r=Object.entries(n).find((function(e){var n=t[e[0]];return o.shouldFocusFromCardPendingStateChange(n,e[1])}));if(r)return Object(He.a)(void 0,{renderContextType:e.componentTreeId.renderContextType,componentType:Object(Be.c)(r[0],a),id:r[0]})},e.prototype.checkForRetryCommandOnPropsUpdated=function(e,t,n){var a=!n&&this.focusToRetry&&this.shouldRetryFocusForPhase(this.focusToRetry,2)&&We(e,this.focusToRetry.command.component)?this.focusToRetry.command.component:void 0;return this.handleFocusRetry(e,a,t,2)},e.prototype.checkForRetryCommandOnDiscreteCardPropsUpdated=function(e,t){var n=this.focusToRetry&&this.shouldRetryFocusForPhase(this.focusToRetry,2)&&(!Object(ze.c)(this.focusToRetry.command.component)||!Object(ze.d)(this.focusToRetry.command.component.componentType)||this.focusToRetry.command.component.id===t.threadId),a=this.draftToFocus&&(t.cardRelativeDraftingState===Pe.a.InCard||t.cardRelativeDraftingState===Pe.a.InChildPost);if(n||a)return this.checkForRetryCommandOnPropsUpdated(e,t.draftState,!n)},e.prototype.checkForLowFidelityWarning=function(e,t,n){if(n&&(b.j()?Object(ke.h)(n):Object(ke.g)(n))){var a=t?Object(ke.b)(t):void 0,o=Object(ke.b)(n);if(o!==a||n.selectionDetails.lowFidelityWarningType!==(null==t?void 0:t.selectionDetails.lowFidelityWarningType))return Object(He.a)(void 0,{componentType:ze.a.Post,renderContextType:e.componentTreeId.renderContextType,id:o})}},e.prototype.shouldRetryFocusForPhase=function(e,t){return 1!==e.command.priorityArgs.priority&&0!=(e.command.priorityArgs.phase&t)},e}(),mt=n(194),ut=n(586),pt=function(){return function(e){return function(t){return Object(_.unstable_batchedUpdates)((function(){return e(t)}))}}},ft=function(){return function(e){return function(t){var n="string"==typeof t.type?t.type:t.name||"Unknown Action",a=Object(s.k)(s.b.Redux,n),o=e(t);return null==a||a.end(),o}}},gt=n(313),ht=n(487),Ct=n(175),vt=n(310),bt=n(1005),yt=n(314),Tt=n(474);!function(e){e[e.None=0]="None",e[e.AtMentionKnown=1]="AtMentionKnown",e[e.AtMentionEnabled=2]="AtMentionEnabled",e[e.NewThread=4]="NewThread",e[e.Resolve=8]="Resolve",e[e.Virtualized=16]="Virtualized",e[e.TasksKnown=32]="TasksKnown",e[e.TasksEnabled=64]="TasksEnabled",e[e.PresentLinkToComment=128]="PresentLinkToComment",e[e.UIAAnnotationPattern=256]="UIAAnnotationPattern",e[e.ContentExtensionHostingDisabled=512]="ContentExtensionHostingDisabled"}(Je||(Je={}));var It=n(384),Ot=n(184);function _t(e,t){for(var n=null==t?void 0:t(),a=[],o=0,r=void 0;o<e.length;){if(e[o].type===Ot.a.Thread){var i=e[o].id;r=i,a.push(St(i,void 0,n))}else a.push(St(e[o].id,r,n));o++}return a}function St(e,t,n){var o=void 0;return n&&(o=Object(Ae.b)(Object(Ae.a)(n),e)),o||Object(a.__assign)(Object(a.__assign)({},Object(_e.e)(e)),{parentId:null!=t?t:""})}var jt,kt=n(317),xt=n(318),Et=n(381),Dt=n(382);function At(e,t){var n=Object(ht.c)(e);if(n)return n;Object(l.k)().assertConditionTag(!1,"immerDraft does not have original state",t)}function wt(e,t,n){var a=!1;if(Object(tt.a)(t)){var o=void 0===n;if(n){var r=function(e,t,n){if(n.insertFlatIndex<0)return{insertThreadIndex:-1};for(var a=!!(null==n?void 0:n.draftIdToSkip)||void 0,o=0,r=0;r<e.length;r++){if(o===n.insertFlatIndex)return{insertThreadIndex:r,beforeDraft:a};if(e[r]!==n.draftIdToSkip){if(o+=t[e[r]].length,n.insertFlatIndex<=o)return{insertThreadIndex:r+1,beforeDraft:a}}else a=!1}if(o===n.insertFlatIndex)return{insertThreadIndex:e.length,beforeDraft:a};return{insertThreadIndex:-1}}(e.commentThreadIds,e.cardPostIds,n);a=!!r.beforeDraft,r.insertThreadIndex>=0?e.commentThreadIds.splice(r.insertThreadIndex,0,t.commentId):(Object(l.k)().assertConditionTag(!1,"Invalid thread insert flat index.",512508103),o=!0)}o&&e.commentThreadIds.push(t.commentId),e.cardPostIds[t.commentId]=[t.commentId]}else{if(!e.cardPostIds[t.parentId])return void Object(l.k)().assertConditionTag(!1,"Orphaned post detected on processing comments array. Omitting storing data.",526242826);if(n){var i=function(e,t,n,a){for(var o=!!a||void 0,r=0,i=0;i<t.length;i++){if(t[i]===e)return{flatIndex:r,beforeDraft:o};t[i]!==a?r+=n[t[i]].length:o=!1}return{flatIndex:-1}}(t.parentId,e.commentThreadIds,e.cardPostIds,n.draftIdToSkip);a=!!i.beforeDraft;var s=n.insertFlatIndex-i.flatIndex;Object(l.k)().assertConditionTag(s>=1&&s<=e.cardPostIds[t.parentId].length,"Invalid insert post index.",520646683),s=Math.max(Math.min(s,e.cardPostIds[t.parentId].length),1),e.cardPostIds[t.parentId].splice(s,0,t.commentId)}else e.cardPostIds[t.parentId].push(t.commentId)}e.postData[t.commentId]=t,(null==n?void 0:n.draftIdToSkip)&&e.createdCommentLie&&a&&e.createdCommentLie.flatIndex++}function Pt(e,t){var n=At(e,s.d.reserveTag(524031042));if(n){var a,o;if(e.draftState.pendingDraft)switch(e.draftState.pendingDraft.sessionType){case"REPLY":if(a=e.draftState.pendingDraft.threadId,!n.cardViewState[a])return;break;case"EDIT":if(o=e.draftState.pendingDraft.commentId,!n.postViewState[o])return;break;default:return}else{var r=_e.K(e.draftState);if(!r||!r.isInCurrentContext)return;switch(r.commentDraft.sessionConfiguration.sessionType){case"REPLY":a=r.threadId;break;case"EDIT":o=r.commentDraft.sessionConfiguration.commentId;break;default:return}}a&&!e.cardViewState[a]?(Vt(e.draftState,a),Object(Dt.b)(n.draftState,e.draftState,3,t,s.d.reserveTag(526242828))):o&&!e.postViewState[o]&&(Ft(e.draftState,o),Object(Dt.b)(n.draftState,e.draftState,2,t,s.d.reserveTag(526242829)))}}function Rt(e,t,n,a){var o,r,i=At(e,s.d.reserveTag(524031047));if(i&&function(e,t){return!(!(e&&e.commentFlags&rt.a.Resolved&&t)||t.commentFlags&rt.a.Resolved)}(t,n)&&(e.selectedComment&&e.selectedComment.selectedCardId===t.commentId&&(Object(ke.j)(e.selectedComment.selectionDetails)||void 0!==e.selectedComment.selectionDetails.lowFidelityWarningType)&&(e.selectedComment.selectionDetails=_e.l()),t.commentId===(null===(o=_e.K(e.draftState))||void 0===o?void 0:o.threadId)&&(!function(e,t,n){Vt(e,n);var a=_e.J(e);if(a){var o=e.postIdToDraftIdMap[a],r=e.drafts[o];r&&r.threadId===n&&Ft(e,a)}if(e.pendingDraft&&Object(yt.e)(e.pendingDraft)){var i=e.pendingDraft.commentId,s=t[i];s&&Object(tt.b)(s)===n&&(e.pendingDraft=void 0)}}(e.draftState,e.postData,t.commentId),Object(Dt.b)(i.draftState,e.draftState,1,a,s.d.reserveTag(526242836))),(null===(r=i.cardViewState[t.commentId])||void 0===r?void 0:r.loadState.state)===xt.a.Loaded)){var d=_e.U(t.commentId,e.expandedComments,e.draftState,e.selectedComment);d!==e.expandedComments&&(e.expandedComments=d)}}function Vt(e,t){e.pendingDraft&&Object(yt.f)(e.pendingDraft)&&e.pendingDraft.threadId===t&&(e.pendingDraft=void 0);var n=e.cardIdToDraftIdMap[t];n&&(Nt(e,n),delete e.cardIdToDraftIdMap[t])}function Ft(e,t){e.pendingDraft&&Object(yt.e)(e.pendingDraft)&&e.pendingDraft.commentId===t&&(e.pendingDraft=void 0);var n=e.postIdToDraftIdMap[t];n&&(Nt(e,n),delete e.postIdToDraftIdMap[t])}function Nt(e,t){e.drafts[t]?(Object(l.k)().assertConditionTag(1===Object.keys(e.drafts).length,"Invalid number of drafts",526131555),delete e.drafts[t]):Object(l.k)().assertConditionTag(0===Object.keys(e.drafts).length,"Invalid draftId",526131554)}function Mt(e,t,n){var o,r,i=n,d=t.model.parentId;if(d&&(e.cardViewState[d]?e.cardViewState[d].pending=Se.a.None:null===(r=null===(o=Object(l.k)())||void 0===o?void 0:o.logDiagnosticTrace)||void 0===r||r.call(o,Object(he.a)(jt||(jt=Object(a.__makeTemplateObject)(["Inserting orphaned reply without root post?"],["Inserting orphaned reply without root post?"]))),s.d.reserveTag(520646684),l.h.Warning,l.c.ProductServiceUsage,Object(l.l)(l.g.ReviewedAsNotNecessary))),t.tempId){if(delete e.cardViewState[t.tempId],delete e.postViewState[t.tempId],e.draftState.committedLieId===t.tempId){var c=e.commentThreadIds.findIndex((function(e){return t.tempId===e}));c<0?Object(l.k)().assertConditionTag(!1,"ThreadId to delete not found",520646688):(e.commentThreadIds.splice(c,1),delete e.cardPostIds[t.tempId]),delete e.postData[t.tempId],e.createdCommentLie=void 0,e.draftState.committedLieId=void 0,i=void 0}if(e.selectedComment&&e.selectedComment.selectedCardId===t.tempId)if(e.selectedComment=_e.m(Object(tt.b)(t.model)),t.model.parentId)e.expandedComments.findIndex((function(e){return t.tempId===e}))>=0&&(e.expandedComments=_e.U(t.tempId,e.expandedComments,e.draftState,e.selectedComment));else e.expandedComments=_e.a(e.expandedComments,e.selectedComment,e.draftState)}Object(l.k)().assertConditionTag(!e.postViewState[t.model.commentId],"Received insert for existing comment",522856031),d||(e.cardViewState[t.model.commentId]=_e.i(t.tempId||void 0)),e.postViewState[t.model.commentId]=_e.k(t.model.displayDate),wt(e,t.model,{insertFlatIndex:t.index,draftIdToSkip:i})}function Lt(e,t){var n=At(e,s.d.reserveTag(522856032));if(n){var a=e.postData[t.model.commentId],o=n.modelCapabilities.virtualized;if(a){e.postData[t.model.commentId]=t.model;var r=Object(tt.b)(t.model),i=e.cardViewState[r];i?(e.cardViewState[r].pending=Se.a.None,i.loadState.state!==xt.a.Loading&&o||(e.cardViewState[r].loadState={state:xt.a.Loaded})):(Object(l.k)().assertConditionTag(!1,"Received Modify change without existing card state? Creating default.",522856033),e.cardViewState[r]=_e.i(void 0,o?xt.a.Placeholder:void 0)),e.postViewState[t.model.commentId]?a.displayDate===t.model.displayDate&&a.date===t.model.date||(e.postViewState[t.model.commentId].displayDate=_e.o(t.model.date,t.model.displayDate,e.localizationDetails.dataCulture),e.postViewState[t.model.commentId].pending=Et.a.None):e.postViewState[t.model.commentId]=_e.k(_e.o(t.model.date,t.model.displayDate,e.localizationDetails.dataCulture)),Rt(e,e.postData[t.model.commentId],a,2)}else Object(l.k)().assertConditionTag(!1,"change commentId not found in postData",522856034),Object(s.i)("change commentId not found in postData ".concat(t.model.commentId))}}function Ht(e,t,n){var a,o,r,i=e.postData[t.model.commentId];if(i){var s=-1,d=0;if(Object(tt.a)(i))(s=e.commentThreadIds.findIndex((function(e){return i.commentId===e})))<0?Object(l.k)().assertConditionTag(!1,"ThreadId to delete not found",520646687):e.commentThreadIds.splice(s,1),d=null!==(o=null===(a=e.cardPostIds[i.commentId])||void 0===a?void 0:a.length)&&void 0!==o?o:0,e.cardPostIds[i.commentId].forEach((function(t){delete e.postData[t]})),delete e.cardPostIds[i.commentId];else{if(Object(l.k)().assertConditionTag(void 0!==e.cardPostIds[i.parentId],"Orphaned reply delete received",520646686),s=e.commentThreadIds.findIndex((function(e){return i.parentId===e})),e.cardPostIds[i.parentId]){var c=e.cardPostIds[i.parentId].findIndex((function(e){return i.commentId===e}));c<0?Object(l.k)().assertConditionTag(!1,"PostID to delete not found",520646685):(d=1,e.cardPostIds[i.parentId].splice(c,1))}delete e.postData[t.model.commentId]}if(n&&void 0!==(null===(r=e.createdCommentLie)||void 0===r?void 0:r.flatIndex)&&s>=0)s<e.commentThreadIds.findIndex((function(e){return e===n}))&&(e.createdCommentLie.flatIndex-=d)}if(e.highlightedCommentId===t.model.commentId&&(e.highlightedCommentId=void 0),e.topVisibleThreadId===t.model.commentId&&(e.topVisibleThreadId=void 0),delete e.cardViewState[t.model.commentId],delete e.postViewState[t.model.commentId],t.model.commentId===e.selectedThreadIdBeforeCommentSession&&i){var m=e.commentThreadIds.length;m?t.index>=e.commentThreadIds.length?e.selectedThreadIdBeforeCommentSession=e.commentThreadIds[m-1]:e.selectedThreadIdBeforeCommentSession=e.commentThreadIds[t.index]:e.selectedThreadIdBeforeCommentSession=void 0}}function Ut(e,t,n,o){var r,i,s,d,c;if(b.b()&&n.tasks){var l=!1,m={},u={},p=new Set,f=Object.keys(e);n.comments.forEach((function(e){""===e.parentId&&p.add(e.commentId)}));try{for(var g=Object(a.__values)(f),h=g.next();!h.done;h=g.next()){var C=h.value;if(!p.has(C)){l=!0;break}}}catch(e){r={error:e}}finally{try{h&&!h.done&&(i=g.return)&&i.call(g)}finally{if(r)throw r.error}}f.length!==(null===(c=n.tasks)||void 0===c?void 0:c.length)&&(l=!0);try{for(var v=Object(a.__values)(n.tasks),y=v.next();!y.done;y=v.next()){var T=y.value;l=zt(t,u,T,o)||l,m[T.commentId]=Gt(T)}}catch(e){s={error:e}}finally{try{y&&!y.done&&(d=v.return)&&d.call(v)}finally{if(s)throw s.error}}if(l)return{updatedTasks:m,updatedHistoryRecordViewState:u}}}function Bt(e,t,n,o){if(b.b()){var r=Object(a.__assign)({},e),i=Object(a.__assign)({},t),s=!1;if(n.changes.forEach((function(n){if(n.type!==Ct.d.Unknown){var a=n.model.commentId;switch(n.type){case Ct.d.Delete:if(delete r[a],void 0!==e[a])Object.keys(e).includes(a)&&(Wt(i,e[a],void 0),s=!0);break;case Ct.d.Load:case Ct.d.Insert:case Ct.d.Modify:Object(l.k)().assertConditionTag(n.type===Ct.d.Modify||!r[a],"Task should not already be populated on initial load",554836097);var d=n.task;if(d)s=zt(t,i,d,o)||s||!r[a]||!function(e,t){if(e.completion!==t.completion||e.title!==t.title||e.isLossy!==t.isLossy||e.priority!==t.priority||e.schedule.dueDate!==t.schedule.dueDate||e.schedule.startDate!==t.schedule.startDate||e.assignees.length!==t.assignees.length)return!1;for(var n=0;n<e.assignees.length;n++)if(!Object(se.l)(e.assignees[n],t.assignees[n]))return!1;return!0}(r[a].currentState,d.currentState),r[a]=Gt(d);else if(""===n.model.parentId&&r[a]){var c=r[a];Wt(i,c,void 0),delete r[a],s=!0}}}else Object(l.k)().assertConditionTag(!1,"Unknown change type",554836096)})),s)return{updatedTasks:r,updatedHistoryRecordViewState:i}}}function zt(e,t,n,o){var r,i,s,d;if(0===n.history.length)return!0;var c=!1,l=e&&Object.keys(e).length>0,m=l?new Set:void 0;try{for(var u=Object(a.__values)(n.history),p=u.next();!p.done;p=u.next()){var f=p.value;try{for(var g=(s=void 0,Object(a.__values)(f.records)),h=g.next();!h.done;h=g.next()){var C=h.value;null==m||m.add(C.recordId);var v=ot.a(n.id,C.recordId);e[v]?t[v]=e[v]:(c=!0,t[v]=Object(_e.t)(Object(_e.o)(C.time,C.displayTime,o.dataCulture)))}}catch(e){s={error:e}}finally{try{h&&!h.done&&(d=g.return)&&d.call(g)}finally{if(s)throw s.error}}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}if(l){var b=Wt(t,n,m);c=c||b}return c}function Wt(e,t,n){var o,r,i,s,d=!1;try{for(var c=Object(a.__values)(t.history),l=c.next();!l.done;l=c.next()){var m=l.value;try{for(var u=(i=void 0,Object(a.__values)(m.records)),p=u.next();!p.done;p=u.next()){var f=p.value;n&&n.has(f.recordId)||(delete e[ot.a(t.id,f.recordId)],d=!0)}}catch(e){i={error:e}}finally{try{p&&!p.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}}}catch(e){o={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(o)throw o.error}}return d}function Gt(e){var t,n,o,r,i=Object(a.__assign)({},e),s=[];try{for(var d=Object(a.__values)(e.history),c=d.next();!c.done;c=d.next()){var l=c.value,m=Object(a.__assign)({},l);m.taskId||(m.taskId=e.id);var u=[];try{for(var p=(o=void 0,Object(a.__values)(l.records)),f=p.next();!f.done;f=p.next()){var g=f.value;u.push(Object(a.__assign)({},g))}}catch(e){o={error:e}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(o)throw o.error}}m.records=u,s.push(m)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}return i.history=s,i}function Yt(e){if(e){var t={};if(void 0!==e.isReadOnly&&(t.isReadOnly=e.isReadOnly),void 0!==e.nextPopulatedContextDetails&&(t.nextPopulatedContextDetails=e.nextPopulatedContextDetails),void 0!==e.commentThreadCounts&&(t.commentThreadCounts=e.commentThreadCounts||void 0),Object.keys(t).length)return t}}var Kt=n(488),qt=function(e){for(var t=[],n=0;n<e.length;++n)t.push(e[n]);return t};function Qt(e){return Zt(Object(ze.c)(e)?Object(Be.a)(e):Object(Be.e)(e.componentType))}function Xt(e){var t=document.activeElement;return!!e&&t===e}function Jt(e,t,n){var a=document.activeElement,o=t!==ze.a.CardEditor&&t!==ze.a.PostEditor&&!n;return!!e&&(a&&e.contains(a)||o&&function(e){return e===document.body||null===e||0===Object.keys(e).length}(a))}function Zt(e){var t=document.getElementById(e);return null!=t?t:void 0}var $t=function(){function e(e,t,n){this.componentTreeId={renderContextType:e,contextIdentifier:t}}return e.prototype.getComponent=function(e){return Zt(Object(Be.e)(e))},e.prototype.getComponentById=function(e){return Zt(Object(Be.a)(e))},e.prototype.isEventTarget=function(e,t){return e===t},e.prototype.isFocusOn=function(e){return Xt(Qt(e))},e.prototype.isFocusWithin=function(e){return Jt(Qt(e),e.componentType)},e.prototype.isFocusOnOrWithin=function(e,t){var n=Qt(e);return Xt(n)||Jt(n,e.componentType,t)},e.prototype.isFocusWithinAny=function(e){var t=void 0;switch(e){case ze.a.Card:t=qt(document.querySelectorAll("[id*='".concat(S.i({id:"",renderContextType:this.componentTreeId.renderContextType},!1),"']")));break;case ze.a.DraftCard:t=qt(document.querySelectorAll("[id*='".concat(S.i({id:"",renderContextType:this.componentTreeId.renderContextType},!0),"']")));break;case ze.a.PostEditor:t=qt(document.querySelectorAll("[id*='".concat(S.w(S.G({id:"",renderContextType:this.componentTreeId.renderContextType})),"']")));break;case ze.a.CardEditor:t=qt(document.querySelectorAll("[id*='".concat(S.w(S.f({id:"",renderContextType:this.componentTreeId.renderContextType})),"']")));break;case ze.a.Post:t=qt(document.querySelectorAll("[id*='".concat(S.I({id:"",renderContextType:this.componentTreeId.renderContextType}),"']")))}if(t)for(var n=0;n<t.length;++n){if(Jt(t[n],e))return!0}return!1},e.prototype.isFocusWithinPane=function(){return Jt(document.getElementById(S.z()),ze.a.PaneRoot)},e.prototype.getCurrentlyFocused=function(){return this.isFocusWithinPane()?[document.activeElement]:[]},e}();function en(e,t){switch(void 0===e&&(e={extensions:{},contentNavigationSupported:!1}),void 0===t&&(t=ye.EMPTY_ACTION),t.type){case"ADD_CONTENT_EXTENSION":return function(e,t){var n;Object(l.k)().assertConditionTag(void 0===e[t.payload.extension.provider.scope.renderMode],"Attempting to register extension on surface where extension is already registered. Overwriting previous registration.",594834317);var o=t.payload.extension;return Object(a.__assign)(Object(a.__assign)({},e),{extensions:Object(a.__assign)(Object(a.__assign)({},e.extensions),(n={},n[t.payload.extension.provider.scope.renderMode]={controller:o,priority:o.priority},n))})}(e,t);case"REMOVE_CONTENT_EXTENSION":return function(e,t){var n,o,r=Object(a.__assign)({},e.extensions);try{for(var i=Object(a.__values)(t.payload.renderModes),s=i.next();!s.done;s=i.next()){var d=s.value;delete r[d]}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return Object(a.__assign)(Object(a.__assign)({},e),{extensions:r})}(e,t);case"UPDATE_EXTENSION_PRIORITY":return function(e,t){var n=Object(a.__assign)({},e.extensions);for(var o in t.payload.updates)n[o]&&(n[o]=Object(a.__assign)(Object(a.__assign)({},n[o]),{priority:t.payload.updates[o]}));return Object(a.__assign)(Object(a.__assign)({},e),{extensions:n})}(e,t);case"SET_CONTENT_NAVIGATION_ENABLEMENT":return function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{contentNavigationSupported:t.payload.isEnabled})}(e,t);default:return e}}function tn(e,t){return void 0===e&&(e=nn()),void 0===t&&(t=ye.EMPTY_ACTION),Object(ht.a)(e,(function(n){switch(t.type){case"VIEW_CONTAINER_VISIBILITY_CHANGED":return void function(e,t){void 0===e.defaultFilterId&&t.payload.visibilityState!==z.a.Closed&&(e.requestDefaultFilter=!0)}(n,t);case"LOAD_DEFAULT_FILTER":return void function(e,t){an(e,t.payload.filteredRange,!0)&&(e.defaultFilterId=t.payload.filteredRange.id);e.requestDefaultFilter=!1}(n,t);case"LOAD_FILTER":return void function(e,t){Object(l.k)().assertConditionTag(!!e.defaultFilterId,"Default filter should be loaded before new filters are loaded",528779299),an(e,t.payload.filteredRange,t.payload.shouldSetActive)}(n,t);case"SET_FILTERING_CAPABILITIES":return void function(e,t){e.filteringCapabilities=t.payload.capabilities}(n,t);case"UPDATE_FILTER_RANGE":return void function(e,t){if(Object(l.k)().assertConditionTag(t.payload.filterId.length>0,"FilterId must not be empty string",529138905),0===t.payload.changes.length||!t.payload.filterId)return;var n=e.filteredRanges[t.payload.filterId];if(!n)return void Object(l.k)().assertConditionTag(!1,"Processing update for a filter that is not found?",529138910);t.payload.changes.forEach((function(o){switch(o.type){case"FilterUpdate":if(t.payload.filterId===e.defaultFilterId){Object(l.k)().assertConditionTag(!1,"Should not attempt to update the default filter",528532106);break}Object(l.k)().assertConditionTag(n.canUpdateFilter,"Should not get into FilterUpdate if canUpdateFilter is false",528749965),n.filter=o.updatedFilter;break;case"Insert":if(o.index<0||o.index>n.order.length){Object(l.k)().assertConditionTag(!1,"Insert index out of bounds?",529138908);break}n.order=Object(a.__spreadArray)(Object(a.__spreadArray)(Object(a.__spreadArray)([],Object(a.__read)(n.order.slice(0,o.index)),!1),[o.content],!1),Object(a.__read)(n.order.slice(o.index)),!1);break;case"Reload":n.order=o.fullContent;break;case"Remove":if(o.index<0||o.index>=n.order.length){Object(l.k)().assertConditionTag(!1,"Processing Remove with index out of bounds?",529138911);break}n.order.splice(o.index,1);break;case"Teardown":t.payload.filterId===e.defaultFilterId&&(Object(l.k)().assertConditionTag(!1,"Is tearing down default filter expected?",528779328),e.defaultFilterId=void 0),t.payload.filterId===e.activeFilterId&&(Object(l.k)().assertConditionTag(!!e.defaultFilterId,"Active was removed, but no default to fallback on",528779329),e.activeFilterId=e.defaultFilterId),delete e.filteredRanges[t.payload.filterId]}}))}(n,t);default:return e}}))}function nn(){return{filteredRanges:{},filteringCapabilities:void 0,requestDefaultFilter:!1}}function an(e,t,n){return void 0!==e.filteredRanges[t.id]?(Object(l.k)().assertConditionTag(!1,"Should not load a filter with the same id as a previously loaded filter",528527825),!1):(n&&(e.activeFilterId=t.id),e.filteredRanges[t.id]={filter:t.getFilter(),order:t.getOrder(),canUpdateFilter:e.defaultFilterId!==t.id&&t.canBeUpdated()},!0)}function on(e){return Object(a.__assign)(Object(a.__assign)({},b.U()?{commentThreadIds:[],cardPostIds:{},postData:{}}:{commentData:[]}),{cardViewState:{},postViewState:{},selectedComment:void 0,expandedComments:[],pendingCommentLoad:void 0,contextState:{nextPopulatedContextDetails:et.a.Unknown,isReadOnly:!1,commentThreadCounts:void 0,lastContextChangeIncrement:0},highlightedCommentId:void 0,topVisibleThreadId:void 0,createdCommentLie:void 0,selectedThreadIdBeforeCommentSession:void 0,personaIconPropertiesMap:{},draftState:Object(je.h)(),modelCapabilities:Object(_e.s)(),localizationDetails:e,suggestionsDetails:void 0,tasks:{},historyRecordViewState:{}})}function rn(e,t,n,a){return function(e,t,n,a){return{paneState:{viewContainer:e,componentTree:new $t(Object(It.a)(e.containerType),a),visibilityState:t?z.a.Visible:z.a.Closed,initializationStatus:Kt.a.NotInitialized,viewContainerDisplayConfiguration:void 0},contentExtensions:{extensions:{},contentNavigationSupported:!1},commentState:on(n),filterState:{filteredRanges:{},filteringCapabilities:void 0,requestDefaultFilter:!1}}}(e,t,n,a)}var sn,dn={isRightToLeft:!1,dataCulture:"",uiCulture:""};function cn(e,t){void 0===e&&(e=on(dn)),void 0===t&&(t=gt.a);var n=function(e,t){switch(t.type){case"HIGHLIGHT_COMMENT":return function(e,t){var n=_e.P(t.payload.commentId);if(n===e.highlightedCommentId)return e;return Object(a.__assign)(Object(a.__assign)({},e),{highlightedCommentId:n})}(e,t);case"APPLY_COMMENT_CHANGES":return Object(Ae.e)(e)?Object(ht.a)((function(e){!function(e,t){var n,o;if(!t.payload.changes.length)return;var r,i=_e.G(e.draftState,!0);try{for(var d=Object(a.__values)(t.payload.changes),c=d.next();!c.done;c=d.next())switch((r=c.value).type===vt.b.Load&&(r=void 0!==e.postViewState[r.model.commentId]?Object(a.__assign)(Object(a.__assign)({},r),{type:vt.b.Modify}):Object(a.__assign)(Object(a.__assign)({},r),{type:vt.b.Insert})),r.type){case vt.b.Insert:Mt(e,r,i),void 0===e.createdCommentLie&&(i=void 0);break;case vt.b.Modify:Lt(e,r);break;case vt.b.Delete:Ht(e,r,i)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}Pt(e,2),e.selectedComment&&!Object(je.l)(e.draftState)&&(e.cardViewState[e.selectedComment.selectedCardId]?Object(ke.j)(e.selectedComment.selectionDetails)&&!e.postViewState[e.selectedComment.selectionDetails.selectedPostId]&&(e.selectedComment=_e.m(e.selectedComment.selectedCardId)):e.selectedComment=void 0);e.expandedComments=_e.V(e.expandedComments,e.cardViewState,e.draftState);var l=At(e,s.d.reserveTag(520646682));if(!l)return;var m=Bt(l.tasks,l.historyRecordViewState,t.payload,l.localizationDetails);(null==m?void 0:m.updatedTasks)&&(e.tasks=m.updatedTasks);(null==m?void 0:m.updatedHistoryRecordViewState)&&(e.historyRecordViewState=m.updatedHistoryRecordViewState)}(e,t)}))(e):function(e,t){var n,o,r,i,d,c,m;if(!t.payload.changes.length)return e;var u,p={commentData:Object(a.__spreadArray)([],Object(a.__read)(e.commentData),!1),cardViewState:Object(a.__assign)({},e.cardViewState),postViewState:Object(a.__assign)({},e.postViewState),highlightedCommentId:e.highlightedCommentId,topVisibleThreadId:e.topVisibleThreadId,selectedComment:e.selectedComment,expandedComments:e.expandedComments,selectedThreadIdBeforeCommentSession:e.selectedThreadIdBeforeCommentSession,draftState:e.draftState},f=e.createdCommentLie,g=!!_e.G(e.draftState,!0),h=null==f?void 0:f.flatIndex,C=e.modelCapabilities.virtualized;try{for(var v=Object(a.__values)(t.payload.changes),b=v.next();!b.done;b=v.next())if((u=b.value).type===vt.b.Load&&(u=void 0!==p.postViewState[u.model.commentId]?Object(a.__assign)(Object(a.__assign)({},u),{type:vt.b.Modify}):Object(a.__assign)(Object(a.__assign)({},u),{type:vt.b.Insert})),u.type===vt.b.Insert){if((T=u.model.parentId)&&(p.cardViewState[T]?p.cardViewState[T]=Object(a.__assign)(Object(a.__assign)({},p.cardViewState[T]),{pending:Se.a.None}):null===(d=null===(i=Object(l.k)())||void 0===i?void 0:i.logDiagnosticTrace)||void 0===d||d.call(i,Object(he.a)(sn||(sn=Object(a.__makeTemplateObject)(["Inserting orphaned reply without root post?"],["Inserting orphaned reply without root post?"]))),s.d.reserveTag(526960065),l.h.Warning,l.c.ProductServiceUsage,Object(l.l)(l.g.ReviewedAsNotNecessary))),p.commentData.splice(u.index,0,u.model),u.tempId){if(!T)(y={})[u.model.commentId]=_e.i(u.tempId),p.cardViewState=Object(a.__assign)(Object(a.__assign)({},_e.Z(p.cardViewState,u.tempId)),y);p.postViewState=Object(a.__assign)(Object(a.__assign)({},_e.Z(p.postViewState,u.tempId)),_e.y([u.model],p.expandedComments,e.localizationDetails)),p.draftState.committedLieId===u.tempId&&(p.draftState=Object(a.__assign)(Object(a.__assign)({},p.draftState),{committedLieId:void 0}),h=void 0),p.selectedComment&&p.selectedComment.selectedCardId===u.tempId&&(p.selectedComment=_e.m(Object(tt.b)(u.model)),u.model.parentId||(p.expandedComments=_e.a(p.expandedComments,p.selectedComment,p.draftState)))}else{var y;if(Object(l.k)().assertConditionTag(!p.postViewState[u.model.commentId],"Received insert for existing comment",594122589),!T)(y={})[u.model.commentId]=_e.i(void 0),p.cardViewState=Object(a.__assign)(Object(a.__assign)({},p.cardViewState),y);p.postViewState=Object(a.__assign)(Object(a.__assign)({},p.postViewState),_e.y([u.model],p.expandedComments,e.localizationDetails))}g&&void 0!==h&&u.index<=h&&h++}else if(u.type===vt.b.Modify){if((S=p.commentData[u.index]).commentId===u.model.commentId){p.commentData[u.index]=u.model;var T=Object(tt.b)(u.model),I=p.cardViewState[T];I?p.cardViewState[T]=Object(a.__assign)(Object(a.__assign)({},I),{pending:Se.a.None,loadState:I.loadState.state!==xt.a.Loading&&C?I.loadState:{state:xt.a.Loaded}}):(Object(l.k)().assertConditionTag(!1,"Received Modify change without existing card state? Creating default.",527962186),p.cardViewState[T]=_e.i(void 0,C?xt.a.Placeholder:void 0));var O=S.displayDate===u.model.displayDate&&S.date===u.model.date?p.postViewState[u.model.commentId].displayDate:_e.o(u.model.date,u.model.displayDate,e.localizationDetails.dataCulture);if(p.postViewState=Object(a.__assign)(Object(a.__assign)({},p.postViewState),((r={})[u.model.commentId]=Object(a.__assign)(Object(a.__assign)({},p.postViewState[u.model.commentId]),{pending:Et.a.None,displayDate:O}),r)),u.model.commentFlags&rt.a.Resolved&&!(S.commentFlags&rt.a.Resolved)){var _=p.draftState;p.selectedComment&&p.selectedComment.selectedCardId===u.model.commentId&&(p.selectedComment=_e.m(p.selectedComment.selectedCardId)),p.draftState=_e.S(p.draftState,u.model.commentId,p.commentData),Object(Dt.b)(_,p.draftState,1,2,s.d.reserveTag(539297114)),(null==I?void 0:I.loadState.state)===xt.a.Loaded&&(p.expandedComments=_e.U(u.model.commentId,p.expandedComments,p.draftState,p.selectedComment))}}else Object(l.k)().assertConditionTag(!1,"Found changeIndex mismatch",593762526),Object(s.i)("changeIndex did not match comment for ".concat(u.model.commentId))}else if(u.type===vt.b.Delete){var S;if((S=p.commentData[u.index]).commentId===u.model.commentId&&p.commentData.splice(u.index,1),p.highlightedCommentId===u.model.commentId&&(p.highlightedCommentId=void 0),p.topVisibleThreadId===u.model.commentId&&(p.topVisibleThreadId=void 0),p.cardViewState=_e.Z(p.cardViewState,u.model.commentId),p.postViewState=_e.Z(p.postViewState,u.model.commentId),u.model.commentId===p.selectedThreadIdBeforeCommentSession){var j=u.index;p.commentData.length?(j>=p.commentData.length&&(j=p.commentData.length-1),p.selectedThreadIdBeforeCommentSession=Object(tt.b)(p.commentData[j])):p.selectedThreadIdBeforeCommentSession=void 0}g&&void 0!==h&&u.index<h&&h--}}catch(e){n={error:e}}finally{try{b&&!b.done&&(o=v.return)&&o.call(v)}finally{if(n)throw n.error}}g&&(void 0===h?f=void 0:f&&h!==f.flatIndex&&(f=Object(a.__assign)(Object(a.__assign)({},f),{flatIndex:h})));p.draftState=_e.db(p.draftState,e.cardViewState,p.cardViewState,e.postViewState,p.postViewState,2),p.selectedComment&&!Object(je.l)(p.draftState)&&(p.cardViewState[p.selectedComment.selectedCardId]?Object(ke.j)(p.selectedComment.selectionDetails)&&!p.postViewState[p.selectedComment.selectionDetails.selectedPostId]&&(p.selectedComment=_e.m(p.selectedComment.selectedCardId)):p.selectedComment=void 0);var k=Bt(e.tasks,e.historyRecordViewState,t.payload,e.localizationDetails);return Object(a.__assign)(Object(a.__assign)({},e),{createdCommentLie:f,draftState:p.draftState,selectedComment:p.selectedComment,expandedComments:_e.V(p.expandedComments,p.cardViewState,p.draftState),commentData:p.commentData,cardViewState:p.cardViewState,postViewState:p.postViewState,highlightedCommentId:p.highlightedCommentId,topVisibleThreadId:p.topVisibleThreadId,selectedThreadIdBeforeCommentSession:p.selectedThreadIdBeforeCommentSession,tasks:null!==(c=null==k?void 0:k.updatedTasks)&&void 0!==c?c:e.tasks,historyRecordViewState:null!==(m=null==k?void 0:k.updatedHistoryRecordViewState)&&void 0!==m?m:e.historyRecordViewState})}(e,t);case"LOAD_COMMENT":return function(e,t){var n,o,r,i=e.modelCapabilities.virtualized,s=_e.Q(e,t.payload.commentData,i,!!t.payload.filteringEnabled);r=_e.j(t.payload.commentData,i?xt.a.Placeholder:xt.a.Loaded);var d=function(e,t){var n,o;if(e&&b.b()){var r={},i={};try{for(var s=Object(a.__values)(e),d=s.next();!d.done;d=s.next()){var c=d.value;zt({},i,c,t),r[c.commentId]=Gt(c)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}return{updatedTasks:r,updatedHistoryRecordViewState:i}}}(t.payload.tasks,e.localizationDetails);return Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},e),s),{cardViewState:Object(a.__assign)(Object(a.__assign)({},e.cardViewState),r),postViewState:Object(a.__assign)(Object(a.__assign)({},e.postViewState),_e.y(t.payload.commentData,s.expandedComments,e.localizationDetails)),tasks:null!==(n=null==d?void 0:d.updatedTasks)&&void 0!==n?n:e.tasks,historyRecordViewState:null!==(o=null==d?void 0:d.updatedHistoryRecordViewState)&&void 0!==o?o:e.historyRecordViewState})}(e,t);case"VIRTUALIZE_COMMENTS":return function(e,t){if(!e.modelCapabilities.virtualized)throw new N.a("virtualizeCommentsReducer requires virtualization",s.d.reserveTag(589103643),-2130957500);var n=(r=t.payload.threadInfo.map((function(e){return e.threadId})),r.map((function(e){return St(e,void 0,void 0)}))),o=_e.Q(e,n,!0,!!t.payload.filteringEnabled);var r;return Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},e),o),{cardViewState:Object(a.__assign)(Object(a.__assign)({},e.cardViewState),_e.N(t.payload.threadInfo)),postViewState:Object(a.__assign)(Object(a.__assign)({},e.postViewState),_e.y(n,o.expandedComments,e.localizationDetails))})}(e,t);case"CANCEL_COMMENT_CREATE_THREAD":return function(e,t){var n;if(!Object(je.c)(e.draftState))return e;var o,r=_e.G(e.draftState);if(!r)return e;var i=!1;(null===(n=e.selectedComment)||void 0===n?void 0:n.selectedCardId)!==r?o=e.selectedComment:e.selectedThreadIdBeforeCommentSession&&(o={selectedCardId:e.selectedThreadIdBeforeCommentSession,selectionDetails:{lowFidelityWarningType:void 0}},i=!0);var s=_e.T(e.draftState,r);return Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},e),Object(Ae.e)(e)?{commentThreadIds:_e.Y(e.commentThreadIds,r),cardPostIds:_e.Z(e.cardPostIds,r),postData:_e.Z(e.postData,r)}:{}),{createdCommentLie:void 0,selectedComment:o,expandedComments:o&&i?_e.a(e.expandedComments,o,s):_e.R(e.expandedComments,o,s),cardViewState:_e.Z(e.cardViewState,r),postViewState:_e.Z(e.postViewState,r),selectedThreadIdBeforeCommentSession:void 0,draftState:s})}(e);case"CANCEL_COMMENT_POST_EDIT":return function(e,t){var n=_e.A(e,t.payload.commentId),o=_e.ab(e.draftState,t.payload.commentId);return Object(a.__assign)(Object(a.__assign)({},e),{selectedComment:n,expandedComments:_e.R(e.expandedComments,n,o),selectedThreadIdBeforeCommentSession:void 0,draftState:o})}(e,t);case"CANCEL_COMMENT_REPLY":return function(e,t){var n=_e.T(e.draftState,t.payload.commentId);return Object(a.__assign)(Object(a.__assign)({},e),{expandedComments:_e.R(e.expandedComments,e.selectedComment,n),selectedThreadIdBeforeCommentSession:void 0,draftState:n})}(e,t);case"COLLAPSE_CARD":return function(e,t){var n=_e.K(e.draftState);if((null==n?void 0:n.threadId)===t.payload.cardId)return e;var o=_e.D(t.payload.cardId,e.selectedComment,e.draftState);return Object(a.__assign)(Object(a.__assign)({},e),{selectedComment:o,expandedComments:_e.U(t.payload.cardId,e.expandedComments,e.draftState,o)})}(e,t);case"SELECT_COMMENT":return function(e,t){var n=e.selectedComment;if(!_e.bb(e.draftState,n,t))return e;if(!t.payload.selectedCard)throw new N.a(de.d,s.d.reserveTag(589103644),-2130957536);var o=_e.gb(e.selectedComment,t),r=Object(ye.shouldSelectActionExpandCard)(t.payload.selectType)?_e.a(e.expandedComments,o,e.draftState):_e.R(e.expandedComments,o,e.draftState);return Object(a.__assign)(Object(a.__assign)({},e),{selectedComment:o,expandedComments:r})}(e,t);case"REQUEST_THREAD_RESOLVE":return function(e,t){var n;return Object(a.__assign)(Object(a.__assign)({},e),{cardViewState:Object(a.__assign)(Object(a.__assign)({},e.cardViewState),(n={},n[t.payload.commentId]=Object(a.__assign)(Object(a.__assign)({},e.cardViewState[t.payload.commentId]),{pending:Se.a.Card,loadState:{state:xt.a.Loaded}}),n)),selectedComment:_e.B(e.selectedComment,t)})}(e,t);case"RELOAD_COMMENTS":return Object(Ae.e)(e)?Object(ht.a)((function(e){!function(e,t){var n=At(e,s.d.reserveTag(524031011));if(!n)return;var o=!1,r=!1,i=!1,d=!1,c=n.selectedComment&&Object(ke.j)(n.selectedComment.selectionDetails),m=!1;e.commentThreadIds=[],e.cardPostIds={},e.postData={},e.cardViewState={},e.postViewState={},t.payload.comments.forEach((function(t){if(t.commentId===n.highlightedCommentId&&(o=!0),t.commentId===n.topVisibleThreadId&&(r=!0),n.selectedComment&&(t.commentId===n.selectedComment.selectedCardId&&(i=!0),n.selectedComment.selectedCardId===Object(tt.b)(t)&&Object(ke.j)(n.selectedComment.selectionDetails)&&n.selectedComment.selectionDetails.selectedPostId===t.commentId&&(d=!0)),t.commentId in n.postData)Object(tt.a)(t)&&function(e,t){var n=At(e,s.d.reserveTag(523604707));if(n){var o=n.cardViewState[t];Object(l.k)().assertConditionTag(!o||o.pending!==Se.a.Delete,"Card pending delete remained after a reload.",523604736);var r=n.modelCapabilities.virtualized?xt.a.NeedsReload:xt.a.Loaded;if(o){var i=o.pending!==Se.a.None,d=(i||n.modelCapabilities.virtualized)&&o.loadState.state!==xt.a.Placeholder&&o.loadState.state!==r;e.cardViewState[t]=i||d?Object(a.__assign)(Object(a.__assign)({},o),{pending:Se.a.None}):o,d&&(e.cardViewState[t].loadState=Object(a.__assign)(Object(a.__assign)({},e.cardViewState[t].loadState),{state:r}))}else Object(l.k)().assertConditionTag(!1,"Card state missing for existing card on reload? Creating default",523604737),e.cardViewState[t]=_e.i(void 0,r)}}(e,t.commentId),function(e,t){var n=At(e,s.d.reserveTag(523604738));if(n){var o=n.postViewState[t];Object(l.k)().assertConditionTag(!o||o.pending!==Et.a.Delete,"Post pending delete remained after a reload.",523604739),o?e.postViewState[t]=o.pending!==Et.a.None?Object(a.__assign)(Object(a.__assign)({},o),{pending:Et.a.None}):o:(Object(l.k)().assertConditionTag(!1,"Post state missing for existing post on reload. Creating default",523604740),e.postViewState[t]=_e.k(void 0))}}(e,t.commentId),Rt(e,t,n.postData[t.commentId],1),n.selectedThreadIdBeforeCommentSession&&n.selectedThreadIdBeforeCommentSession===t.commentId&&(m=!0);else{if(Object(tt.a)(t)){var c=t.commentId,u=n.modelCapabilities.virtualized?{state:xt.a.Placeholder,initialItemCount:1}:{state:xt.a.Loaded};e.cardViewState[t.commentId]=_e.v(c,u)}e.postViewState[t.commentId]=_e.k(t.displayDate)}wt(e,t)})),o||(e.highlightedCommentId=void 0);r||(e.topVisibleThreadId=void 0);!m&&n.selectedThreadIdBeforeCommentSession&&function(e){var t=At(e,s.d.reserveTag(523604741));if(null==t?void 0:t.selectedThreadIdBeforeCommentSession){var n=t.commentThreadIds.indexOf(t.selectedThreadIdBeforeCommentSession);n<0&&(Object(l.k)().assertConditionTag(!1,"selectedThreadIdBeforeCommentSession not found in original commentThreadIds. Falling back to first comment",523604742),n=0);var a=e.commentThreadIds.length-1;e.commentThreadIds.length?(n>=e.commentThreadIds.length&&(n=a),e.selectedThreadIdBeforeCommentSession=e.commentThreadIds[n]):e.selectedThreadIdBeforeCommentSession=void 0}}(e);(function(e){var t=At(e,s.d.reserveTag(523604706));if(t&&e.createdCommentLie){var n=_e.G(e.draftState,!0);if(n&&t.createdCommentLie&&t.cardViewState[n]&&t.cardViewState[n].pending===Se.a.None){var a=Object.keys(e.postData).length;e.createdCommentLie&&e.createdCommentLie.flatIndex>a&&(e.createdCommentLie.flatIndex=a);var o=_e.L(e.commentThreadIds,e.cardPostIds,e.createdCommentLie.flatIndex);o>=0?(e.commentThreadIds.splice(o,0,n),e.cardPostIds[n]=[n],e.postData[n]=t.postData[n],e.cardViewState[n]=t.cardViewState[n],e.postViewState[n]=t.postViewState[n]):Object(l.k)().assertConditionTag(!1,"getThreadIndexFromFlatIndex unexpected failure to get threadIndex",523100547)}else e.createdCommentLie=void 0}})(e),e.draftState.committedLieId=void 0;var u=_e.G(e.draftState);u&&e.selectedComment&&u===e.selectedComment.selectedCardId&&(i=!0);Pt(e,1),Object(je.l)(e.draftState)||(i?c&&!d&&e.selectedComment&&!n.modelCapabilities.virtualized&&(e.selectedComment.selectionDetails=_e.l()):e.selectedComment=void 0);e.pendingCommentLoad=void 0;var p=Ut(n.tasks,n.historyRecordViewState,t.payload,n.localizationDetails);(null==p?void 0:p.updatedTasks)&&(e.tasks=p.updatedTasks);(null==p?void 0:p.updatedHistoryRecordViewState)&&(e.historyRecordViewState=p.updatedHistoryRecordViewState);var f=_e.V(e.expandedComments,e.cardViewState,e.draftState);f!==e.expandedComments&&(e.expandedComments=f)}(e,t)}))(e):function(e,t){var n,o,r,i,d={},c={},m=e.selectedComment,u=e.expandedComments,p=m&&Object(ke.j)(m.selectionDetails),f=!1,g=!1,h=!1,C=e.selectedThreadIdBeforeCommentSession,v=e.draftState,b=e.modelCapabilities.virtualized,y=null===(n=_e.K(v))||void 0===n?void 0:n.threadId,T={};e.commentData.forEach((function(e){T[e.commentId]=e}));var I=!1,O=!1;t.payload.comments.forEach((function(n){if(n.commentId===e.highlightedCommentId&&(I=!0),n.commentId===e.topVisibleThreadId&&(O=!0),m&&(n.commentId===m.selectedCardId&&(g=!0),m.selectedCardId===Object(tt.b)(n)&&Object(ke.j)(m.selectionDetails)&&m.selectionDetails.selectedPostId===n.commentId&&(f=!0)),n.commentId in T){if(""===n.parentId){e.cardViewState[n.commentId]&&Object(l.k)().assertConditionTag(e.cardViewState[n.commentId].pending!==Se.a.Delete,"Card pending delete remained after a reload.",593762527);var o=e.cardViewState[n.commentId];if(o)if(o.pending!==Se.a.None||b){var r=o.loadState;c[n.commentId]=Object(a.__assign)(Object(a.__assign)({},o),{pending:Se.a.None,loadState:r.state===xt.a.Placeholder?r:{state:b?xt.a.NeedsReload:xt.a.Loaded}})}else c[n.commentId]=o;else Object(l.k)().assertConditionTag(!1,"Card state missing for existing card on reload? Creating default.",527958879),c[n.commentId]=_e.i(void 0,b?xt.a.NeedsReload:xt.a.Loaded)}if(Object(l.k)().assertConditionTag(!e.postViewState[n.commentId]||e.postViewState[n.commentId].pending!==Et.a.Delete,"Post pending delete remained after a reload.",593762528),e.postViewState[n.commentId]?e.postViewState[n.commentId].pending!==Et.a.None?d[n.commentId]=Object(a.__assign)(Object(a.__assign)({},e.postViewState[n.commentId]),{pending:Et.a.None}):d[n.commentId]=e.postViewState[n.commentId]:d[n.commentId]=_e.k(void 0),n.commentFlags&rt.a.Resolved&&(!T[n.commentId]||!(T[n.commentId].commentFlags&rt.a.Resolved))){if(m&&m.selectedCardId===n.commentId&&(m=_e.m(m.selectedCardId)),n.commentId===y){var i=v;v=_e.S(v,n.commentId,t.payload.comments),Object(Dt.b)(i,v,1,1,s.d.reserveTag(539297115))}u=_e.U(n.commentId,u,v,m)}C&&C===n.commentId&&(h=!0)}else{if(""===n.parentId){var p=n.commentId,_=b?{state:xt.a.Placeholder,initialItemCount:1}:{state:xt.a.Loaded};c[n.commentId]=_e.v(p,_)}d[n.commentId]=_e.k(u.includes(Object(tt.b)(n))?_e.o(n.date,n.displayDate,e.localizationDetails.dataCulture):n.displayDate)}})),i=_e.b(e.createdCommentLie,t.payload.comments,e.cardViewState,e.draftState),v=Object(a.__assign)(Object(a.__assign)({},v),{committedLieId:void 0});var _=_e.G(v);_&&(m&&_===m.selectedCardId&&(g=!0),c[_]=e.cardViewState[_],d[_]=e.postViewState[_]);v=_e.db(v,e.cardViewState,c,e.postViewState,d,1),Object(je.l)(v)||(g?p&&!f&&m&&!b&&(m={selectedCardId:m.selectedCardId,selectionDetails:{lowFidelityWarningType:void 0}}):m=void 0);if(!h&&C){var S=e.commentData.findIndex((function(e){return e.commentId===C}));if(S<0&&(Object(l.k)().assertConditionTag(!1,"selectedThreadIdBeforeCommentSession not found in old commentData. Falling back to first comment",593762529),S=0),t.payload.comments.length){S>=t.payload.comments.length&&(S=t.payload.comments.length-1);var j=t.payload.comments[S];C=Object(tt.b)(j)}else C=void 0}var k=Ut(e.tasks,e.historyRecordViewState,t.payload,e.localizationDetails);return Object(a.__assign)(Object(a.__assign)({},e),{draftState:v,commentData:Object(a.__spreadArray)([],Object(a.__read)(t.payload.comments),!1),cardViewState:c,postViewState:d,selectedComment:m,expandedComments:_e.V(u,c,v),pendingCommentLoad:void 0,highlightedCommentId:I?e.highlightedCommentId:void 0,topVisibleThreadId:O?e.topVisibleThreadId:void 0,createdCommentLie:i,selectedThreadIdBeforeCommentSession:C,tasks:null!==(o=null==k?void 0:k.updatedTasks)&&void 0!==o?o:e.tasks,historyRecordViewState:null!==(r=null==k?void 0:k.updatedHistoryRecordViewState)&&void 0!==r?r:e.historyRecordViewState})}(e,t);case"REQUEST_REOPEN_THREAD":return function(e,t){var n,o=Object(a.__assign)(Object(a.__assign)({},e.cardViewState),((n={})[t.payload.commentId]=Object(a.__assign)(Object(a.__assign)({},e.cardViewState[t.payload.commentId]),{pending:Se.a.Card}),n));return Object(a.__assign)(Object(a.__assign)({},e),{cardViewState:o})}(e,t);case"REQUEST_DELETE_POST":return function(e,t){var n,o=Object(a.__assign)(Object(a.__assign)({},e.postViewState),((n={})[t.payload.commentId]=Object(a.__assign)(Object(a.__assign)({},e.postViewState[t.payload.commentId]),{pending:Et.a.Delete}),n));return Object(a.__assign)(Object(a.__assign)({},e),{postViewState:o})}(e,t);case"REQUEST_DELETE_THREAD":return function(e,t){var n,o=Object(a.__assign)(Object(a.__assign)({},e.cardViewState),((n={})[t.payload.commentId]=Object(a.__assign)(Object(a.__assign)({},e.cardViewState[t.payload.commentId]),{pending:Se.a.Delete}),n));return Object(a.__assign)(Object(a.__assign)({},e),{cardViewState:o})}(e,t);case"DISPATCH_LOAD_THREADS":return function(e,t){var n=Object(a.__assign)({},e.cardViewState);return t.payload.threadIds.forEach((function(e){if(n[e]){var t=n[e].loadState;n[e]=Object(a.__assign)(Object(a.__assign)({},n[e]),{loadState:{state:xt.a.Loading,initialItemCount:_e.O(t)?t.initialItemCount:1}})}else Object(l.k)().assertConditionTag(!1,"Loading an unexpected thread?",528021317)})),Object(a.__assign)(Object(a.__assign)({},e),{cardViewState:n})}(e,t);case"BEGIN_DRAFTING_SUCCESS":return function(e,t){var n,o,r,i,d,c,m,u,p,f,g;if(_e.H(e.draftState))throw new N.a("Draft already active!",s.d.reserveTag(589103640),-2130957551);var h=e.selectedThreadIdBeforeCommentSession,C=t.payload.draftDetails,v=null===(p=null===(u=t.payload.rehydratedDraftParams)||void 0===u?void 0:u.inCurrentContext)||void 0===p||p,b=null===(g=null===(f=t.payload.rehydratedDraftParams)||void 0===f?void 0:f.isDraftEmpty)||void 0===g||g;switch(C.sessionConfiguration.sessionType){case"CREATE":var y=C.sessionConfiguration.draftId,T=Object(a.__assign)(Object(a.__assign)({},_e.e(y)),{author:C.author,anchorHintText:C.anchorHintText}),I=v?_e.C(Object(Ae.a)(e),C):e.selectedComment,O=Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:Object(a.__assign)(Object(a.__assign)({},e.draftState.drafts),(n={},n[y]={commentDraft:C,isDraftEmpty:b,isInCurrentContext:v,pendingState:je.a.None,renderContextType:t.payload.draftRenderContextType,threadId:y},n)),cardIdToDraftIdMap:Object(a.__assign)(Object(a.__assign)({},e.draftState.cardIdToDraftIdMap),(o={},o[y]=y,o)),pendingDraft:void 0}),_={};if(Object(Ae.e)(e)){var S=_e.L(e.commentThreadIds,e.cardPostIds,C.insertIndex),j=e.commentThreadIds,k=e.cardPostIds;S>=0&&(j=Object(a.__spreadArray)(Object(a.__spreadArray)(Object(a.__spreadArray)([],Object(a.__read)(j.slice(0,S)),!1),[y],!1),Object(a.__read)(j.slice(S)),!1),k=Object(a.__assign)(Object(a.__assign)({},e.cardPostIds),((r={})[y]=[y],r))),_={commentThreadIds:j,cardPostIds:k,postData:Object(a.__assign)(Object(a.__assign)({},e.postData),(i={},i[y]=T,i))}}return Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},e),_),{createdCommentLie:{flatIndex:C.insertIndex,newComment_deprecated:T},cardViewState:Object(a.__assign)(Object(a.__assign)({},e.cardViewState),_e.p(T)),postViewState:Object(a.__assign)(Object(a.__assign)({},e.postViewState),_e.q(T)),selectedComment:I,expandedComments:_e.a(e.expandedComments,I,O),selectedThreadIdBeforeCommentSession:h,draftState:O});case"EDIT":case"REPLY":if(!Object(Tt.b)(C.sessionConfiguration)&&!Object(Tt.c)(C.sessionConfiguration))throw Object(l.k)().assertConditionTag(!1,"Expected BeginDraftingResult id to be set with CommentSessionType.Reply/Edit in beginDraftingSuccessReducer",593762523),new N.a(de.c,s.d.reserveTag(589103642),-2130957532);var x=void 0,E=Object(Tt.c)(C.sessionConfiguration)&&(!e.selectedComment||C.sessionConfiguration.threadId!==e.selectedComment.selectedCardId),D=yt.e(C.sessionConfiguration)&&(!e.selectedComment||!Object(ke.j)(e.selectedComment.selectionDetails)||C.sessionConfiguration.commentId!==e.selectedComment.selectionDetails.selectedPostId);x=v?!e.selectedComment||E||D?_e.C(Object(Ae.a)(e),C):Object(a.__assign)(Object(a.__assign)({},e.selectedComment),{selectionDetails:Object(a.__assign)(Object(a.__assign)({},e.selectedComment.selectionDetails),{lowFidelityWarningType:void 0})}):e.selectedComment;var A=e.draftState.cardIdToDraftIdMap,w=e.draftState.postIdToDraftIdMap,P="",R=!1,V=!1;if(yt.f(C.sessionConfiguration))A=Object(a.__assign)(Object(a.__assign)({},A),((d={})[C.sessionConfiguration.threadId]=C.sessionConfiguration.draftId,d)),P=C.sessionConfiguration.threadId,V=b;else if(yt.e(C.sessionConfiguration)){var F=C.sessionConfiguration.commentId;if(w=Object(a.__assign)(Object(a.__assign)({},w),((c={})[F]=C.sessionConfiguration.draftId,c)),R=!0,Object(Ae.e)(e)){var M=e.postData[F],L=Object(kt.e)(M.commentBody);V=0===L.length||"web"===Object(Ne.a)()&&"\n"===L,P=Object(tt.b)(M)}else e.commentData.some((function(e){if(e.commentId===F){var t=Object(kt.e)(e.commentBody);return V=0===t.length||"web"===Object(Ne.a)()&&"\n"===t,P=Object(tt.b)(e),!0}return!1}));!P&&C.sessionConfiguration.rootCommentId&&(P=C.sessionConfiguration.rootCommentId)}else Object(s.m)(C.sessionConfiguration);var H=Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:Object(a.__assign)(Object(a.__assign)({},e.draftState.drafts),(m={},m[C.sessionConfiguration.draftId]={commentDraft:C,isDraftEmpty:V,isInCurrentContext:v,pendingState:je.a.None,renderContextType:t.payload.draftRenderContextType,threadId:P},m)),cardIdToDraftIdMap:A,postIdToDraftIdMap:w,pendingDraft:void 0});return Object(a.__assign)(Object(a.__assign)({},e),{selectedComment:x,expandedComments:R?_e.a(e.expandedComments,x,H):_e.R(e.expandedComments,x,H),selectedThreadIdBeforeCommentSession:h,draftState:H,createdCommentLie:void 0});default:return e}}(e,t);case"BEGIN_DRAFTING_FAILURE":return function(e,t){if(void 0===e.selectedComment)return Object(l.k)().assertConditionTag(!1,"SelectedComment already undefined when failing selected comment",593762525),e;var n=void 0;"CREATE"!==t.payload.beginDraftingParams.sessionType?n=Object(a.__assign)(Object(a.__assign)({},e.selectedComment),{selectionDetails:Object(a.__assign)(Object(a.__assign)({},e.selectedComment.selectionDetails),{lowFidelityWarningType:void 0})}):e.selectedThreadIdBeforeCommentSession&&(n={selectedCardId:e.selectedThreadIdBeforeCommentSession,selectionDetails:{lowFidelityWarningType:void 0}});var o=Object(a.__assign)(Object(a.__assign)({},e.draftState),{pendingDraft:void 0});return Object(a.__assign)(Object(a.__assign)({},e),{selectedComment:n,expandedComments:_e.R(e.expandedComments,n,o),selectedThreadIdBeforeCommentSession:void 0,createdCommentLie:void 0,draftState:o})}(e,t);case"SESSION_REQUEST_STARTED":return function(e,t){var n;if(e.createdCommentLie)return Object(l.k)().assertConditionTag(!1,"SessionRequestStartedAndLockSelection unexpected defined comment lie in state",593764356),e;if(yt.f(t.payload.params))n=t.payload.params.threadId;else if(yt.e(t.payload.params)){var o=t.payload.params.commentId,r=Object(Ae.b)(Object(Ae.a)(e),o);if(!r)return Object(l.k)().assertConditionTag(!1,"Could not lock selection on missing comment",593764357),e;n=Object(tt.b)(r)}else n=Object(S.y)();var i=void 0;t.payload.captureSelectedThreadIdBeforeSession&&e.selectedComment&&(i=e.selectedComment.selectedCardId);var s=Object(a.__assign)(Object(a.__assign)({},e.draftState),{pendingDraft:t.payload.params,committedLieId:void 0}),d=_e.F(e.selectedComment,t,n),c=Object(ke.j)(d.selectionDetails)?_e.a(e.expandedComments,d,s):e.expandedComments;return Object(a.__assign)(Object(a.__assign)({},e),{selectedThreadIdBeforeCommentSession:i,selectedComment:d,expandedComments:c,draftState:s})}(e,t);case"COMMENT_CONTEXT_CHANGED":return function(e,t){var n,o,r,i=Object(je.h)(),d={},c={},m=void 0,u=void 0,p=void 0,f=void 0,g=_e.G(e.draftState),h=!!e.createdCommentLie;r=t.payload.contextDetails?Object(a.__assign)(Object(a.__assign)({},Yt(t.payload.contextDetails)),{lastContextChangeIncrement:e.contextState.lastContextChangeIncrement+1}):{nextPopulatedContextDetails:et.a.Unknown,isReadOnly:b.B()&&e.contextState.isReadOnly,commentThreadCounts:void 0,lastContextChangeIncrement:e.contextState.lastContextChangeIncrement+1};var C,v=t.payload.contextDrafts;if(v){var y=_e.W(e.draftState);if(Object(je.e)(y)>0){var T={},I=void 0,O=void 0,_=!b.W();if(Object(je.f)(y).forEach((function(n){var o,r,i=v.find((function(e){return e.draftId===n}));T[n]=Object(a.__assign)(Object(a.__assign)({},y.drafts[n]),{isInCurrentContext:!!i}),g===n&&(h=!!i,i&&(I=i.insertIndex,O=i.anchorHintText,(null===(o=t.payload.contextDetails)||void 0===o?void 0:o.selectedCommentId)===g&&(m=_e.m(g)))),_||m||!i||T[n].threadId!==(null===(r=e.selectedComment)||void 0===r?void 0:r.selectedCardId)||(_=!0)})),i=Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:T}),u=e.createdCommentLie,p=g?Object(Ae.e)(e)?e.postData[g]:null==u?void 0:u.newComment_deprecated:void 0,_&&(m=e.selectedComment),u&&g&&h){Object(l.k)().assertConditionTag(void 0!==I,"Index unknown for lie in latest context",587309136);var S=null!=I?I:0;S!==u.flatIndex&&(u=Object(a.__assign)(Object(a.__assign)({},u),{flatIndex:S})),p&&void 0!==O&&O!==u.newComment_deprecated.anchorHintText&&(p=Object(a.__assign)(Object(a.__assign)({},p),{anchorHintText:O}),u=Object(a.__assign)(Object(a.__assign)({},u),{newComment_deprecated:p})),d=_e.w(g),c=_e.x(g),u.flatIndex>-1&&(d[g].pending=Se.a.None,c[g].pending=Et.a.None)}}else f=null!=f?f:-1}else f=null!=f?f:4;r.isReadOnly&&(h&&(u=void 0),i=_e.X(i),f=null!=f?f:5);if(Object(Dt.b)(e.draftState,i,f,4,s.d.reserveTag(539297116)),Object(Ae.e)(e)){var j=[],k={},x={};u&&g&&p&&((n={})[g]=p,x=n,h&&!u.flatIndex&&(j=[g],(o={})[g]=[g],k=o)),C={commentThreadIds:j,cardPostIds:k,postData:x}}else C={commentData:[]};return Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},e),C),{cardViewState:d,postViewState:c,selectedComment:m,expandedComments:_e.R(e.expandedComments,m,i),pendingCommentLoad:0===t.payload.numberOfComments?void 0:{numberOfLoadedComments:0,numberOfLoadedThreads:0,numberOfTotalComments:t.payload.numberOfComments,numberOfTotalThreads:t.payload.numberOfThreads,selectedThreadIndex:void 0!==t.payload.selectedThreadIndex&&t.payload.selectedThreadIndex<t.payload.numberOfThreads?t.payload.selectedThreadIndex:void 0},contextState:r,highlightedCommentId:void 0,topVisibleThreadId:t.payload.contextDetails?_e.P(t.payload.contextDetails.topVisibleThreadId):void 0,createdCommentLie:u,selectedThreadIdBeforeCommentSession:void 0,draftState:i,tasks:{},historyRecordViewState:{}})}(e,t);case"NEXT_POPULATED_CONTEXT_DETAILS_UPDATED":return function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{contextState:{nextPopulatedContextDetails:t.payload.nextPopulatedContextDetails,isReadOnly:!1,commentThreadCounts:void 0,lastContextChangeIncrement:e.contextState.lastContextChangeIncrement}})}(e,t);case"SHOW_LOW_FIDELITY_WARNING":return function(e,t){var n,o=t.payload,r=o.commentId,i=o.lowFidelityWarningType,s=Object(Ae.b)(Object(Ae.a)(e),r);if(!s)return Object(l.k)().assertConditionTag(!1,"Comment not found",593762530),e;if(Object(je.d)(e.draftState))return Object(l.k)().assertConditionTag(!1,"Cannot show warning with pending or active session",593762531),e;var d=e.expandedComments;i===ke.a.DeleteThread?n={selectedCardId:r,selectionDetails:{lowFidelityWarningType:i}}:(n={selectedCardId:Object(tt.b)(s),selectionDetails:{selectedPostId:r,lowFidelityWarningType:i}},d=_e.a(d,n,e.draftState));return Object(a.__assign)(Object(a.__assign)({},e),{selectedComment:n,expandedComments:d})}(e,t);case"CLEAR_LOW_FIDELITY_WARNING":return function(e,t){var n=e.selectedComment;if(!n||void 0===n.selectionDetails.lowFidelityWarningType)return e;return Object(a.__assign)(Object(a.__assign)({},e),{selectedComment:Object(a.__assign)(Object(a.__assign)({},n),{selectionDetails:{lowFidelityWarningType:void 0}})})}(e);case"CLEAR_COMMENT_SELECTION":return function(e,t){if(!_e.bb(e.draftState,e.selectedComment,t))return e;return Object(a.__assign)(Object(a.__assign)({},e),{selectedComment:void 0})}(e,t);case"CLEAR_COMMENT_HIGHLIGHT":return function(e,t){if(void 0!==t.payload.commentId&&t.payload.commentId!==e.highlightedCommentId)return e;return Object(a.__assign)(Object(a.__assign)({},e),{highlightedCommentId:void 0})}(e,t);case"TOP_VISIBLE_THREAD_CHANGED":return function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{topVisibleThreadId:t.payload.threadId})}(e,t);case"UPDATE_CONTEXT_DETAILS":return function(e,t){var n=!1,o=Object(a.__assign)({},e.contextState),r=e.createdCommentLie,i=e.draftState,d=void 0;void 0!==t.payload.contextState.commentThreadCounts&&(n=!0,o.commentThreadCounts=t.payload.contextState.commentThreadCounts);void 0!==t.payload.contextState.nextPopulatedContextDetails&&(n=!0,o.nextPopulatedContextDetails=t.payload.contextState.nextPopulatedContextDetails);void 0!==t.payload.contextState.isReadOnly&&(n=!0,o.isReadOnly=t.payload.contextState.isReadOnly,o.isReadOnly&&(i=_e.X(e.draftState),d=null!=d?d:5,_e.G(e.draftState,!0)&&(r=void 0)));if(!n)return e;return Object(Dt.b)(e.draftState,i,d,5,s.d.reserveTag(539297117)),Object(a.__assign)(Object(a.__assign)({},e),{draftState:i,contextState:o,createdCommentLie:r})}(e,t);case"BEGIN_PROCESSING_COMMIT":return function(e,t){var n;if(!Object(je.b)(e.draftState))return Object(l.k)().assertConditionTag(!1,"BeginProcessingCommitAction unexpected",593764352),e;var o=e.draftState,r=_e.K(e.draftState);r&&(o=Object(a.__assign)(Object(a.__assign)({},o),{drafts:Object(a.__assign)(Object(a.__assign)({},o.drafts),(n={},n[r.commentDraft.sessionConfiguration.draftId]=Object(a.__assign)(Object(a.__assign)({},r),{pendingState:je.a.Commit}),n))}));return Object(a.__assign)(Object(a.__assign)({},e),{draftState:o})}(e);case"COMMIT_FAILURE":return function(e,t){var n;if(!Object(je.i)(e.draftState))return Object(l.k)().assertConditionTag(!1,"CommitFailureAction unexpected",593764353),e;var o=e.draftState,r=_e.K(e.draftState);r&&(o=Object(a.__assign)(Object(a.__assign)({},o),{drafts:Object(a.__assign)(Object(a.__assign)({},o.drafts),(n={},n[r.commentDraft.sessionConfiguration.draftId]=Object(a.__assign)(Object(a.__assign)({},r),{pendingState:je.a.None,savedDraftContent:void 0!==t.payload.commitText?{editorContent:Promise.resolve(t.payload.commitText),editorCursorPosition:Promise.resolve(void 0)}:r.savedDraftContent}),n))}));return Object(a.__assign)(Object(a.__assign)({},e),{draftState:o})}(e,t);case"BEGIN_PROCESSING_DISCARD":return function(e){var t;if(!Object(je.b)(e.draftState)&&!Object(ke.g)(e.selectedComment))return Object(l.k)().assertConditionTag(!1,"BeginProcessingDiscardAction unexpected",593764355),e;var n=e.draftState,o=_e.K(e.draftState);o&&(n=Object(a.__assign)(Object(a.__assign)({},n),{drafts:Object(a.__assign)(Object(a.__assign)({},n.drafts),(t={},t[o.commentDraft.sessionConfiguration.draftId]=Object(a.__assign)(Object(a.__assign)({},o),{pendingState:je.a.Discard}),t))}));return Object(a.__assign)(Object(a.__assign)({},e),{draftState:n})}(e);case"CANCEL_DISCARD":return function(e){var t;if(!Object(je.j)(e.draftState))return Object(l.k)().assertConditionTag(!1,"CancelDiscardAction unexpected",593764354),e;var n=e.draftState,o=_e.K(e.draftState);o&&(n=Object(a.__assign)(Object(a.__assign)({},n),{drafts:Object(a.__assign)(Object(a.__assign)({},n.drafts),(t={},t[o.commentDraft.sessionConfiguration.draftId]=Object(a.__assign)(Object(a.__assign)({},o),{pendingState:je.a.None}),t))}));return Object(a.__assign)(Object(a.__assign)({},e),{draftState:n})}(e);case"LOAD_PERSONA_ICON_PROPERTIES":return function(e,t){if(0===Object.keys(t.payload.personaIconPropertiesMap).length)return e;var n=Object(a.__assign)(Object(a.__assign)({},e.personaIconPropertiesMap),t.payload.personaIconPropertiesMap);return Object(a.__assign)(Object(a.__assign)({},e),{personaIconPropertiesMap:n})}(e,t);case"COMMIT_DRAFT":return function(e,t){var n=_e.H(e.draftState);if(void 0===n)return Object(l.k)().assertConditionTag(!1,"Invalid number of drafts during commit.",593762521),e;if(n.sessionConfiguration.sessionType!==t.payload.sessionType)return e;switch(t.payload.sessionType){case"CREATE":return function(e,t){var n;if(!e.createdCommentLie)return e;var o=_e.G(e.draftState);if(!o)return e;var r=t.temporaryCommentId;if(!r)throw Object(l.k)().assertConditionTag(!1,"Expected middleware to set temporaryCommentId",593762520),new N.a(de.c,s.d.reserveTag(589103637),-2130957545);var i=Object(Ae.e)(e)?e.postData[o]:e.createdCommentLie.newComment_deprecated;if(Object(Ae.e)(e)&&!i)return Object(l.k)().assertConditionTag(!1,"Did not find model for draft thread on commit",527251200),e;var d=Object(a.__assign)(Object(a.__assign)({},i),{commentId:r,commentBody:t.commentBody}),c=Object(a.__assign)(Object(a.__assign)({},e.cardViewState),_e.w(r)),m=Object(a.__assign)(Object(a.__assign)({},e.postViewState),_e.x(r)),u=e.selectedComment&&{selectedCardId:r,selectionDetails:{lowFidelityWarningType:void 0}},p=_e.T(e.draftState,o);return Object(a.__assign)(Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},e),{selectedComment:u,expandedComments:_e.a(e.expandedComments,u,p)}),Object(Ae.e)(e)?{postData:Object(a.__assign)(Object(a.__assign)({},e.postData),(n={},n[o]=d,n))}:{createdCommentLie:Object(a.__assign)(Object(a.__assign)({},e.createdCommentLie),{newComment_deprecated:d})}),{cardViewState:c,postViewState:m,selectedThreadIdBeforeCommentSession:void 0,draftState:Object(a.__assign)(Object(a.__assign)({},p),{committedLieId:r})})}(e,t.payload.data);case"REPLY":return function(e,t){var n;if(!t.parentId)throw new N.a(de.d,s.d.reserveTag(589103638),-2130957536);var o=Object(a.__assign)(Object(a.__assign)({},e.cardViewState),((n={})[t.parentId]=Object(a.__assign)(Object(a.__assign)({},e.cardViewState[t.parentId]),{pending:Se.a.Editor,loadState:{state:xt.a.Loaded}}),n)),r=_e.m(t.parentId),i=_e.T(e.draftState,t.parentId);return Object(a.__assign)(Object(a.__assign)({},e),{cardViewState:o,selectedComment:r,expandedComments:_e.R(e.expandedComments,r,i),selectedThreadIdBeforeCommentSession:void 0,draftState:i})}(e,t.payload.data);case"EDIT":return function(e,t){var n,o=_e.A(e,t.commentId),r=Object(a.__assign)(Object(a.__assign)({},e.postViewState[t.commentId]),{pending:Et.a.Post}),i=_e.ab(e.draftState,t.commentId);return Object(a.__assign)(Object(a.__assign)({},e),{postViewState:Object(a.__assign)(Object(a.__assign)({},e.postViewState),(n={},n[t.commentId]=r,n)),selectedComment:o,expandedComments:_e.R(e.expandedComments,o,i),selectedThreadIdBeforeCommentSession:void 0,draftState:i})}(e,t.payload.data);default:throw new N.a("Unexpected session type for commit",s.d.reserveTag(589103639),-2130957532)}}(e,t);case"RESOLVE_ATMENTION_CAPABILITY":return function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{modelCapabilities:Object(a.__assign)(Object(a.__assign)({},e.modelCapabilities),{atMention:t.payload.capability})})}(e,t);case"SAVE_DRAFT":return function(e,t){var n,o=e.draftState.drafts;if(void 0===o[t.payload.draftId])return Object(l.k)().assertConditionTag(!Object(je.c)(e.draftState),"saveDraftReducer called with an invalid draft id while a draft is active",587531107),e;var r=Object(a.__assign)(Object(a.__assign)({},o),((n={})[t.payload.draftId]=Object(a.__assign)(Object(a.__assign)({},o[t.payload.draftId]),{savedDraftContent:t.payload.draftContent}),n));return Object(a.__assign)(Object(a.__assign)({},e),{draftState:Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:r})})}(e,t);case"DRAFT_EMPTINESS_CHANGED":return function(e,t){var n,o=e.draftState.drafts;if(void 0===o[t.payload.draftId])return Object(l.k)().assertConditionTag(!1,"draftEmptinessChangedReducer called with an invalid draft id",592213846),e;var r=Object(a.__assign)(Object(a.__assign)({},o),((n={})[t.payload.draftId]=Object(a.__assign)(Object(a.__assign)({},o[t.payload.draftId]),{isDraftEmpty:t.payload.isEmpty}),n));return Object(a.__assign)(Object(a.__assign)({},e),{draftState:Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:r})})}(e,t);case"UPDATE_DRAFT_RENDER_CONTEXT":return function(e,t){var n=_e.eb(e.draftState,(function(n){var a=e.draftState.drafts[n];return void 0!==t.payload.draftId&&t.payload.draftId!==n?a.renderContextType:t.payload.isClaimingLock&&a.renderContextType===Ve.a.None?t.actionDetail.renderContextType:t.payload.isClaimingLock||a.renderContextType!==t.actionDetail.renderContextType?a.renderContextType:Ve.a.None}));return Object(a.__assign)(Object(a.__assign)({},e),{draftState:n})}(e,t);case"VIEW_CONTAINER_CHANGED":return function(e,t){var n=_e.eb(e.draftState,(function(n){var a=e.draftState.drafts[n];return Object(Me.b)(a.renderContextType)?Object(It.a)(t.payload.viewContainer.containerType):a.renderContextType}));return Object(a.__assign)(Object(a.__assign)({},e),{draftState:n})}(e,t);case"DISPLAY_DRAFT_WARNING":return function(e,t){var n,o,r=_e.H(e.draftState);if(void 0===r)return Object(l.k)().assertConditionTag(!1,"Expected active draft to be present",593764360),e;var i=r.sessionConfiguration.draftId,s=e.draftState.drafts;if(!s[i])return Object(l.k)().assertConditionTag(!1,"Expected draft to be present on display draft warning",593764361),e;var d=s[i].draftWarningState,c=Object(a.__assign)(Object(a.__assign)({},s[i]),{draftWarningState:{warningCounter:d?d.warningCounter+1:0,type:t.payload.draftWarningType}}),m=Object(a.__assign)(Object(a.__assign)({},s),((n={})[i]=c,n)),u=b.W()&&(Object(Tt.b)(c.commentDraft.sessionConfiguration)||(null===(o=e.selectedComment)||void 0===o?void 0:o.selectedCardId)!==c.threadId)?_e.E(c):e.selectedComment,p=Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:m});return Object(a.__assign)(Object(a.__assign)({},e),{draftState:p,selectedComment:u,expandedComments:_e.R(e.expandedComments,u,p)})}(e,t);case"UPDATE_MODEL_STATE":return function(e,t){var n={atMention:t.payload.modelCapabilityFlags&Je.AtMentionKnown?t.payload.modelCapabilityFlags&Je.AtMentionEnabled?Ct.b.Enabled:Ct.b.Disabled:Ct.b.Unknown,newThread:!!(t.payload.modelCapabilityFlags&Je.NewThread),resolve:!!(t.payload.modelCapabilityFlags&Je.Resolve),richTextCapabilities:t.payload.richTextCapabilityFlags,virtualized:!!(t.payload.modelCapabilityFlags&Je.Virtualized),tasks:t.payload.modelCapabilityFlags&Je.TasksKnown?t.payload.modelCapabilityFlags&Je.TasksEnabled?bt.a.Enabled:bt.a.Disabled:bt.a.Unknown,presentLinkToComment:!!(t.payload.modelCapabilityFlags&Je.PresentLinkToComment),UIAAnnotationPattern:!!(t.payload.modelCapabilityFlags&Je.UIAAnnotationPattern),ContentExtensionHostingDisabled:!!(t.payload.modelCapabilityFlags&Je.ContentExtensionHostingDisabled)};return Object(a.__assign)(Object(a.__assign)({},e),{modelCapabilities:n})}(e,t);case"UPDATE_MENTIONEES_STILL_IN_DRAFT":return function(e,t){var n,o=_e.H(e.draftState);if(void 0===o)return Object(l.k)().assertConditionTag(!1,"Expected active draft to be present",593764366),e;var r=o.sessionConfiguration;if(Object(Tt.b)(r))return e;var i=e.draftState.drafts[r.draftId];if(!i)return Object(l.k)().assertConditionTag(!1,"Missing draft for updating mentionees",593764367),e;var s=i.currentMentionees,d={};for(var c in s)d[c]={mentionee:Object(a.__assign)({},s[c].mentionee),stillInDraft:t.payload.emailsStillInDraft.has(c)};var m=i.selectedTaskAssignee;if(m){var u=Object(se.h)(m);d[u]&&d[u].stillInDraft||(m=void 0)}var p=Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:Object(a.__assign)(Object(a.__assign)({},e.draftState.drafts),(n={},n[r.draftId]=Object(a.__assign)(Object(a.__assign)({},e.draftState.drafts[r.draftId]),{currentMentionees:d,selectedTaskAssignee:m}),n))});return Object(a.__assign)(Object(a.__assign)({},e),{draftState:p})}(e,t);case"ADD_TO_CURRENT_MENTIONEES":return function(e,t){var n,o,r=_e.H(e.draftState);if(void 0===r)return Object(l.k)().assertConditionTag(!1,"Expected active draft to be present",593764364),e;var i=r.sessionConfiguration;if(Object(Tt.b)(i))return e;var s=e.draftState.drafts[i.draftId];if(!s)return Object(l.k)().assertConditionTag(!1,"Missing draft for adding mentionees",593764365),e;var d=s.currentMentionees,c=Object(se.h)(t.payload.mentionee);if(d&&d[c])return e;var m={};for(var u in d)m[u]={mentionee:Object(a.__assign)({},d[u].mentionee),stillInDraft:d[u].stillInDraft};m[c]={mentionee:Object(a.__assign)({},t.payload.mentionee),stillInDraft:!0};var p=void 0;e.draftState.drafts[i.draftId].selectedTaskAssignees&&(p=Object(a.__assign)({},e.draftState.drafts[i.draftId].selectedTaskAssignees),Object(se.b)(p,((n={})[c]={mentionee:Object(a.__assign)({},t.payload.mentionee),stillInDraft:!0},n)));var f=Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:Object(a.__assign)(Object(a.__assign)({},e.draftState.drafts),(o={},o[i.draftId]=Object(a.__assign)(Object(a.__assign)({},e.draftState.drafts[i.draftId]),{currentMentionees:m,selectedTaskAssignees:p}),o))});return Object(a.__assign)(Object(a.__assign)({},e),{draftState:f})}(e,t);case"TOGGLE_TASK_ASSIGNER_TYPE":return function(e){var t;if(!b.i())return Object(l.k)().assertConditionTag(!1,"toggleTaskAssigner should not be called unless CommentTasksWithMultiAssign is enabled.",529143576),e;var n=_e.K(e.draftState);if(void 0===n)return Object(l.k)().assertConditionTag(!1,"No draft available while initializing selected task assignees.",529143577),e;var o=n.commentDraft,r=n.selectedTaskAssignees,i={};if(void 0===r){if(Object(Tt.c)(o.sessionConfiguration)){var s=e.tasks[o.sessionConfiguration.threadId];Object(l.k)().assertConditionTag(!!s,"Task not found.",529143616),Object(se.a)(i,s.currentState.assignees)}void 0!==n.currentMentionees&&Object(se.b)(i,n.currentMentionees)}else i=void 0;var d=o.sessionConfiguration.draftId,c=Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:Object(a.__assign)(Object(a.__assign)({},e.draftState.drafts),(t={},t[d]=Object(a.__assign)(Object(a.__assign)({},e.draftState.drafts[d]),{selectedTaskAssignees:i}),t))});return Object(a.__assign)(Object(a.__assign)({},e),{draftState:c})}(e);case"UPDATE_SELECTED_TASK_ASSIGNEE":return function(e,t){var n;if(b.i())return Object(l.k)().assertConditionTag(!1,"Should not update selectedTaskAssignee if CommentTasksWithMultiAssign is on.",529096909),e;var o=_e.H(e.draftState);if(void 0===o)return Object(l.k)().assertConditionTag(!1,"Expected active draft to be present",593764368),e;var r=o.sessionConfiguration;if(Object(Tt.b)(r))return e;var i=r.draftId,s=e.draftState.drafts;if(!s[i])return Object(l.k)().assertConditionTag(!1,"Expected draft to be present on update selected task assignee",593764369),e;var d=Object(a.__assign)(Object(a.__assign)({},s),((n={})[i]=Object(a.__assign)(Object(a.__assign)({},s[i]),{selectedTaskAssignee:t.payload.selectedAssignee}),n));return Object(a.__assign)(Object(a.__assign)({},e),{draftState:Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:d})})}(e,t);case"UPDATE_SELECTED_TASK_ASSIGNEES":return function(e,t){var n,o;if(!b.i())return Object(l.k)().assertConditionTag(!1,"Should not update selectedTaskAssignees if CommentTasksWithMultiAssign is off.",529096910),e;var r=_e.H(e.draftState);if(void 0===r)return Object(l.k)().assertConditionTag(!1,"Expected active draft to be present",529143574),e;var i=r.sessionConfiguration;if(Object(Tt.b)(i))return e;var s=i.draftId,d=e.draftState.drafts;if(!d[s])return Object(l.k)().assertConditionTag(!1,"Expected draft to be present on update selected task assignees",529143575),e;var c=null!==(o=d[s].selectedTaskAssignees)&&void 0!==o?o:{},m=Object(a.__assign)({},c);Object(se.n)(m,t.payload.selectedAssignee);var u=Object(a.__assign)(Object(a.__assign)({},d),((n={})[s]=Object(a.__assign)(Object(a.__assign)({},d[s]),{selectedTaskAssignees:m}),n));return Object(a.__assign)(Object(a.__assign)({},e),{draftState:Object(a.__assign)(Object(a.__assign)({},e.draftState),{drafts:u})})}(e,t);case"POPULATE_SMART_REPLY":return function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{draftState:_e.r(e.draftState,t.payload)})}(e,t);case"SHOW_POST_ERROR_STATE":return function(e,t){var n=Object(a.__assign)(Object(a.__assign)({},e.postViewState[t.payload.commentId]),{displayingErrorUI:!0}),o=Object(a.__assign)({},e.postViewState);return o[t.payload.commentId]=n,Object(a.__assign)(Object(a.__assign)({},e),{postViewState:o})}(e,t);case"CLEAR_POST_ERROR_STATE":return function(e,t){var n=Object(a.__assign)(Object(a.__assign)({},e.postViewState[t.payload.commentId]),{displayingErrorUI:!1}),o=Object(a.__assign)({},e.postViewState);return o[t.payload.commentId]=n,Object(a.__assign)(Object(a.__assign)({},e),{postViewState:o})}(e,t);case"UPDATE_DRAFT_THREAD":return function(e,t){var n;if(!e.createdCommentLie)return e;if(_e.G(e.draftState)!==t.payload.draftId)return Object(l.k)().assertConditionTag(!1,"Unexpected draft ID in updateDraftThread payload",593844429),e;if(void 0===t.payload.anchorHintText&&void 0===t.payload.insertIndex)return e;var o=Object(Ae.e)(e)?e.postData[t.payload.draftId]:e.createdCommentLie.newComment_deprecated;if(Object(Ae.e)(e)&&!o)return Object(l.k)().assertConditionTag(!1,"Did not find model for draft thread on update",527251201),e;var r=e.createdCommentLie,i={};if(void 0!==t.payload.insertIndex&&t.payload.insertIndex!==r.flatIndex&&(r=Object(a.__assign)(Object(a.__assign)({},r),{flatIndex:t.payload.insertIndex}),Object(Ae.e)(e))){var s=_e.fb(e.commentThreadIds,e.cardPostIds,t.payload.draftId,r);i=Object(a.__assign)(Object(a.__assign)({},i),{commentThreadIds:s})}if(void 0!==t.payload.anchorHintText&&t.payload.anchorHintText!==o.anchorHintText){var d=Object(a.__assign)(Object(a.__assign)({},o),{anchorHintText:t.payload.anchorHintText});if(Object(Ae.e)(e)){var c=Object(a.__assign)(Object(a.__assign)({},e.postData),((n={})[t.payload.draftId]=d,n));i=Object(a.__assign)(Object(a.__assign)({},i),{postData:c})}else r=Object(a.__assign)(Object(a.__assign)({},r),{newComment_deprecated:d})}return Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},e),i),{createdCommentLie:r})}(e,t);case"VIEW_CONTAINER_VISIBILITY_CHANGED":return function(e,t){var n=e.draftState,o=e.selectedComment,r=e.expandedComments;if(t.payload.visibilityState!==z.a.Visible&&!b.p()&&(n=_e.W(n),e.selectedComment&&0===Object.keys(n.drafts).length&&Object.keys(e.draftState.drafts).length>0)){var i=_e.I(e.draftState);i&&(o=_e.m(i),r=_e.R(e.expandedComments,o,n))}return n=_e.eb(n,(function(n){var a=e.draftState.drafts[n];return _e.cb(a.renderContextType,t.payload.visibilityState)})),Object(a.__assign)(Object(a.__assign)({},e),{selectedComment:o,expandedComments:r,draftState:n})}(e,t);case"UPDATE_SUGGESTIONS_DETAILS":return function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{suggestionsDetails:t.payload.details})}(e,t);default:return e}}(e,t);return function(e,t){var n,o,r=t,i="android"===Object(Ne.a)(),s=null===(n=r.selectedComment)||void 0===n?void 0:n.selectedCardId,d=_e.G(r.draftState);if(Object(Ae.e)(r)){var c=i&&s&&!r.expandedComments.includes(s)?Object(a.__spreadArray)(Object(a.__spreadArray)([],Object(a.__read)(r.expandedComments),!1),[s],!1):r.expandedComments,l=r.cardPostIds,m=r.postData,u=void 0;c.forEach((function(e){e!==d&&l[e]&&(u=_e.f(l[e],null!=u?u:r.postViewState,m,r.localizationDetails))})),u&&(r=Object(a.__assign)(Object(a.__assign)({},r),{postViewState:u}))}else{if(s&&s!==d&&(i?s!==(null===(o=e.selectedComment)||void 0===o?void 0:o.selectedCardId):r.expandedComments.includes(s)&&!e.expandedComments.includes(s)))(p=_e.g(s,r.postViewState,r.commentData,r.localizationDetails))&&(r=Object(a.__assign)(Object(a.__assign)({},r),{postViewState:p}));var p,f=_e.G(e.draftState);if(f&&f!==d&&(i||r.expandedComments.includes(f)))(p=_e.g(f,r.postViewState,r.commentData,r.localizationDetails))&&(r=Object(a.__assign)(Object(a.__assign)({},r),{postViewState:p}))}return r}(e,n)}function ln(){Object(l.k)().assertConditionTag(!1,"Must specify initial pane state!",595918942)}function mn(e,t){switch(void 0===e&&(e={viewContainer:{closeView:ln,openView:ln,containerType:V.b.FullPane,moveFocusToCanvas_donotuse:ln},componentTree:new $t(Ve.a.FullPane,i.a),visibilityState:z.a.Closed,initializationStatus:Kt.a.NotInitialized,viewContainerDisplayConfiguration:void 0}),void 0===t&&(t=ye.EMPTY_ACTION),t.type){case"VIEW_CONTAINER_CHANGED":return function(e,t){var n=e.viewContainer.containerType!==t.payload.viewContainer.containerType;return Object(a.__assign)(Object(a.__assign)({},e),{viewContainer:t.payload.viewContainer,componentTree:n?new $t(Object(It.a)(t.payload.viewContainer.containerType),e.componentTree.componentTreeId.contextIdentifier,e.componentTree):e.componentTree})}(e,t);case"VIEW_CONTAINER_DISPLAY_CONFIGURATION_CHANGED":return function(e,t){if(t.payload.displayConfiguration===e.viewContainerDisplayConfiguration)return e;return Object(a.__assign)(Object(a.__assign)({},e),{viewContainerDisplayConfiguration:t.payload.displayConfiguration})}(e,t);case"VIEW_CONTAINER_VISIBILITY_CHANGED":return function(e,t){return Object(a.__assign)(Object(a.__assign)({},e),{initializationStatus:t.payload.visibilityState!==z.a.Closed||b.t()?e.initializationStatus:Kt.a.NotInitialized,visibilityState:t.payload.visibilityState})}(e,t);case"VIEW_CONTAINER_FOLDABLE_LAYOUT_STATE_CHANGED":return function(e,t){var n=Object(a.__assign)(Object(a.__assign)({},e.viewContainer),{foldableLayoutState:t.payload.foldableLayoutState});return Object(a.__assign)(Object(a.__assign)({},e),{viewContainer:n})}(e,t);case"BEGIN_VIEW_INIT":return function(e){return Object(a.__assign)(Object(a.__assign)({},e),{initializationStatus:Kt.a.Initializing})}(e);case"END_VIEW_INIT":return function(e){return Object(a.__assign)(Object(a.__assign)({},e),{initializationStatus:Kt.a.Initialized})}(e);default:return e}}var un=void 0;function pn(e,t){void 0===t&&(t=gt.a),un||(un=Object(mt.combineReducers)({paneState:mn,contentExtensions:en,commentState:cn,filterState:tn}));var n=un(e,t);return n}var fn=n(185);var gn=function(){return{threadIdRequests:new Map,sequenceId:0}};function hn(e){return e&&(e.loadState.state===xt.a.Placeholder||e.loadState.state===xt.a.NeedsReload)}var Cn=function(e,t,n){return void 0===n&&(n=20),o=function(e){return function(t,n){var o,r,i=xe.c(e.getState());try{for(var s=Object(a.__values)(n),d=s.next();!d.done;d=s.next()){var c=d.value;hn(i[c])&&t.threadIdRequests.set(c,t.sequenceId++)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return t}}(e),r=function(e,t,n){return function(o){for(var r=Array.from(o.threadIdRequests.entries()).sort((function(e,t){var n=Object(a.__read)(e,2),o=(n[0],n[1]),r=Object(a.__read)(t,2);return r[0],o-r[1]})),i=[],d=xe.c(e.getState()),c=r.pop();c&&i.length<n;c=r.pop()){var l=Object(a.__read)(c,1)[0];o.threadIdRequests.delete(l),hn(d[l])&&i.push(l)}if(i.length&&e.dispatch(Object(ye.dispatchLoadThreads)({renderContextType:Ve.a.None,telemetryVisitor:t,trackback:s.d.reserveTag(594888212)},{threadIds:i})),o.threadIdRequests.size>0)return o}}(e,t,n),d=500,m=(i=gn)(),u=function(){var e=r(m);e?(m=e,l=setTimeout(u,d)):(m=i(),l=void 0)},(p=function(e){m=o(m,e),l||c||(l=setTimeout(u,0)),l||(l=setTimeout(u,c||d))}).reset=function(){void 0!==l&&(clearTimeout(l),m=i(),l=void 0)},p;var o,r,i,d,c,l,m,u,p},vn=n(321),bn=n(271),yn=function(e,t){return function(n){var a=Cn(n,t);return function(t){return function(o){var r=n.getState();switch(o.type){case"COMMENT_CONTEXT_CHANGED":case"RELOAD_COMMENTS":a.reset();break;case"COMMIT_DRAFT":var i=bn.b(r),d=xe.v(r);if(void 0!==d){var c=d.commentDraft;if(o.payload.metadataUpdates&&o.payload.metadataUpdates.Task){var m=void 0;c.sessionConfiguration.sessionType!==fn.a&&c.sessionConfiguration.sessionType!==fn.b&&(m=i[c.sessionConfiguration.threadId]&&i[c.sessionConfiguration.threadId].id),o.payload.metadataUpdates.Task.taskId=m,c.updateProperties("Task",o.payload.metadataUpdates.Task)}o.payload.data.temporaryCommentId=c.commit(o.payload.data.commentBody)}break;case"QUEUE_LOAD_THREADS":return xe.p(r).virtualized?void a(o.payload.threadIds):void Object(l.k)().assertConditionTag(!1,"Load threads should not be queued if host is not virtualizing comments.",593768920);case"DISPATCH_LOAD_THREADS":if(!xe.p(r).virtualized)return;e.loadThreads(o.payload.threadIds);break;case"HIGHLIGHT_COMMENT":o.payload.actionSource===Te.a.SharedComments&&e.highlightComment(o.payload.commentId);break;case"REQUEST_DELETE_POST":case"REQUEST_DELETE_THREAD":var u=xe.h(r);if(Object(je.d)(u))return;e.deleteComment(o.payload.commentId);break;case"REQUEST_THREAD_RESOLVE":b.b()?e.beginDraftingAsync({sessionType:"METADATA",threadId:o.payload.commentId}).then((function(e){var t=bn.b(r)[o.payload.commentId];t&&e.updateProperties("Task",{type:"Task",completion:100,taskId:t.id}),e.updateProperties("Resolve",{type:"Resolve",isResolved:!0}),e.commit(),e.endDrafting()})).catch(Object(j.a)(s.d.reserveTag(593768922))):e.setThreadResolvedState(o.payload.commentId,!0);break;case"REQUEST_REOPEN_THREAD":b.b()?e.beginDraftingAsync({sessionType:"METADATA",threadId:o.payload.commentId}).then((function(e){var t=bn.b(r)[o.payload.commentId];t&&e.updateProperties("Task",{type:"Task",completion:0,taskId:t.id}),e.updateProperties("Resolve",{type:"Resolve",isResolved:!1}),e.commit(),e.endDrafting()})).catch(Object(j.a)(s.d.reserveTag(593768924))):e.setThreadResolvedState(o.payload.commentId,!1);break;case"SELECT_FIRST_COMMENT_IN_NEXT_POPULATED_CONTEXT":e.selectFirstThreadInNextCommentContext();break;case"SELECT_LAST_COMMENT_IN_PREVIOUS_POPULATED_CONTEXT":e.selectLastThreadInPreviousCommentContext();break;case"PRESENT_LINK_TO_COMMENT":e.presentLinkToComment(o.payload.commentId)}var p=t(o),f=n.getState(),g=xe.t(r),h=xe.t(f),C=void 0;switch("LOAD_COMMENT"===o.type||"VIRTUALIZE_COMMENTS"===o.type||"SELECT_COMMENT"===o.type&&o.payload.source!==Te.a.SharedComments||!h||h.selectedCardId===(null==g?void 0:g.selectedCardId)||h.selectedCardId===Object(S.y)()||(C=h.selectedCardId),o.type){case"CLEAR_COMMENT_HIGHLIGHT":o.payload.actionSource===Te.a.SharedComments&&void 0!==r.commentState.highlightedCommentId&&void 0===f.commentState.highlightedCommentId&&e.highlightComment("");break;case"DISPLAY_DRAFT_WARNING":if(b.C()&&!vn.b(n.getState())){var v=xe.v(f);v&&(C=v.threadId)}}return C&&e.selectComment(C),p}}}};function Tn(e,t,n){var a=e.getState(),o=vn.a(a)[p.e.Isolated];return!!o&&(n(t),o.controller.triggerUpdate(),!0)}function In(e,t,n,a){return"CREATE"===a&&Tn(e,t,n)}function On(e,t){return 0===xe.f(t).lastContextChangeIncrement?p.d.Disabled:e===p.e.TaskPane||e===p.e.TaskPaneItem?De.a(t)?p.d.Primary:p.d.Disabled:xe.q(t)?p.d.Disabled:On(p.e.TaskPane,t)!==p.d.Primary?p.d.Primary:e===p.e.Integrated?p.d.Disabled:p.d.Secondary}function _n(e,t){var n=vn.a(e)[t];n&&(n.controller.priority=n.priority)}var Sn=function(e){return function(t){return function(n){return function(o){var r,i,d;switch(o.type){case"ADD_CONTENT_EXTENSION":o.payload.extension.priority=On(o.payload.extension.provider.scope.renderMode,t.getState());break;case"REMOVE_CONTENT_EXTENSION":try{for(var c=Object(a.__values)(o.payload.renderModes),l=c.next();!l.done;l=c.next()){var m=l.value,u=vn.a(t.getState())[m];u&&u.controller.unregisterExtension()}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}break;case"UPDATE_EXTENSION_PRIORITY":n(o),_n(t.getState(),p.e.TaskPane),_n(t.getState(),p.e.TaskPaneItem),_n(t.getState(),p.e.Integrated),_n(t.getState(),p.e.Isolated);break;case"APPLY_COMMENT_CHANGES":case"CANCEL_COMMENT_CREATE_THREAD":if(Tn(t,o,n))return;break;case"COMMENT_CONTEXT_CHANGED":case"LOAD_COMMENT":case"VIRTUALIZE_COMMENTS":case"RELOAD_COMMENTS":case"VIEW_CONTAINER_VISIBILITY_CHANGED":return n(o),void t.dispatch(Object(ye.updateExtensionPriority)({renderContextType:Ve.a.None,telemetryVisitor:e,trackback:s.d.reserveTag(594834319)},(d={},d[p.e.TaskPane]=On(p.e.TaskPane,t.getState()),d[p.e.TaskPaneItem]=On(p.e.TaskPaneItem,t.getState()),d[p.e.Integrated]=On(p.e.Integrated,t.getState()),d[p.e.Isolated]=On(p.e.Isolated,t.getState()),d)));case"BEGIN_DRAFTING_SUCCESS":if(In(t,o,n,o.payload.draftDetails.sessionConfiguration.sessionType))return;break;case"BEGIN_DRAFTING_FAILURE":if(In(t,o,n,o.payload.beginDraftingParams.sessionType))return;break;case"UPDATE_DRAFT_RENDER_CONTEXT":if(o.payload.isClaimingLock||o.actionDetail.renderContextType===Ve.a.DiscreteIsolated)break;var f=xe.v(t.getState());if(f&&In(t,o,n,f.commentDraft.sessionConfiguration.sessionType))return}return n(o)}}}},jn=function(e){return function(t){return function(n){return function(a){var o;if(!e||!vn.b(t.getState()))return n(a);var r=t.getState(),i=n(a),s=t.getState();switch(a.type){case"DISPLAY_DRAFT_WARNING":var d=xe.t(r),c=xe.t(s),l=!c||c.selectedCardId===(null==d?void 0:d.selectedCardId);if(b.C()&&l){var m=xe.v(s);m&&e.bringContentIntoView({contentIdentifier:{contentId:m.threadId,contentType:p.b.CommentThread}})}break;case"SELECT_COMMENT":var u=xe.t(s);a.payload.source===Te.a.SharedComments&&a.payload.selectType!==ye.SelectActionType.Polite&&Object(Me.b)(a.actionDetail.renderContextType)&&u&&e.bringContentIntoView({contentIdentifier:{contentId:u.selectedCardId,contentType:p.b.CommentThread}});break;case"VIEW_CONTAINER_VISIBILITY_CHANGED":if(De.a(s))break;var f=xe.v(s),g=f&&f.isInCurrentContext&&(null===(o=xe.t(s))||void 0===o?void 0:o.selectedCardId)===f.threadId?f.threadId:void 0;g&&e.bringContentIntoView({contentIdentifier:{contentId:g,contentType:p.b.CommentThread}});break;case"SELECT_CONTENT":e.selectNextOrPreviousContent(a.payload);break;case"MOVE_FOCUS_TO_CANVAS":e.moveFocus({region:D.a.Canvas,resource:a.payload.resource})}return i}}}},kn=n(675),xn=function(e){return function(t){return function(n){return function(a){var o=t.getState().commentState.draftState.drafts;n(a);var r=t.getState().commentState.draftState.drafts;if(Object.keys(o).forEach((function(t){if(void 0===r[t]){var n=Object(l.k)().createActivityObject("EndDraftingCalledOnAction",e,Object(l.j)());n.addDataField("ActionName",a.type,l.d.SystemMetadata),n.successTag(539313865),o[t].commentDraft.endDrafting()}})),Object(b.q)()&&"SAVE_DRAFT"===a.type){var i=r[a.payload.draftId];i&&Object(kn.a)().storeEditorContentFromDraftSave(a.payload,i.commentDraft.sessionConfiguration)}}}}},En=n(272),Dn=n(679),An=n(659),wn=Object(l.j)();function Pn(e){switch(e.type){case"APPLY_COMMENT_CHANGES":return{name:"ApplyCommentChangesAction",activityConfig:Object(l.n)({aggregationMode:l.a.OnSuccess})};case"BEGIN_PROCESSING_COMMIT":return{name:"BeginProcessingCommitAction",activityConfig:wn};case"CANCEL_COMMENT_CREATE_THREAD":return{name:"CancelCommentCreateThreadAction",activityConfig:wn};case"CANCEL_COMMENT_POST_EDIT":return{name:"CancelCommentPostEditAction",activityConfig:wn};case"CANCEL_COMMENT_REPLY":return{name:"CancelCommentReplyAction",activityConfig:wn};case"COLLAPSE_CARD":return{name:"CollapseCardAction",activityConfig:wn};case"COMMIT_DRAFT":return{name:"CommitDraftAction",activityConfig:wn};case"DISPLAY_DRAFT_WARNING":return{name:"DisplayDraftWarningAction",activityConfig:wn};case"RELOAD_COMMENTS":return{name:"ReloadCommentsAction",activityConfig:Object(l.n)({aggregationMode:l.a.OnSuccess})};case"REQUEST_DELETE_POST":return{name:"DeletePostAction",activityConfig:wn};case"REQUEST_DELETE_THREAD":return{name:"DeleteThreadAction",activityConfig:wn,logDocumentMetadata:l.f.Basic};case"DISPATCH_LOAD_THREADS":return{name:"LoadThreadsAction",activityConfig:Object(l.n)({aggregationMode:l.a.OnSuccess})};case"REQUEST_REOPEN_THREAD":return{name:"ReopenThreadAction",activityConfig:wn};case"REQUEST_THREAD_RESOLVE":return{name:"ResolveThreadAction",activityConfig:wn,logDocumentMetadata:l.f.Basic};case"SELECT_COMMENT":return{name:"SelectCommentAction",activityConfig:wn};case"SELECT_FIRST_COMMENT_IN_NEXT_POPULATED_CONTEXT":return{name:"SelectFirstThreadInNextCommentContextAction",activityConfig:wn};case"SELECT_LAST_COMMENT_IN_PREVIOUS_POPULATED_CONTEXT":return{name:"SelectLastThreadInPreviousCommentContextAction",activityConfig:wn};case"SESSION_REQUEST_STARTED":return{name:"SessionRequestStartedAndLockSelectionAction",activityConfig:wn};case"SHOW_LOW_FIDELITY_WARNING":return{name:"ShowLowFidelityWarningAction",activityConfig:wn};case"CLEAR_LOW_FIDELITY_WARNING":return{name:"ClearLowFidelityWarningAction",activityConfig:wn};case"UPDATE_DRAFT_RENDER_CONTEXT":return{name:"UpdateDraftRenderContext",activityConfig:wn};case"PRESENT_LINK_TO_COMMENT":return{name:"PresentLinkToCommentAction",activityConfig:wn};case"CLEAR_COMMENT_SELECTION":default:return}}var Rn=function(){return function(e){return function(t){try{return e(t)}catch(e){if(void 0===Pn(t)){var n=Object(l.k)().createActivityObject("ExceptionMiddlewareCatch",t.actionDetail.telemetryVisitor,Object(l.j)());n.addDataField("OperationType",t.type,l.d.SystemMetadata),n.addDataField("Trackback",t.actionDetail.trackback,l.d.SystemMetadata),n.failTag(593278723,Object(En.a)(e))}!function(e){if(Object(Dn.a)(e))throw e;if(!Object(N.b)(e))throw Object(l.k)().assertConditionTag(!1,"Unknown error encountered, rethrowing: ".concat(Object(s.l)(e)),593278724),e;switch(e.errorCode){case-2130957565:case-2130957551:throw e;case-2130957536:return;default:Object(l.k)().assertConditionTag(!1,"Unexpected error: Name: ".concat(e.name," errorCode: ").concat(e.errorCode," Tag: ").concat(e.tag," internalDetails: ").concat(Object(s.l)(e)),e.tag)}}(e)}}}};var Vn=n(743),Fn=n(315),Nn=function(e){return function(t){return function(n){return function(a){var o,r,i=t.getState(),s=n(a),d=t.getState();switch(a.type){case"BEGIN_DRAFTING_SUCCESS":var c=xe.h(d),l=a.payload.draftDetails.sessionConfiguration.draftId;(m=c.drafts[l])&&e.setDeferredActiveEditorFocusCommand(l);break;case"DISPLAY_DRAFT_WARNING":if(a.payload.draftWarningType===Fn.a.CommitFailed)break;var m;c=xe.h(d);(m=Object(_e.H)(c))&&e.setDeferredActiveEditorFocusCommand(m.sessionConfiguration.draftId)}return(null===(o=xe.t(d))||void 0===o?void 0:o.selectedCardId)===(null===(r=xe.t(i))||void 0===r?void 0:r.selectedCardId)&&xe.h(d)===xe.h(i)||e.clearPendingOnComponentFocusedRequest(),s}}}},Mn=n(154),Ln=function(e){return function(t){return function(t){return function(n){switch(n.type){case"DISPLAY_DRAFT_WARNING":if(!b.C())break;var a=Mn.e(e,n.payload.draftWarningType);Object(K.b)(n.payload.draftWarningType===Fn.a.ReturnToDraft?e.formatString(230,a):a)}return t(n)}}}},Hn=n(2838),Un=n(1006);var Bn;function zn(e){e.timerHandle&&clearTimeout(e.timerHandle)}!function(e){e[e.Yes=0]="Yes",e[e.No=1]="No",e[e.Unknown=2]="Unknown"}(Bn||(Bn={}));var Wn=function(){function e(e){var t=this;this.telemetryVisitor=e,this.trackerActivityName="E2EPerfTracker",this.performanceActivities={},this.failTracker=function(e,n,a){var o=t.performanceActivities[e];o&&(o.activity.failTag(n,null!=a?a:-2130957541),zn(o),delete t.performanceActivities[e])},this.timeoutTracker=function(e,n,a){var o=t.performanceActivities[e];o&&(zn(o),o.activity.addDataField("Timeout",!0,l.d.SystemMetadata),n.failOnTimeout?o.activity.failTag(a,-2130957491):o.activity.successTag(a),delete t.performanceActivities[e])}}return e.prototype.beginTracking=function(e,t,n,a,o){var r=this;void 0===o&&(o={timeout:5e3,failOnTimeout:!0});var i=a||Object(l.k)().createActivityObject(this.trackerActivityName,this.telemetryVisitor,Object(l.j)());i.addDataField("OperationType",n,l.d.SystemMetadata),this.performanceActivities.hasOwnProperty(e)&&(Object(l.k)().assertConditionTag(!1,"Duplicate ID used for PerfActivity. Overwriting initial perf tracker with failure.",595132703),this.failTracker(e,s.d.reserveTag(595907678)));var d={activity:i,expectedChangeType:t};d.timerHandle=setTimeout((function(){return r.timeoutTracker(e,o,s.d.reserveTag(575484417))}),o.timeout),this.performanceActivities[e]=d},e.prototype.updateTrackerId=function(e,t){if(e!==t){this.performanceActivities.hasOwnProperty(t)&&(Object(l.k)().assertConditionTag(!1,"Duplicate ID used for updateTrackerId. Overwriting initial perf tracker with failure.",595132704),this.failTracker(t,s.d.reserveTag(595132705)));var n=this.performanceActivities[e];n&&(this.performanceActivities[t]=n,delete this.performanceActivities[e])}},e.prototype.failAllTrackers=function(e,t){var n=this;Object.keys(this.performanceActivities).forEach((function(a){var o=n.performanceActivities[a];zn(o),o.activity.failTag(e,null!=t?t:-2130957541)})),this.performanceActivities={}},e.prototype.endTracker=function(e,t,n){var a=this.performanceActivities[e];a&&(zn(a),a.activity.addDataField("ExpectedChangeArrived",a.expectedChangeType===t?Bn.Yes:Bn.No,l.d.SystemMetadata),a.activity.successTag(n),delete this.performanceActivities[e])},e.prototype.endAllTrackers=function(e){for(var t in this.performanceActivities){var n=this.performanceActivities[t];zn(n),n.activity.addDataField("ExpectedChangeArrived",Bn.Unknown,l.d.SystemMetadata),n.activity.successTag(e)}this.performanceActivities={}},e.prototype.getTracker=function(e,t){var n=this.performanceActivities[e];if(n&&n.expectedChangeType===t)return n},e}(),Gn=function(){function e(e){this.telemetryVisitor=e,this.trackerActivityName="LowFidelityScenarioTracker"}return e.prototype.beginTracking=function(e){var t=Object(ke.b)(e);this.activity&&t!==this.selectedCommentId&&(this.activity.addDataField("OperationType","SHOW_LOW_FIDELITY_WARNING",l.d.SystemMetadata),this.activity.successTag(593098840),this.activity=void 0,this.selectedCommentId=void 0),this.activity||this.selectedCommentId||(this.activity=Object(l.k)().createActivityObject(this.trackerActivityName,this.telemetryVisitor,Object(l.j)()),this.selectedCommentId=t)},e.prototype.endTrackingIfWarningDismissed=function(e,t){var n=Object(ke.b)(t);!this.activity||n===this.selectedCommentId&&Object(ke.h)(t)||(this.activity.addDataField("OperationType",e.type,l.d.SystemMetadata),this.activity.successTag(593098841),this.activity=void 0,this.selectedCommentId=void 0)},e}();function Yn(e,t){t?e.addDataField("AffectingTaskMetadata",!0,l.d.SystemMetadata):e.addDataField("AffectingTaskMetadata",!1,l.d.SystemMetadata)}function Kn(e,t,n,a){var o=Object(Ae.b)(t,a);if(o){var r,i=Object(Ct.j)(o);(r=Object(Ae.c)(t)?n[i].some((function(e){return 0!=(t[e].commentFlags&Ct.e.IsNew)})):t.some((function(e){return(e.commentId===i||e.parentId===i)&&0!=(e.commentFlags&Ct.e.IsNew)})))&&e.addDataField("HasNewComment",r,l.d.SystemMetadata)}}var qn=function(e){var t=new Wn(e),n=new Gn(e),o=Object(Hn.a)((function(e){Object(l.k)().createActivityObject("PostButtonTeachingCallout",e.actionDetail.telemetryVisitor,Object(l.j)()).successTag(573687565)}));return function(e){return function(r){return function(i){var d,c,m=function(){var t,n,a,o,s,d,c=Pn(i);if(!c)return Object(l.k)().assertConditionTag(!1,"Event name not defined for action type: ".concat(i.type),595616738),r(i);var m=Object(l.k)().createActivityObject(c.name,i.actionDetail.telemetryVisitor,c.activityConfig);m.addDataField("Trackback",i.actionDetail.trackback,l.d.SystemMetadata),m.addDataField("RenderContextType",i.actionDetail.renderContextType,l.d.SystemMetadata),c.logDocumentMetadata&&m.addDocumentMetadata(c.logDocumentMetadata);var u=function(e,t,n){var a=Object(_e.h)(e,n);a.valid&&(m.addDataField("MatchesCommentAuthor",a.matchesCurrentUser,l.d.SystemMetadata),m.addDataField("ThreadCreationDeltaMs",a.timeElapsed,l.d.SystemMetadata)),Kn(m,e,t,n)},p=e.getState(),f=bn.b(p);switch(Object(Ie.c)(p,m),i.type){case"COMMIT_DRAFT":var g=function(e){if("COMMIT_DRAFT"===e.type)return{name:"CommitDraft".concat(Object(An.b)(e.payload),"Action"),activityConfig:wn}}(i);if(!g)return Object(l.k)().assertConditionTag(!1,"Event name not defined for given draft action type",595903002),r(i);var h=Object(l.k)().createActivityObject(g.name,i.actionDetail.telemetryVisitor,Object(l.j)());h.addDataField("RenderContextType",i.actionDetail.renderContextType,l.d.SystemMetadata),h.successTag(595903074);var C=yt.b[i.payload.sessionType];m.addDataField("SessionType",C,l.d.SystemMetadata),"REPLY"===i.payload.sessionType&&Kn(m,xe.d(p),xe.b(p),i.payload.data.parentId);break;case"DISPLAY_DRAFT_WARNING":m.addDataField("DraftWarningType",i.payload.draftWarningType,l.d.SystemMetadata),m.addDataField("DraftWarningReason",i.payload.draftWarningReason,l.d.SystemMetadata);var v=Object(_e.K)(p.commentState.draftState);v&&m.addDataField("IsDraftInCurrentContext",v.isInCurrentContext,l.d.SystemMetadata);break;case"UPDATE_DRAFT_RENDER_CONTEXT":m.addDataField("IsClaimingDraftLock",i.payload.isClaimingLock,l.d.SystemMetadata),m.addDataField("IsUpdatingAllDraftLocks",!i.payload.draftId,l.d.SystemMetadata);break;case"SELECT_COMMENT":m.addDataField("SelectType",ye.SelectActionType[i.payload.selectType],l.d.SystemMetadata),m.addDataField("ActionSource",Te.a[i.payload.source],l.d.SystemMetadata);var b=xe.t(p),y=!(!b||b.selectedCardId!==i.payload.selectedCard);m.addDataField("IsCurrentCard",y,l.d.SystemMetadata),y||Kn(m,xe.d(p),xe.b(p),i.payload.selectedCard),Object(Un.b)(i.payload.source)&&Object(Un.c)(i.payload.selectType)&&Object(Un.d)(m,Object(Un.a)(xe.e(p,i.payload.selectedCard)));break;case"REQUEST_THREAD_RESOLVE":case"REQUEST_REOPEN_THREAD":Yn(m,i.payload.isTask),u(xe.d(p),xe.b(p),i.payload.commentId);var T=void 0;if(i.payload.isTask){T="REQUEST_THREAD_RESOLVE"===i.type?"ResolveThreadWithTask":"ReopenThreadWithTask",m.addDataField(T,!0,l.d.SystemMetadata,l.e.Critical);var I=null===(a=null===(n=null===(t=f[i.payload.commentId])||void 0===t?void 0:t.history[0])||void 0===n?void 0:n.records[0])||void 0===a?void 0:a.time;m.addDataField("TaskCreationTimeDeltaMs",I?Date.now()-I.getTime():0,l.d.SystemMetadata,l.e.Critical)}Object(Un.d)(m,Object(Un.a)(xe.e(p,i.payload.commentId)));break;case"REQUEST_DELETE_THREAD":if(Yn(m,i.payload.isTask),i.payload.isTask){m.addDataField("DeleteThreadWithTask",!0,l.d.SystemMetadata,l.e.Critical);I=null===(d=null===(s=null===(o=f[i.payload.commentId])||void 0===o?void 0:o.history[0])||void 0===s?void 0:s.records[0])||void 0===d?void 0:d.time;m.addDataField("TaskCreationTimeDeltaMs",I?Date.now()-I.getTime():0,l.d.SystemMetadata,l.e.Critical)}Object(Un.d)(m,Object(Un.a)(xe.e(p,i.payload.commentId))),u(xe.d(p),xe.b(p),i.payload.commentId);break;case"REQUEST_DELETE_POST":u(xe.d(p),xe.b(p),i.payload.commentId)}try{var O=e.getState(),_=r(i),S=e.getState(),j=xe.h(O),k=xe.h(S);switch(i.type){case"UPDATE_DRAFT_RENDER_CONTEXT":var x=i.payload.draftId?j.drafts[i.payload.draftId]:Object(_e.K)(j),E=i.payload.draftId?k.drafts[i.payload.draftId]:Object(_e.K)(k),D=void 0!==x&&void 0!==E&&x.renderContextType!==E.renderContextType;m.addDataField("DidDraftLockUpdate",D,l.d.SystemMetadata)}return m.successTag(595616739),_}catch(e){throw m.failTag(595616768,Object(En.a)(e,-2130957541)),e}};switch(i.type){case"BEGIN_PROCESSING_COMMIT":var u=Object(l.k)().createActivityObject(t.trackerActivityName,i.actionDetail.telemetryVisitor,Object(l.j)());try{m()}catch(e){throw u.failTag(595687567,Object(En.a)(e,-2130957541)),e}if(!(f=xe.v(e.getState()))){u.failTag(595687569,-2130957541);break}var p=f.commentDraft.sessionConfiguration;t.beginTracking(p.draftId,yt.a[p.sessionType],p.sessionType,u);break;case"COMMIT_FAILURE":var f=xe.v(e.getState());Object(l.k)().assertConditionTag(!!f,"Draft should exist when failing a commit.",595132701),f&&t.failTracker(f.commentDraft.sessionConfiguration.draftId,s.d.reserveTag(595132702)),r(i);break;case"REQUEST_THREAD_RESOLVE":case"REQUEST_REOPEN_THREAD":t.beginTracking(i.payload.commentId,vt.a.Modify,i.type);try{m()}catch(e){throw t.failTracker(i.payload.commentId,s.d.reserveTag(595907670),Object(En.a)(e,-2130957541)),e}break;case"REQUEST_DELETE_POST":case"REQUEST_DELETE_THREAD":t.beginTracking(i.payload.commentId,vt.a.Delete,i.type);try{m()}catch(e){throw t.failTracker(i.payload.commentId,s.d.reserveTag(595907671),Object(En.a)(e,-2130957541)),e}break;case"COMMENT_CONTEXT_CHANGED":try{r(i)}catch(e){throw t.failAllTrackers(s.d.reserveTag(595731294),Object(En.a)(e,-2130957541)),e}break;case"LOAD_COMMENT":case"VIRTUALIZE_COMMENTS":if(("LOAD_COMMENT"===i.type?i.payload.commentData:i.payload.threadInfo).length>0&&!t.getTracker("LoadCommentTracker",vt.a.Load)){u=Object(l.k)().createActivityObject(t.trackerActivityName,i.actionDetail.telemetryVisitor,Object(l.j)());t.beginTracking("LoadCommentTracker",vt.a.Load,i.type,u,{timeout:1e6,failOnTimeout:!1})}r(i);break;case"RELOAD_COMMENTS":try{m()}catch(e){throw t.failAllTrackers(s.d.reserveTag(595907672),Object(En.a)(e,-2130957541)),e}t.endAllTrackers(s.d.reserveTag(595907673));break;case"ON_INITIAL_RENDER":var g=t.getTracker("LoadCommentTracker",vt.a.Load);g&&(g.activity.addDataField("RenderContextType",i.payload.renderContextType,l.d.SystemMetadata),t.endTracker("LoadCommentTracker",vt.a.Load,s.d.reserveTag(595646476))),r(i);break;case"APPLY_COMMENT_CHANGES":try{m()}catch(e){throw t.failAllTrackers(s.d.reserveTag(595907674),Object(En.a)(e,-2130957541)),e}try{for(var h=Object(a.__values)(i.payload.changes),C=h.next();!C.done;C=h.next()){var v=C.value;if(v.type===vt.a.Load||v.type===vt.a.Unknown)break;if(v.type!==vt.a.Delete&&v.type!==vt.a.Modify){if(v.type===vt.a.Insert){void 0!==v.tempId&&""===v.model.parentId&&Object(Dt.a)(i.actionDetail.telemetryVisitor);var b=v.tempId||v.model.parentId;void 0!==b&&t.endTracker(b,v.type,s.d.reserveTag(595857620))}}else t.endTracker(v.model.commentId,v.type,s.d.reserveTag(595907675))}}catch(e){d={error:e}}finally{try{C&&!C.done&&(c=h.return)&&c.call(h)}finally{if(d)throw d.error}}break;case"COMMIT_DRAFT":f=xe.v(e.getState());if(m(),i.payload.data.temporaryCommentId&&f){var y=void 0;switch((p=f.commentDraft.sessionConfiguration).sessionType){case"CREATE":!function(e){Object(Dt.a)(e)}(i.actionDetail.telemetryVisitor),y=i.payload.data.temporaryCommentId;break;case"REPLY":y=i.payload.data.temporaryCommentId;break;case"EDIT":y=p.commentId;break;case"METADATA":y=p.threadId;break;default:Object(s.m)(p)}y&&t.updateTrackerId(p.draftId,y)}break;case"DISPATCH_LOAD_THREADS":case"CANCEL_COMMENT_CREATE_THREAD":case"CANCEL_COMMENT_POST_EDIT":case"CANCEL_COMMENT_REPLY":case"PRESENT_LINK_TO_COMMENT":case"SELECT_FIRST_COMMENT_IN_NEXT_POPULATED_CONTEXT":case"SELECT_LAST_COMMENT_IN_PREVIOUS_POPULATED_CONTEXT":case"SESSION_REQUEST_STARTED":case"UPDATE_DRAFT_RENDER_CONTEXT":case"SELECT_COMMENT":case"DISPLAY_DRAFT_WARNING":case"CLEAR_LOW_FIDELITY_WARNING":m();break;case"SHOW_LOW_FIDELITY_WARNING":m();var T=xe.t(e.getState());T&&n.beginTracking(T);break;case"VIEW_CONTAINER_VISIBILITY_CHANGED":var I="";switch(i.payload.visibilityState){case z.a.Closed:I="ViewContainerClosed";break;case z.a.Hidden:I="ViewContainerHidden";break;case z.a.Visible:I="ViewContainerVisible";break;default:Object(s.m)(i.payload.visibilityState)}var O=Object(l.k)().createActivityObject(I,i.actionDetail.telemetryVisitor,Object(l.n)({aggregationMode:l.a.Always}));r(i),O.successTag(592241220);break;case"DRAFT_EMPTINESS_CHANGED":var _=xe.h(e.getState()).drafts[i.payload.draftId].commentDraft.sessionConfiguration.sessionType;_!==Ct.c&&_!==Ct.h||o(i),r(i);break;case"CLEAR_COMMENT_SELECTION":default:r(i)}var S=xe.t(e.getState());S&&n.endTrackingIfWarningDismissed(i,S)}}}},Qn=n(648),Xn=n(475),Jn=n(745),Zn=function(e,t){return function(e){return function(n){return function(a){switch(a.type){case"REQUEST_SHOW_PANE":(r=De.d(e.getState())).openView();break;case"REQUEST_CLOSE_PANE":(r=De.d(e.getState())).closeView();break;case"MOVE_FOCUS_TO_CANVAS":if(!vn.b(e.getState()))(r=De.d(e.getState())).moveFocusToCanvas_donotuse();break;case"REQUEST_MODAL_CONFIRMATION":(r=De.d(e.getState())).invokeModalConfirmationDialog?r.invokeModalConfirmationDialog(a.payload.onConfirm,a.payload.onCancel,a.payload.displayStrings):(Object(l.k)().assertConditionTag(!1,"Host does not have modal dialog implemented",593278688),r.closeView());break;case"READY_TO_RENDER":(r=De.d(e.getState())).onReadyToRender&&r.onReadyToRender();break;case"RESOLVE_ATMENTION_CAPABILITY":if(b.w()){var o=a.payload.capability===Qn.a.Enabled;t.initializeController(o)}break;case"BEGIN_DRAFTING_SUCCESS":var r=De.d(e.getState());Object(Xn.a)(r)&&"CREATE"===a.payload.draftDetails.sessionConfiguration.sessionType&&ea(e.dispatch,a.actionDetail,{displayMode:ve.a.Variable,desiredHeight:0}),$n(e.getState(),r);break;case"DISPLAY_DRAFT_WARNING":$n(e.getState());break;case"CANCEL_COMMENT_CREATE_THREAD":case"CANCEL_COMMENT_POST_EDIT":case"CANCEL_COMMENT_REPLY":if(a.payload.closeOnDiscard){r=De.d(e.getState());return n(a),void r.closeView()}}var i=e.getState(),s=n(a),d=e.getState();return function(e,t,n,a){var o=De.d(a);if(!Object(Xn.a)(o))return;var r=xe.h(a),i=xe.h(n),s=Object(je.c)(r),d=Object(je.c)(i),c=!!Object(_e.G)(r),l=!!Object(_e.G)(i);if(s!==d||!Object(Xn.a)(De.d(n))||!c&&l){if(!s)return c?void ea(e,t,{displayMode:ve.a.Variable,desiredHeight:0}):void ea(e,t,{displayMode:ve.a.Normal});var m=xe.t(a);if(m&&m.selectedCardId===Object(_e.G)(r))return;ea(e,t,{displayMode:ve.a.FullScreen})}}(e.dispatch,a.actionDetail,i,d),s}}}};function $n(e,t){(function(e){var t=De.e(e);return b.t()&&(b.p()?t===z.a.Hidden:t!==z.a.Visible)})(e)&&(t||De.d(e)).openView()}function ea(e,t,n){e(Object(Jn.a)(t,n)).catch(Object(j.a)(s.d.reserveTag(578426776)))}var ta=n(174),na=n(473),aa=n(311),oa=n(376),ra=n(206),ia=n(375),sa=n(1008),da=function(){function e(e,t,n){this.commentStore=e,this.commandFactory=new ct(this.commentStore,t,n)}return e.prototype.selectNextOrPreviousThread=function(e,t,n){var a=b.p()&&!De.a(this.commentStore.getState()),o=De.c(this.commentStore.getState());return sa.a(this.commandFactory.selectNextOrPreviousThread(void 0,e,t,n,a),o,this.commentStore,(function(){}))===Re.a.Handled},e.prototype.selectAcrossContexts=function(e,t){var n=De.c(this.commentStore.getState()),a=xe.f(this.commentStore.getState()),o=b.p()&&!De.a(this.commentStore.getState());sa.a(this.commandFactory.selectAcrossContexts(void 0,{direction:e,source:Te.a.SharedComments,expandCard:!0,iterableContentTypes:void 0},t,a.nextPopulatedContextDetails,o),n,this.commentStore,(function(){}))},e}(),ca=n(680),la=n(681),ma={PostHeight:69,ExpandButtonHeight:26,ReplyDraftHeight:44,TaskTopper:29};function ua(e){var t=e.itemCount,n=e.readOnly,a=e.isTask,o=ma.PostHeight;return t>1&&(o+=ma.PostHeight+0),t>2&&(o+=ma.ExpandButtonHeight+0),n||(o+=ma.ReplyDraftHeight+0),a&&(o+=ma.TaskTopper),o}function pa(e,t){return function(n){function o(){return null!==n&&n.apply(this,arguments)||this}return Object(a.__extends)(o,n),o.prototype.render=function(){var n=Object(a.__assign)(Object(a.__assign)({},t),this.props);return O.createElement(e,n)},o}(O.PureComponent)}var fa=n(47);function ga(e,t){return function(n){function o(){return null!==n&&n.apply(this,arguments)||this}return Object(a.__extends)(o,n),o.prototype.render=function(){return O.createElement(fa.Provider,{store:t},O.createElement(e,Object(a.__assign)({},this.props)))},o}(O.PureComponent)}var ha,Ca=function(){function e(e){var t=this;this.internalHandler=e,this.eventQueue=[],this._isProcessingEvents=!1,this.handler=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t._isProcessingEvents?t.internalHandler.apply(t,Object(a.__spreadArray)([],Object(a.__read)(e),!1)):t.eventQueue.push(e)}}return Object.defineProperty(e.prototype,"isProcessingEvents",{get:function(){return this._isProcessingEvents},enumerable:!1,configurable:!0}),e.prototype.pauseProcessing=function(){this._isProcessingEvents=!1},e.prototype.startProcessing=function(){var e,t;if(!this._isProcessingEvents){this._isProcessingEvents=!0;try{for(var n=Object(a.__values)(this.eventQueue),o=n.next();!o.done;o=n.next()){var r=o.value;this.handler.apply(this,Object(a.__spreadArray)([],Object(a.__read)(r),!1))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.eventQueue=[]}},e}(),va=n(96);!function(e){e.CreateThread="CreateThread",e.CancelCreateThread="CancelCreateThread",e.StartReplySession="StartReplySession",e.CancelReplySession="CancelReplySession",e.PostReply="PostReply",e.DeleteComment="DeleteComment",e.DeleteThread="DeleteThread",e.ResolveThread="ResolveThread",e.ReopenThread="ReopenThread",e.StartEditSession="StartEditSession",e.CancelEditSession="CancelEditSession",e.PostEdit="PostEdit",e.SelectComment="SelectComment",e.ClosePane="ClosePane",e.ClickGhostCard="ClickGhostCard"}(ha||(ha={}));var ba,ya=n(720),Ta=n(380),Ia=n(512),Oa=n(1011),_a=n(492),Sa=(s.d.reserveTag(595723983),s.d.reserveTag(595723984),s.d.reserveTag(574456150)),ja=s.d.reserveTag(574456151),ka=s.d.reserveTag(574456152),xa=s.d.reserveTag(574456153),Ea=n(385),Da=function(){function e(e,t){this.mockId="",this.mockContents="",this.getContentsAsync=this.getContentsAsync.bind(this),this.getId=this.getId.bind(this),this.getCursorPositionAsync=this.getCursorPositionAsync.bind(this),e&&(this.mockId=e),t&&(this.mockContents=t)}return e.prototype.getId=function(){return this.mockId},e.prototype.getContentsAsync=function(){return Promise.resolve(this.mockContents)},e.prototype.getCursorPositionAsync=function(){return Promise.resolve(void 0)},e}(),Aa=function(){function e(e){this.mockContents="",this.mockId="",e&&(this.mockId=e)}return e.prototype.getContentsAsync=function(){return Promise.resolve(this.mockContents)},e.prototype.getCursorPositionAsync=function(){return Promise.resolve(void 0)},e.prototype.setContents=function(e){this.mockContents=e},e.prototype.getId=function(){return this.mockId},e}();!function(e){e[e.None=0]="None",e[e.NeedDrafting=1]="NeedDrafting",e[e.NeedNotDrafting=2]="NeedNotDrafting"}(ba||(ba={}));var wa=function(){function e(e){this.mockContents="",this.mockId="",e&&(this.mockId=e)}return e.prototype.getId=function(){return this.mockId},e}(),Pa=function(){function e(e,t){var n=this;this.viewManager=e,this.mockUIDriver=t,this.pendingActionReason=ba.None,this.pendingAction=void 0,this.startProcessingActionsPending=void 0,this.getActiveComponentTree=function(e){return De.a(e)?De.c(e):n.viewManager.getComponentTreeForRenderMode(p.e.Integrated)},this.makeGetRenderableItemThreads=function(e){return Object(va.a)([xe.h,xe.g,xe.c,e,n.getActiveComponentTree],(function(e,t,n,a,o){return ot.c(a,n,t,o.componentTreeId.renderContextType!==Ve.a.HalfPane,Object(Oa.a)(e,o.componentTreeId.renderContextType))}))},this.getCompleteHostableCommentCardRendererOwnProps=function(e){return Object(a.__assign)(Object(a.__assign)({},n.viewManager.getHostableCommentCardRendererProps(p.e.Integrated)),{resource:{id:e},componentInstanceId:Object(d.a)()})},this.getCompletePaneOwnProps=function(){return Object(a.__assign)(Object(a.__assign)({},n.viewManager.getPaneOwnProps()),{resource:{id:"CommentPane"}})},this.getDispatchProps=function(e){var t=n.commentStore.getState(),a=n.commentStore.dispatch;return De.a(t)?Object(ya.b)(a,n.getCompletePaneOwnProps()):Object(ya.a)(a,n.getCompleteHostableCommentCardRendererOwnProps(e))},this.getNewThreadDraftId=function(){return Object(_e.G)(xe.h(n.commentStore.getState()),!0)},this.getParentId=function(e){var t=n.commentStore.getState(),a=xe.d(t),o=Object(Ae.b)(a,e);return o?Object(r.h)(o):void 0},this.invokeModalDialog=function(e,t,a){var o=n.commentStore.getState(),r={renderContextType:n.getActiveComponentTree(o).componentTreeId.renderContextType,trackback:s.d.reserveTag(592240791),telemetryVisitor:n.viewManager.getTelemetryVisitor()},i=n.commentStore.dispatch,d=n.getCompletePaneOwnProps(),c=Object(ya.b)(i,d),l=xe.t(o);switch(e){case Ta.a.CancelNewDraft:case Ta.a.CancelReplyDraft:case Ta.a.CancelPostEdit:return c.discardDraftAsync(r,Te.a.SharedComments,!1);case Ta.a.DeleteThread:return l&&c.requestDeleteThread(r,l.selectedCardId),Promise.resolve(ra.a.Handled);case Ta.a.ClosePaneDraft:return Ia.p({ownProps:d,dispatchProps:c,componentTree:n.getActiveComponentTree(o),draftState:xe.h(o),invokeModalDialog:n.invokeModalDialog}),Promise.resolve(ra.a.Handled);default:Object(s.m)(e)}},this.updateEventProcessingState=function(e){var t=xe.q(n.previousStoreState),a=xe.q(e);!t&&a&&n.pauseProcessing(),t&&!a&&n.beginProcessing()},this.handleStoreUpdate=function(){var e=n.commentStore.getState(),t=xe.h(e),a=xe.h(n.previousStoreState);!Object(je.d)(t)&&n.pendingActionReason===ba.NeedNotDrafting&&n.pendingAction&&(Object(l.k)().createActivityObject("TriggerPendingActionNeedNotDrafting",n.viewManager.getTelemetryVisitor(),Object(l.n)({diagnosticLevel:l.b.FullEvent})).successTag(592269458),n.pendingAction(),n.pendingAction=void 0,n.pendingActionReason=ba.None);var o=Object(je.b)(t),r=Object(je.b)(a);o&&!r&&n.pendingActionReason===ba.NeedDrafting&&n.pendingAction&&(Object(l.k)().createActivityObject("OnNotDraftingCallback",n.viewManager.getTelemetryVisitor(),Object(l.n)({diagnosticLevel:l.b.FullEvent})).successTag(592269459),n.pendingAction(),n.pendingAction=void 0,n.pendingActionReason=ba.None),n.updateEventProcessingState(e),n.previousStoreState=e},this.onDrafting=function(e){var t=Object(l.k)().createActivityObject("OnDraftingCallback",n.viewManager.getTelemetryVisitor(),Object(l.n)({diagnosticLevel:l.b.FullEvent}));Object(je.b)(xe.h(n.commentStore.getState()))?(t.addDataField("ActionDeferred",!1,l.d.SystemMetadata),e(),t.successTag(592269460)):(t.addDataField("ActionDeferred",!0,l.d.SystemMetadata),n.pendingAction=e,n.pendingActionReason=ba.NeedDrafting,t.successTag(592269461))},this.onNotDrafting=function(e){var t=Object(l.k)().createActivityObject("OnNotDraftingCallback",n.viewManager.getTelemetryVisitor(),Object(l.n)({diagnosticLevel:l.b.FullEvent}));Object(je.d)(xe.h(n.commentStore.getState()))?(t.addDataField("ActionDeferred",!0,l.d.SystemMetadata),n.pendingAction=e,n.pendingActionReason=ba.NeedNotDrafting,t.successTag(592269462)):(t.addDataField("ActionDeferred",!1,l.d.SystemMetadata),e(),t.successTag(592269463))},this.runAction=function(e,t){switch(e){case ba.NeedDrafting:return n.onDrafting(t);case ba.NeedNotDrafting:return n.onNotDrafting(t);case ba.None:return t()}},this.onMockUIAction=new Ca((function(e){var t=Object(l.k)().createActivityObject("OnMockUIAction",n.viewManager.getTelemetryVisitor(),Object(l.n)({diagnosticLevel:l.b.FullEvent}));t.addDataField("MockUIActionType",e.actionType,l.d.SystemMetadata);try{switch(e.actionType){case ha.CreateThread:!function(e){return e.actionType===ha.CreateThread&&void 0!==e.content}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269464):n.runAction(ba.NeedDrafting,(function(){return n.onCreateOrReply(new Da(n.getNewThreadDraftId(),e.content))}));break;case ha.CancelCreateThread:!function(e){return e.actionType===ha.CancelCreateThread}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269465):n.runAction(ba.NeedDrafting,(function(){return n.onCancelCreateThread(new Da(n.getNewThreadDraftId()))}));break;case ha.StartReplySession:!function(e){return e.actionType===ha.StartReplySession&&void 0!==e.threadId}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269466):n.runAction(ba.NeedNotDrafting,(function(){return n.onStartReplySession(new Da(e.threadId))}));break;case ha.CancelReplySession:!function(e){return e.actionType===ha.CancelReplySession&&void 0!==e.threadId}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269467):n.runAction(ba.NeedDrafting,(function(){return n.onCancelReplySession(new Da(e.threadId))}));break;case ha.PostReply:!function(e){return e.actionType===ha.PostReply&&void 0!==e.threadId&&void 0!==e.content}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269468):n.runAction(ba.NeedDrafting,(function(){return n.onCreateOrReply(new Da(e.threadId,e.content))}));break;case ha.DeleteComment:!function(e){return e.actionType===ha.DeleteComment&&void 0!==e.commentId}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269469):n.runAction(ba.NeedNotDrafting,(function(){return n.onDeleteComment(e.commentId)}));break;case ha.DeleteThread:!function(e){return e.actionType===ha.DeleteThread&&void 0!==e.threadId}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269470):n.runAction(ba.NeedNotDrafting,(function(){return n.onDeleteThread(e.threadId)}));break;case ha.ResolveThread:!function(e){return e.actionType===ha.ResolveThread&&void 0!==e.threadId}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269471):n.runAction(ba.NeedNotDrafting,(function(){return n.onResolveThread(e.threadId)}));break;case ha.ReopenThread:!function(e){return e.actionType===ha.ReopenThread&&void 0!==e.threadId}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269472):n.runAction(ba.NeedNotDrafting,(function(){return n.onReopenThread(e.threadId)}));break;case ha.StartEditSession:!function(e){return e.actionType===ha.StartEditSession&&void 0!==e.commentId}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269473):n.runAction(ba.NeedNotDrafting,(function(){return n.onStartEditSession(e.commentId)}));break;case ha.CancelEditSession:!function(e){return e.actionType===ha.CancelEditSession&&void 0!==e.commentId}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269474):n.runAction(ba.NeedDrafting,(function(){return n.onCancelEditSession(new Aa(e.commentId))}));break;case ha.PostEdit:if(function(e){return e.actionType===ha.PostEdit&&void 0!==e.commentId&&void 0!==e.content}(e)){var a=new Aa(e.commentId);a.setContents(e.content),n.runAction(ba.NeedDrafting,(function(){return n.onPostEdit(a)}))}else Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269475);break;case ha.SelectComment:!function(e){return e.actionType===ha.SelectComment&&void 0!==e.commentId}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269504):n.runAction(ba.NeedNotDrafting,(function(){return n.onSelectComment(new wa(e.commentId))}));break;case ha.ClosePane:n.onClosePane();break;case ha.ClickGhostCard:!function(e){return e.actionType===ha.ClickGhostCard}(e)?Object(l.k)().assertConditionTag(!1,"Invalid action - is JS and native out of sync?",592269505):n.runAction(ba.NeedNotDrafting,(function(){return n.onGhostCommentClicked()}));break;default:Object(s.m)(e.actionType)}}catch(e){return void t.failTag(592269507,Object(En.a)(e))}t.successTag(592269508)})),this.onStartEditSession=function(e){var t=n.commentStore.getState();Ia.E({trackback:s.d.reserveTag(592269509),id:e,data:n.getFilteredRenderableItems(t),selectedComment:xe.t(t),renderContextType:n.getActiveComponentTree(t).componentTreeId.renderContextType,actionDispatchers:n.getDispatchProps(e),telemetryVisitor:n.viewManager.getTelemetryVisitor()})},this.onResolveThread=function(e,t){var a=n.commentStore.getState();Ia.m({componentTree:n.getActiveComponentTree(a),focusManager:n.viewManager.getFocusManager(),trackback:s.d.reserveTag(592269510),id:e,renderContextType:n.getActiveComponentTree(a).componentTreeId.renderContextType,dispatchProps:n.getDispatchProps(e),telemetryVisitor:n.viewManager.getTelemetryVisitor(),localizationAPI:n.viewManager.localizationAPI,isTask:t})},this.onClosePane=function(){var e=n.commentStore.getState();if(De.b(e)){var t=n.commentStore.dispatch;Object(ya.b)(t,n.getCompletePaneOwnProps()).requestClosePane({telemetryVisitor:n.viewManager.getTelemetryVisitor(),renderContextType:Ve.a.None,trackback:s.d.reserveTag(592269511)})}else Object(l.k)().assertConditionTag(!1,"Pane was already closed.",592269512)},this.onCreateOrReply=function(e){var t=e.getId(),a=n.commentStore.getState(),o=xe.h(a),i=Object(_e.K)(o),d=i&&"CREATE"===i.commentDraft.sessionConfiguration.sessionType?{type:"CREATE"}:{type:"REPLY",parentId:t};Ia.c({trackback:s.d.reserveTag(592269513),commentCardRef:e,draftState:o,areMentionsEnabled:xe.p(a).atMention===r.b.Enabled,session:d,componentTree:n.getActiveComponentTree(a),dispatchProps:n.getDispatchProps(t),telemetryVisitor:n.viewManager.getTelemetryVisitor(),localizationAPI:n.viewManager.localizationAPI,commitSource:Ea.a.Programmatic}).catch(Object(j.a)(s.d.reserveTag(592269514)))},this.onCancelCreateThread=function(e){var t=e.getId(),a=n.getDispatchProps(t),o=n.commentStore.getState(),r=xe.t(o),i=xe.h(o),d=De.b(o),c=n.getActiveComponentTree(o).componentTreeId.renderContextType,l=xe.u(o),m=(null==r?void 0:r.selectedCardId)===e.getId()&&Object(_a.b)(d,c,i,r,l),u=ot.f(n.getRenderableItemThreads(o),t);Ia.e({trackback:s.d.reserveTag(592269516),showDiscardDialog:!1,invokeModalDialog:n.invokeModalDialog,componentTree:n.getActiveComponentTree(o),dispatchProps:a,closeOnDiscard:m,cardId:t,draftState:i,telemetryVisitor:n.viewManager.getTelemetryVisitor(),localizationAPI:n.viewManager.localizationAPI,focusManager:n.viewManager.getFocusManager(),lieIndex:u})},this.onGhostCommentClicked=function(){var e=n.commentStore.getState();De.b(e)||Object(l.k)().assertConditionTag(!1,"There is no Ghost Card because the pane is closed.",592269517),n.viewManager.getPaneOwnProps().selectionManager.selectAcrossContexts(D.d.Next,n.getActiveComponentTree(e).componentTreeId.renderContextType)},this.onPostEdit=function(e){var t=n.commentStore.getState(),a=n.getParentId(e.getId());a&&Ia.C({trackback:s.d.reserveTag(592269518),id:e.getId(),data:n.getFilteredRenderableItems(t),draftState:xe.h(t),contentPromise:e.getContentsAsync(),atMentionsEnabled:xe.p(t).atMention===r.b.Enabled,componentTree:n.getActiveComponentTree(t),actionDispatchers:n.getDispatchProps(a),telemetryVisitor:n.viewManager.getTelemetryVisitor(),localizationAPI:n.viewManager.localizationAPI,commitSource:Ea.a.Programmatic}).catch(Object(j.a)(s.d.reserveTag(592269519)))},this.onCancelEditSession=function(e){var t=n.commentStore.getState(),a=xe.h(t),o=xe.t(t),r=De.b(t),i=xe.u(t),d=Object(_a.b)(r,n.getActiveComponentTree(t).componentTreeId.renderContextType,a,o,i),c=n.getFilteredRenderableItems(t),l=n.getParentId(e.getId());if(l){var m=n.getDispatchProps(l);Ia.z({trackback:s.d.reserveTag(592269521),commentId:e.getId(),setContents:e.setContents.bind(e),data:c,draftState:a,shouldClosePaneAfterDiscardDraft:d,onWillDiscardCallback:void 0,renderContextType:n.getActiveComponentTree(t).componentTreeId.renderContextType,dispatchProps:m,telemetryVisitor:n.viewManager.getTelemetryVisitor(),localizationAPI:n.viewManager.localizationAPI})}},this.onCancelReplySession=function(e){var t=n.commentStore.getState(),a=xe.t(t),o=xe.h(t),r=e.getId(),i=n.getDispatchProps(r),d=De.b(t),c=n.getActiveComponentTree(t).componentTreeId.renderContextType,l=xe.u(n.commentStore.getState()),m=(null==a?void 0:a.selectedCardId)===e.getId()&&Object(_a.b)(d,c,o,a,l);Ia.e({trackback:s.d.reserveTag(592269522),showDiscardDialog:!1,invokeModalDialog:n.invokeModalDialog,componentTree:n.getActiveComponentTree(t),dispatchProps:i,closeOnDiscard:m,cardId:e.getId(),draftState:o,telemetryVisitor:n.viewManager.getTelemetryVisitor(),localizationAPI:n.viewManager.localizationAPI,focusManager:n.viewManager.getFocusManager(),lieIndex:-1})},this.onDeleteThread=function(e){var t=n.commentStore.getState(),a=xe.t(t),o=n.getDispatchProps(e);Ia.d({trackback:s.d.reserveTag(592269523),id:e,data:n.getFilteredRenderableItems(t),selectedComment:a,componentTree:n.getActiveComponentTree(t),invokeModalDialog:n.invokeModalDialog,dispatchProps:o,telemetryVisitor:n.viewManager.getTelemetryVisitor(),localizationAPI:n.viewManager.localizationAPI,focusManager:n.viewManager.getFocusManager(),isTask:!!bn.b(t)[e],threadIndex:ot.f(n.getRenderableItemThreads(t),e),shouldCheckForLowFidelity:!0})},this.onDeleteComment=function(e){var t=n.commentStore.getState(),a=xe.t(t),o=n.getParentId(e);if(o){var r=n.getDispatchProps(o);Ia.D({trackback:s.d.reserveTag(592269524),id:e,data:n.getFilteredRenderableItems(t),selectedComment:a,renderContextType:n.getActiveComponentTree(t).componentTreeId.renderContextType,actionDispatchers:r,telemetryVisitor:n.viewManager.getTelemetryVisitor(),localizationAPI:n.viewManager.localizationAPI})}},this.onSelectComment=function(e){var t,a=n.commentStore.getState(),o=xe.g(a,!0),r=n.getNewThreadDraftId(),i=n.getFilteredRenderableItems(a),d=e.getId(),c=b.U()||d!==r?i.find((function(e){return ot.e(e)===d})):o&&{commentModel:o.newComment_deprecated};if(c&&Object(it.a)(c)){var m=c,u=n.getDispatchProps(null!==(t=m.commentModel.parentId)&&void 0!==t?t:m.commentModel.commentId),p=xe.t(a),f=xe.h(a),g=n.getActiveComponentTree(a),h=Object(Fe.a)(ot.i(c),xe.j(a),g.componentTreeId.renderContextType);Ia.J({trackback:s.d.reserveTag(592269526),renderableItem:c,selectedComment:p,cardCollapsedState:h,dispatchProps:u,telemetryVisitor:n.viewManager.getTelemetryVisitor(),shouldFocusAfter:!1,componentTree:g,draftState_deprecated:f}).catch(Object(j.a)(s.d.reserveTag(590123734)))}else Object(l.k)().assertConditionTag(!1,"Selection coming from an unknown post?",592269525)},this.onStartReplySession=function(e){Ia.a({trackback:s.d.reserveTag(592269527),threadId:e.getId(),renderContextType:n.getActiveComponentTree(n.commentStore.getState()).componentTreeId.renderContextType,dispatchProps:n.getDispatchProps(e.getId()),telemetryVisitor:n.viewManager.getTelemetryVisitor()})},this.commentStore=this.viewManager.getCommentStore(),this.previousStoreState=this.commentStore.getState(),this.unsubscribeStoreListener=this.commentStore.subscribe(this.handleStoreUpdate),this.getFilteredRenderableItems=xe.y(),this.getRenderableItemThreads=this.makeGetRenderableItemThreads(this.getFilteredRenderableItems)}return e.prototype.initialize=function(){var e=Object(l.k)().createActivityObject("InitializeMockCommentViewHelper",this.viewManager.getTelemetryVisitor(),Object(l.n)({diagnosticLevel:l.b.FullEvent}));this.registrationToken=this.mockUIDriver.onMockUIAction.subscribe(this.onMockUIAction.handler),e.successTag(ka)},e.prototype.teardown=function(){var e,t=Object(l.k)().createActivityObject("TeardownMockCommentViewHelper",this.viewManager.getTelemetryVisitor(),Object(l.n)({diagnosticLevel:l.b.FullEvent}));null===(e=this.registrationToken)||void 0===e||e.unsubscribe(),this.unsubscribeStoreListener(),t.successTag(xa)},e.prototype.beginProcessing=function(){var e=this,t=Object(l.k)().createActivityObject("StartMockUIActionProcessing",this.viewManager.getTelemetryVisitor(),Object(l.n)({diagnosticLevel:l.b.FullEvent}));this.startProcessingActionsPending=setTimeout((function(){e.onMockUIAction.startProcessing(),e.startProcessingActionsPending=void 0,t.successTag(Sa)}),100)},e.prototype.pauseProcessing=function(){var e=Object(l.k)().createActivityObject("PauseMockUIActionProcessing",this.viewManager.getTelemetryVisitor(),Object(l.n)({diagnosticLevel:l.b.FullEvent}));this.startProcessingActionsPending&&(clearTimeout(this.startProcessingActionsPending),this.startProcessingActionsPending=void 0),this.onMockUIAction.pauseProcessing(),e.successTag(ja)},e.prototype.onReopenThread=function(e,t){Ia.l({trackback:s.d.reserveTag(592269528),id:e,renderContextType:this.getActiveComponentTree(this.commentStore.getState()).componentTreeId.renderContextType,dispatchProps:this.getDispatchProps(e),telemetryVisitor:this.viewManager.getTelemetryVisitor(),localizationAPI:this.viewManager.localizationAPI,isTask:t})},e}(),Ra=n(673);var Va=n(650);function Fa(e,t,n,a){return function(o){return Object(p.g)().registerExtension(t,n,a).then((function(t){return o(Object(Va.a)(e,t)),t}))}}var Na=n(667);var Ma,La=function(){function e(){this.hostableComponentRegistry=new Map}return e.prototype.registerComponent=function(e,t,n){this.hostableComponentRegistry.has(e)||this.hostableComponentRegistry.set(e,new Map);var a=this.hostableComponentRegistry.get(e);n?a.set(t,n):a.delete(t)},e.prototype.getComponent=function(e,t){var n=this.hostableComponentRegistry.get(e);if(n)return n.get(t)},e}(),Ha=function(e){function t(t){var n=e.call(this,t)||this;return t.initializeImmediately&&n.beginInitialization(),n}return Object(a.__extends)(t,e),t}(function(){function e(e){var t=e.apiContext,n=e.viewProvider,a=e.commentAPI,o=e.peopleAPI,r=e.localizationAPI,i=e.themeAPI,c=e.focusManager,m=e.lppManager,u=e.initializationReason,f=e.commentStore,g=e.viewStrategyFactory,h=e.mockUIDriver,C=e.contentFilteredRangeAPI,v=e.contentNavigationAPI,b=this;this.initialized=!1,this.initialLoadComplete=!1,this.commentUIActionListeners=[],this.commentInterruptableCommandListeners=[],this.unprocessedActionPayloads=[],this.onInitialRender=function(e){b.commentStore.dispatch(ye.onInitialRender({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595646478),telemetryVisitor:b.telemetryVisitor},{commentId:e.commentId,renderContextType:e.renderContextType})),Object(Me.b)(e.renderContextType)&&b.sendDataReceivedCodeMarker()},this.sendDataReceivedCodeMarker=Object(Hn.a)((function(){w.sendCodeMarker({context:b.apiContext,type:x.DataReceived,assertTag:s.d.reserveTag(595731293)})})),this.getComponentTree=function(e){switch(e){case Ve.a.None:Object(s.n)(!1,"Unexpected render context type:".concat(e),s.d.reserveTag(589088338));case Ve.a.FullPane:case Ve.a.HalfPane:return b.getComponentTreeForRenderMode(p.e.TaskPaneItem);case Ve.a.DiscreteIntegrated:return b.getComponentTreeForRenderMode(p.e.Integrated);case Ve.a.DiscreteIsolated:return b.getComponentTreeForRenderMode(p.e.Isolated)}},this.getCommentContainerOwnProps=function(){return{commentAPI:b.commentAPI,localizationAPI:b.localizationAPI,peopleAPI:b.peopleAPI,focusManager:b.focusManager,telemetryVisitor:b.telemetryVisitor,onInitialRender:b.onInitialRender,correlationId:b.correlationId,lppManager:b.lppManager}},this.setComponentRef=function(e,t,n){b.viewManagerRefRegistry.registerComponent(e,t,n)},this.onSuggestionsDetailsChange=function(e){b.commentStore.dispatch(ye.updateSuggestionsDetails({renderContextType:Ve.a.None,trackback:s.d.reserveTag(592492758),telemetryVisitor:b.telemetryVisitor},e))},this.internalInterruptableCommandHandler=function(e){return b.activeViewStrategy.handleCommentInterruptableCommand(e,b.commentStore.dispatch,b.commentStore.getState)},this.createOrUpdateFilter=function(e){var t=b.contentFilteredRangeAPI;if(t&&Object(Ee.g)(b.commentStore.getState())){var n=Ee.h(b.commentStore.getState());if(Object(l.k)().assertConditionTag(n||!!Object(Ee.e)(b.commentStore.getState()),"We should have a default filter already or a default filter request should be in flight.",528779339),!n){var a=Object(Ie.a)(b.commentStore.getState());a?b.updateFilter(a,e):b.createFilter(t,e)}}else Object(l.k)().assertConditionTag(!1,"Should not request new filter with gate off",528779338)},this.updateFilter=function(e,t){b.commentStore.dispatch(ye.updateFilterRange({renderContextType:Ve.a.FullPane,telemetryVisitor:b.telemetryVisitor,trackback:s.d.reserveTag(528779344)},{filterId:e,changes:[{type:"FilterUpdate",updatedFilter:t}]}))},this.createFilter=function(e,t){e.createFilteredRange({contentTypes:[p.b.CommentThread],filters:t,supportsFilterUpdates:!0}).then((function(e){b.commentStore.dispatch(ye.loadFilter({renderContextType:Ve.a.FullPane,telemetryVisitor:b.telemetryVisitor,trackback:s.d.reserveTag(528779340)},{filteredRange:e,shouldSetActive:!0}))})).catch(Object(j.a)(s.d.reserveTag(528779341)))},this.apiContext=t,this.viewProvider=n,this.commentAPI=a,this.peopleAPI=o,this.localizationAPI=r,this.themeAPI=i,this.focusManager=c,this.contentFilteredRangeAPI=C,this.contentNavigationAPI=v,this.lastInitializationReason=u,this.viewStrategyFactory=g,this.mockUIDriver=h,this.telemetryVisitor=B.getTelemetryVisitor(this.apiContext),this.correlationId=B.getCorrelationId(this.apiContext)||Object(d.a)(),this.lppManager=m,this.registerComponentUIActionListener=this.registerComponentUIActionListener.bind(this),this.registerInterruptableCommandListener=this.registerInterruptableCommandListener.bind(this),this.onCommentEventReceived=this.onCommentEventReceived.bind(this),this.onCommentUIAction=this.onCommentUIAction.bind(this),this.onCommentInterruptableCommandReceived=this.onCommentInterruptableCommandReceived.bind(this),this.unregisterComponentUIActionListener=this.unregisterComponentUIActionListener.bind(this),this.unregisterComponentInterruptableCommandListener=this.unregisterComponentInterruptableCommandListener.bind(this),this.onViewContainerEvent=this.onViewContainerEvent.bind(this),this.observeStore=this.observeStore.bind(this),this.onChange=this.onChange.bind(this),this.onFirstLoadComplete=this.onFirstLoadComplete.bind(this),this.getComponentTreeForRenderMode=this.getComponentTreeForRenderMode.bind(this),this.selectionManager=new da(f,this.telemetryVisitor,!!this.contentNavigationAPI);var y=f.getState();this.activeViewStrategy=this.viewStrategyFactory.createViewStrategy(y.paneState.viewContainer,this.localizationAPI,this.peopleAPI,this.commentAPI,this.selectionManager,this.focusManager,this.lastInitializationReason,this.telemetryVisitor),this.commentStore=f,this.discreteIntegratedComponentTree=new $t(Ve.a.DiscreteIntegrated,this.apiContext),this.discreteIsolatedComponentTree=new $t(Ve.a.DiscreteIsolated,this.apiContext),this.viewManagerRefRegistry=new La,this.registerActions(),this.observeStore(this.commentStore),this.mockUIDriver&&(this.mockCommentViewHelper=new Pa(this,this.mockUIDriver)),this.registerInterruptableCommandListener(this.internalInterruptableCommandHandler)}return e.prototype.getMockDriver=function(){return this.mockUIDriver},e.prototype.refreshAtMentionCapability=function(){var e,t;(0,this.commentStore.dispatch)((e={renderContextType:Ve.a.None,trackback:s.d.reserveTag(595616912),telemetryVisitor:this.telemetryVisitor},t=this.commentAPI,function(n){var a=Object(l.k)().createActivityObject("ResolveAtMentionCapabilityState",e.telemetryVisitor,Object(l.j)());return t.checkAtMentionCapability().then((function(t){a.addDataField("AtMentionsEnabled",t,l.d.SystemMetadata),a.successTag(595903522),n(Object(Na.a)(e,t?Ct.b.Enabled:Ct.b.Disabled))}),(function(t){a.failTag(595903523,Object(En.a)(t,-2130957528)),n(Object(Na.a)(e,Ct.b.Disabled))}))})).catch(Object(j.a)(s.d.reserveTag(595152915)))},e.prototype.getCommentStore=function(){return this.commentStore},e.prototype.getFocusManager=function(){return this.focusManager},e.prototype.getInitializationReason=function(){return this.lastInitializationReason},e.prototype.getSelectionManager=function(){return this.selectionManager},e.prototype.beginInitialization=function(){var e,t,n,a=this;this.initialized||(this.contentNavigationAPI&&(this.commentStore.dispatch(ye.setContentNavigationEnablement({renderContextType:Ve.a.None,trackback:s.d.reserveTag(526405722),telemetryVisitor:this.telemetryVisitor},!0)),null===(e=this.contentFilteredRangeAPI)||void 0===e||e.getCapabilities().then((function(e){a.commentStore.dispatch(ye.setFilteringCapabilities({renderContextType:Ve.a.None,trackback:s.d.reserveTag(537421135),telemetryVisitor:a.telemetryVisitor},{capabilities:e}))})).catch(Object(j.a)(s.d.reserveTag(528779335)))),this.commentAPI.registerForCommentEvents(this.onCommentEventReceived),void 0!==this.commentAPI.registerForInterruptableCommands&&this.commentAPI.registerForInterruptableCommands(this.onCommentInterruptableCommandReceived),b.p()&&this.initializeContentExtensions(),this.viewProvider.registerForViewContainerEvents(this.onViewContainerEvent),this.refreshAtMentionCapability(),this.peopleAPI.capabilities&ta.b.GetSuggestionsDetails&&(this.commentStore.dispatch((t={renderContextType:Ve.a.None,trackback:s.d.reserveTag(592492753),telemetryVisitor:this.telemetryVisitor},n=this.peopleAPI,function(e){if(!(n.capabilities&ta.b.GetSuggestionsDetails))return Promise.resolve();var a=Object(l.k)().createActivityObject("RefreshSuggestionsDetails",t.telemetryVisitor,Object(l.n)({aggregationMode:l.a.OnSuccess}));return n.getSuggestionsDetails?n.getSuggestionsDetails().then((function(n){a.successTag(592492760),e(Object(Ra.a)(t,n))}),(function(e){a.failTag(592492761,-2130957495)})):(a.failTag(592492759,-2130957494),Promise.resolve())})).catch(Object(j.a)(s.d.reserveTag(592492754))),Object(l.k)().assertConditionTag(!!this.peopleAPI.registerForSuggestionsDetailsChanges,"registerForSuggestionsDetailsChanges expected to be defined if capability is set",592492756),this.peopleAPI.registerForSuggestionsDetailsChanges&&this.peopleAPI.registerForSuggestionsDetailsChanges(this.onSuggestionsDetailsChange)),this.mockCommentViewHelper&&this.mockCommentViewHelper.initialize(),this.initialized=!0)},e.prototype.getTelemetryVisitor=function(){return this.telemetryVisitor},e.prototype.getAtMentionAuthToken=function(){return Promise.resolve(void 0)},e.prototype.onChange=function(e){!this.initialLoadComplete&&e&&void 0===xe.q(e)&&xe.l(e)&&this.onFirstLoadComplete()},e.prototype.observeStore=function(e){var t,n=this;return e.subscribe((function(){var a=e.getState(),o=xe.q(a);o!==t&&(t=o,n.onChange(a))}))},e.prototype.onFirstLoadComplete=function(){var e=this;Object(l.k)().assertConditionTag(!this.initialLoadComplete,"Process initial pending actions should only run once.",576570016),this.initialLoadComplete=!0,this.unprocessedActionPayloads.forEach((function(t){e.onCommentUIAction(t)})),this.unprocessedActionPayloads=[],this.mockCommentViewHelper&&this.mockCommentViewHelper.beginProcessing()},e.prototype.registerActions=function(){this.commentAPI.registerForAction(oa.a.AddComment,this.onCommentUIAction),this.commentAPI.registerForAction(oa.a.NextThread,this.onCommentUIAction),this.commentAPI.registerForAction(oa.a.PreviousThread,this.onCommentUIAction),this.commentAPI.registerForAction(oa.a.DeleteThread,this.onCommentUIAction),this.commentAPI.registerForAction(oa.a.BackKeyPressed,this.onCommentUIAction),this.commentAPI.registerForAction(oa.a.ShowHideCommentPane,this.onCommentUIAction)},e.prototype.getComponentTreeForRenderMode=function(e){switch(e){case p.e.Integrated:return this.discreteIntegratedComponentTree;case p.e.Isolated:return this.discreteIsolatedComponentTree;case p.e.TaskPane:case p.e.TaskPaneItem:return De.c(this.getCommentStore().getState())}},e.prototype.getPaneOwnProps=function(){return Object(a.__assign)(Object(a.__assign)({},this.getCommentContainerOwnProps()),{selectionManager:this.selectionManager,initializationReason:this.lastInitializationReason,registerComponentUIActionListener:this.registerComponentUIActionListener,registerComponentInterruptableCommandListener:this.registerInterruptableCommandListener,unregisterComponentInterruptableCommandListener:this.unregisterComponentInterruptableCommandListener,unregisterComponentUIActionListener:this.unregisterComponentUIActionListener,correlationId:this.correlationId,createOrUpdateFilter:this.createOrUpdateFilter})},e.prototype.getHostableCommentCardRendererProps=function(e){var t=this;return Object(a.__assign)(Object(a.__assign)({},this.getCommentContainerOwnProps()),{componentTree:this.getComponentTreeForRenderMode(e),setComponentRef:function(n,a){t.setComponentRef(e,n,a)},correlationId:this.correlationId,themeAPI:this.themeAPI})},e.prototype.registerCommentCardHostableComponent=function(e,t,n){var o=this,r=ga(pa(n.HostableCommentCardRendererContainer,Object(a.__assign)({},this.getHostableCommentCardRendererProps(e))),this.commentStore),i=k(t,this.apiContext),s=Object(u.d)().registerComponent(i,r);return s.onComponentCommand.subscribe((function(t){o.processHostableComponentCommand(t,e)})),{componentController:s,contextAwareName:i}},e.prototype.initializeContentExtensions=function(){var e=this;Object(te.d)("ExtensionAwareCommentPaneContainer").then((function(t){var n;if(void 0!==t){var o=ga(pa(t.ExtensionAwareCommentPane,Object(a.__assign)(Object(a.__assign)({},e.getPaneOwnProps()),{extensionRenderMode:p.e.Integrated,themeAPI:e.themeAPI})),e.commentStore),r=k("SharedCommentPane",e.apiContext);e.commentPaneComponentController=Object(u.d)().registerComponent(r,o),b.J()&&e.commentStore.dispatch(Fa({renderContextType:Ve.a.None,trackback:s.d.reserveTag(573384478),telemetryVisitor:e.telemetryVisitor},p.b.CommentThread,r,{renderMode:p.e.TaskPane,priority:p.d.Disabled,instanceId:e.apiContext,componentDimensions:void 0})).catch(Object(j.a)(s.d.reserveTag(573384479)))}Object(te.d)("HostableCommentCardRendererContainer").then((function(t){if(void 0!==(n=t)){var a=e.registerCommentCardHostableComponent(p.e.Integrated,"DiscreteIntegratedCommentCard",n),o=a.componentController,r=a.contextAwareName;e.discreteIntegratedComponentController=o;var i=e.registerCommentCardHostableComponent(p.e.Isolated,"DiscreteIsolatedCommentCard",n),d=i.componentController,c=i.contextAwareName;e.discreteIsolatedComponentController=d;var l=e.registerCommentCardHostableComponent(p.e.TaskPaneItem,"TaskPaneItemCommentCard",n),m=l.componentController,u=l.contextAwareName;e.commentPaneItemComponentController=m,e.commentStore.dispatch(Fa({renderContextType:Ve.a.None,trackback:s.d.reserveTag(574428426),telemetryVisitor:e.telemetryVisitor},p.b.CommentThread,r,{renderMode:p.e.Integrated,priority:p.d.Disabled,instanceId:e.apiContext,componentDimensions:e.getAverageCardSize()})).catch(Object(j.a)(s.d.reserveTag(595645980))),e.commentStore.dispatch(Fa({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595616916),telemetryVisitor:e.telemetryVisitor},p.b.CommentThread,c,{renderMode:p.e.Isolated,priority:p.d.Disabled,instanceId:e.apiContext,componentDimensions:e.getAverageCardSize(),isContentAvailable:function(t){var n=e.commentStore.getState(),a=Object(la.d)(t,xe.a(n),xe.c(n)),o=xe.h(n);return Object(la.a)(t,Object(la.c)(t,xe.d(n),xe.b(n),a,xe.g(n,!0),o.drafts[t],Object(_e.G)(o)),o,Ve.a.DiscreteIsolated,Object(ca.a)(t,Ve.a.DiscreteIsolated,o))}})).catch(Object(j.a)(s.d.reserveTag(595645982))),e.commentStore.dispatch(Fa({renderContextType:Ve.a.None,trackback:s.d.reserveTag(546174344),telemetryVisitor:e.telemetryVisitor},p.b.CommentThread,u,{renderMode:p.e.TaskPaneItem,priority:p.d.Disabled,instanceId:e.apiContext,componentDimensions:e.getAverageCardSize()})).catch(Object(j.a)(s.d.reserveTag(546174345)))}})).catch(Object(j.a)(s.d.reserveTag(595645984)))})).catch(Object(j.a)(s.d.reserveTag(595645986)))},e.prototype.getAverageCardSize=function(){return{width:259,height:ua({itemCount:3,readOnly:!1,isTask:!1})}},e.prototype.processHostableComponentCommand=function(e,t){var n=this;switch(e.command){case"Focus":return void setTimeout((function(){var a;return null===(a=n.viewManagerRefRegistry.getComponent(t,e.details.componentInstanceId))||void 0===a?void 0:a.focus()}));case"UpdateComponentDataProps":break;default:return void Object(l.k)().assertConditionTag(!1,"Unexpected command type",593786644)}},e.prototype.teardownContentExtensions=function(){var e,t,n,o,r=[p.e.Integrated,p.e.Isolated,p.e.TaskPaneItem];b.J()&&r.push(p.e.TaskPane),this.commentStore.dispatch(ye.removeContentExtensions.apply(ye,Object(a.__spreadArray)([{renderContextType:Ve.a.None,trackback:s.d.reserveTag(595616917),telemetryVisitor:this.telemetryVisitor}],Object(a.__read)(r),!1))),null===(e=this.commentPaneComponentController)||void 0===e||e.unregister(),null===(t=this.commentPaneItemComponentController)||void 0===t||t.unregister(),null===(n=this.discreteIntegratedComponentController)||void 0===n||n.unregister(),null===(o=this.discreteIsolatedComponentController)||void 0===o||o.unregister()},e.prototype.teardown=function(){this.initialized&&(this.viewProvider.unregisterForViewContainerEvents(this.onViewContainerEvent),this.commentAPI.unregisterForCommentEvents(this.onCommentEventReceived),this.commentAPI.unregisterForAction(oa.a.AddComment),this.commentAPI.unregisterForAction(oa.a.NextThread),this.commentAPI.unregisterForAction(oa.a.PreviousThread),this.commentAPI.unregisterForAction(oa.a.DeleteThread),this.commentAPI.unregisterForAction(oa.a.BackKeyPressed),this.commentAPI.unregisterForAction(oa.a.ShowHideCommentPane),void 0!==this.commentAPI.unregisterForInterruptableCommands&&this.commentAPI.unregisterForInterruptableCommands(this.onCommentInterruptableCommandReceived),this.peopleAPI.capabilities&ta.b.GetSuggestionsDetails&&(Object(l.k)().assertConditionTag(!!this.peopleAPI.unregisterForSuggestionsDetailsChanges,"unregisterForSuggestionsDetailsChanges should be defined if capability is set",592492757),this.peopleAPI.unregisterForSuggestionsDetailsChanges&&this.peopleAPI.unregisterForSuggestionsDetailsChanges(this.onSuggestionsDetailsChange)),b.p()&&this.teardownContentExtensions(),this.initialized=!1)},e.prototype.registerComponentUIActionListener=function(e){this.commentUIActionListeners.push(e)},e.prototype.unregisterComponentUIActionListener=function(e){var t=this.commentUIActionListeners.indexOf(e);t>-1&&this.commentUIActionListeners.splice(t,1)},e.prototype.registerInterruptableCommandListener=function(e){this.commentInterruptableCommandListeners.push(e)},e.prototype.unregisterComponentInterruptableCommandListener=function(e){var t=this.commentInterruptableCommandListeners.indexOf(e);t>-1&&this.commentInterruptableCommandListeners.splice(t,1)},e.prototype.onCommentUIAction=function(e){var t,n;if(b.p()&&e.actionBehavior===na.a.Execute&&(this.initialized||this.beginInitialization(),!this.initialLoadComplete))return this.unprocessedActionPayloads.push(e),!0;try{for(var o=Object(a.__values)(this.commentUIActionListeners),r=o.next();!r.done;r=o.next()){var i=(0,r.value)(e);if(i!==ia.a.NotHandled)return i===ia.a.Success}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return this.activeViewStrategy.processCommentUIAction(e,this.commentStore.dispatch,this.commentStore.getState)===ia.a.Success},e.prototype.onCommentEventReceived=function(e,t){var n=Object(s.k)(s.b.Comments,aa.a[e]);this.activeViewStrategy.processCommentEvent(e,t,this.commentStore.dispatch,this.commentStore.getState),null==n||n.end(),b.p()&&!this.initialLoadComplete&&e===aa.a.CommentContextChanged&&Ot.b(t)&&0===t.numberOfComments&&this.onFirstLoadComplete()},e.prototype.onCommentInterruptableCommandReceived=function(e){var t=Promise.resolve(ra.a.Unhandled);return this.commentInterruptableCommandListeners.reduce((function(t,n){return t.then((function(t){return t!==ra.a.Unhandled?Promise.resolve(t):n(e)}))}),t)},e.prototype.onViewContainerEvent=function(e){var t=this,n=this.commentStore.dispatch;switch(e.eventType){case W.a.VisibilityChanged:return void n(ye.viewContainerVisibilityChanged({renderContextType:Ve.a.None,trackback:s.d.reserveTag(592241221),telemetryVisitor:this.telemetryVisitor},e.viewContainerVisibilityState));case W.a.ViewContainerChanged:return n(ye.viewContainerChanged({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595616919),telemetryVisitor:this.telemetryVisitor},e.newViewContainer)),void(this.activeViewStrategy=this.viewStrategyFactory.createViewStrategy(e.newViewContainer,this.localizationAPI,this.peopleAPI,this.commentAPI,this.selectionManager,this.focusManager,this.lastInitializationReason,this.telemetryVisitor));case W.a.FocusTriggered:return void(b.J()?setTimeout((function(){t.focusManager.focusCommentPaneCommand(De.c(t.commentStore.getState()))})):this.focusManager.focusCommentPaneCommand(De.c(this.commentStore.getState())));case W.a.FoldableLayoutStateChanged:n(ye.viewContainerFoldableLayoutStateChanged({renderContextType:Ve.a.None,trackback:s.d.reserveTag(591660549),telemetryVisitor:this.telemetryVisitor},e.newFoldableLayoutState))}},e}()),Ua=function(){function e(e,t,n){}return e.prototype.getAccountID=function(){return""},e.prototype.getLPPController=function(){},e.prototype.ensureLPPController=function(){throw new Error("ensureLPPController not supported in Web")},e.prototype.initializeController=function(e){},e.prototype.isInitialized=function(){return!1},e.prototype.isOnline=function(){return!1},e.prototype.refreshLPPController=function(){},e}(),Ba=n(1012),za=function(){function e(){this.maxAcceptableInterval=3e3,this.lastHeartbeatReceived=0,this.timerStarted=!1}return e.prototype.heartbeatReceived=function(){var e,t,n=this;this.lastHeartbeatReceived=Date.now(),null===(t=(e=Object(l.k)()).logDiagnosticTrace)||void 0===t||t.call(e,Object(he.a)(Ma||(Ma=Object(a.__makeTemplateObject)(["Native HeartbeatReceived"],["Native HeartbeatReceived"]))),s.d.reserveTag(540361865),l.h.Info,l.c.ProductServiceUsage,Object(l.l)(l.g.ReviewedAsNotNecessary),Object(l.o)("HeartbeatTimestamp",this.lastHeartbeatReceived,l.d.SystemMetadata)),this.timerStarted||(this.timerStarted=!0,setInterval((function(){n.checkHeartbeatInterval()}),this.maxAcceptableInterval))},e.prototype.checkHeartbeatInterval=function(){var e=Date.now()-this.lastHeartbeatReceived;e>this.maxAcceptableInterval&&Object(l.k)().assertConditionTag(!1,"Max heartbeat interval exceeded: ".concat(e),561071552)},e}(),Wa=n(269),Ga=n(489),Ya=n(682),Ka=n(683);var qa=n(668);var Qa=n(685),Xa=n(484);function Ja(e){return function(e){var t=b.p()&&!De.b(e);return xe.f(e).nextPopulatedContextDetails!==et.a.NoComments||Object(_e.d)(t?xe.a(e):xe.k(e),xe.d(e),t)}(e)&&Za(xe.h(e))}function Za(e){return b.C()||!Object(je.d)(e)}var $a=function(){function e(e,t,n,a,o){this.localizationAPI=e,this.peopleAPI=t,this.commentAPI=n,this.selectionManager=a,this.telemetryVisitor=o}return e.prototype.processCommentEvent=function(e,t,n,a){var o,r=this,i=a();switch(e){case aa.a.CommentContextChanged:if(!Ot.b(t))return void Object(l.k)().assertConditionTag(!1,"Invalid eventPayload",595912090);t.rehydrationDrafts&&t.rehydrationDrafts.forEach((function(e){var a,o,i,d,c;n((a={renderContextType:Ve.a.None,trackback:s.d.reserveTag(595912089),telemetryVisitor:r.telemetryVisitor},o=e.draftId,i=t.contextDrafts,d=r.commentAPI,c=r.peopleAPI,function(e,t){var n=Object(kn.a)().getItem(o);if(!n)return Object(l.k)().assertConditionTag(!1,"no saved sessionStorage data for provided draft id",523510273),Promise.resolve(e(gt.a));var r,s=JSON.parse(n);if(void 0===(r=s).draftContent||void 0===r.draftContent.content||void 0===r.draftingParams||void 0===r.draftingParams.sessionType||void 0===r.draftingParams.draftId)return Object(l.k)().assertConditionTag(!1,"sessionStorage information is the wrong format",523510274),Promise.resolve(e(gt.a));Object(kn.a)().removeItem(o);var m={inCurrentContext:!!(null==i?void 0:i.some((function(e){return e.draftId===s.draftingParams.draftId}))),isDraftEmpty:""===s.draftContent.content};return e(Object(Ga.a)(a,d,s.draftingParams,!1,c,m)).then((function(){var n=xe.v(t());if(!n)return Object(l.k)().assertConditionTag(!1,"no active draft to save to session",520136543),e(gt.a);var o={draftId:n.commentDraft.sessionConfiguration.draftId,draftContent:{editorContent:Promise.resolve(s.draftContent.content),editorCursorPosition:Promise.resolve(s.draftContent.cursorPosition)}};return e(Object(qa.a)(a,o))}))})).catch(Object(j.a)(s.d.reserveTag(523362973)))})),n(ye.commentContextChanged({renderContextType:Ve.a.None,trackback:s.d.reserveTag(512361622),telemetryVisitor:this.telemetryVisitor},t));break;case aa.a.CommentsChanged:if(!Ot.h(t))return void Object(l.k)().assertConditionTag(!1,"Invalid eventPayload",595912091);break;case aa.a.LoadComments:if(!Ot.i(t))return void Object(l.k)().assertConditionTag(!1,"Invalid eventPayload",595912092);break;case aa.a.CommentSelected:if(!Ot.g(t))return void Object(l.k)().assertConditionTag(!1,"Invalid eventPayload",595912096);if(t.commentId){var d=void 0;if(void 0!==xe.c(i)[t.commentId])d=Object(Qa.a)(t.commentId,Te.a.Canvas,{selectType:t.selectionReason&&"ContentNavigation"===t.selectionReason.type&&t.selectionReason.contentNavigationReason===D.c.Keyboarding?ye.SelectActionType.SelectCard:ye.SelectActionType.ExpandCard});else{var c=Object(Ae.b)(xe.d(i),t.commentId);if(void 0===c)return;d=Object(Qa.a)(c.parentId,Te.a.Canvas,{selectType:ye.SelectActionType.SelectPost,selectedPost:t.commentId})}n(Object(Qa.b)(void 0,{renderContextType:Ve.a.None,trackback:s.d.reserveTag(579744149),telemetryVisitor:this.telemetryVisitor},d,!1)).catch(Object(j.a)(s.d.reserveTag(579744150)))}else n(ye.clearCommentSelection({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595912095),telemetryVisitor:this.telemetryVisitor}));break;case aa.a.CommentContextReload:if(!Ot.d(t))return void Object(l.k)().assertConditionTag(!1,"Invalid eventPayload",595912097);break;case aa.a.CommentHighlighted:if(!Ot.f(t))return void Object(l.k)().assertConditionTag(!1,"Invalid eventPayload",595912128);t.commentId?n(ye.highlightComment({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595912098),telemetryVisitor:this.telemetryVisitor},t.commentId,Te.a.Canvas)):n(ye.clearCommentHighlight({renderContextType:Ve.a.None,trackback:s.d.reserveTag(578586723),telemetryVisitor:this.telemetryVisitor},Te.a.Canvas,void 0));break;case aa.a.NextPopulatedContextDetailsUpdated:if(!Ot.k(t)||!t.contextDetails.nextPopulatedContextDetails)return void Object(l.k)().assertConditionTag(!1,"Invalid eventPayload",595912130);n(ye.nextPopulatedContextDetailsUpdated({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595912129),telemetryVisitor:this.telemetryVisitor},t.contextDetails.nextPopulatedContextDetails));break;case aa.a.ModelCapabilitiesChanged:Ot.j(t)?n(ye.updateModelCapabilities({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595685376),telemetryVisitor:this.telemetryVisitor},t.modelCapabilityFlags,t.richTextCapabilityFlags)):Object(l.k)().assertConditionTag(!1,"Invalid eventPayload",595616784);break;case aa.a.CommentError:if(!Ot.e(t))return void Object(l.k)().assertConditionTag(!1,"Invalid eventPayload",595912131);break;case aa.a.ReturnToDraftRequested:Ot.l(t)&&n(ye.displayDraftWarning({draftWarningType:Fn.a.ReturnToDraft,draftWarningReason:Xa.a.HostRequest},{renderContextType:Ve.a.None,trackback:s.d.reserveTag(593376912),telemetryVisitor:this.telemetryVisitor}));break;case aa.a.UpdateDraftThread:Ot.n(t)?n(ye.updateDraftThread({renderContextType:Ve.a.None,trackback:s.d.reserveTag(594023371),telemetryVisitor:this.telemetryVisitor},t)):Object(l.k)().assertConditionTag(!1,"Invalid eventPayload",594023372);break;case aa.a.SmartReplyPopulated:if(!Ot.m(t))return void Object(l.k)().assertConditionTag(!1,"Invalid eventPayload for smart replies",590202467);n(ye.populateSmartReply({renderContextType:Ve.a.None,trackback:s.d.reserveTag(590202466),telemetryVisitor:this.telemetryVisitor},t));break;case aa.a.NativeHeartbeat:this.heartbeatHelper||(this.heartbeatHelper=new za),null===(o=this.heartbeatHelper)||void 0===o||o.heartbeatReceived();break;default:return void Object(l.k)().assertConditionTag(!1,"Deprecated event detected.",595912132)}},e.prototype.processCommentUIAction=function(e,t,n,a){var o,r=this,i=n();switch(e.actionType){case oa.a.ShowHideCommentPane:return ia.c(e.actionBehavior)?De.b(i)?ia.a.Success:ia.a.Fail:(ia.d(e.actionBehavior)&&(De.b(i)?t(ye.requestClosePane({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595912133),telemetryVisitor:this.telemetryVisitor})):t(ye.requestShowPane({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595912134),telemetryVisitor:this.telemetryVisitor}))),ia.a.Success);case oa.a.AddComment:if(ia.b(e.actionBehavior)){if(o=xe.h(i),!b.C()&&(Object(je.d)(o)||o.committedLieId))return ia.a.Fail}else if(ia.d(e.actionBehavior)){var d={renderContextType:Ve.a.None,trackback:s.d.reserveTag(595146382),telemetryVisitor:this.telemetryVisitor};return t(Object(Ga.a)(d,this.commentAPI,{sessionType:"CREATE"},!(!a||!a.retainSelectionOnAddComment),this.peopleAPI)).catch(Object(j.a)(s.d.reserveTag(592314376))),ia.a.Success}return ia.a.Success;case oa.a.NextThread:if(Object(l.k)().assertConditionTag(!ia.c(e.actionBehavior),"This action type does not support toggled status",595899713),ia.d(e.actionBehavior))this.handleActionOrReturnToDraft((function(){return r.selectionManager.selectNextOrPreviousThread({direction:D.d.Next,source:Te.a.SharedComments,expandCard:!0,iterableContentTypes:[p.b.CommentThread]},D.c.HostAction,Ve.a.None)}),t,b.W()?void 0:Xa.a.NextThread,s.d.reserveTag(591729749));else if(ia.b(e.actionBehavior))return Ja(i)?ia.a.Success:ia.a.Fail;return ia.a.Success;case oa.a.PreviousThread:if(Object(l.k)().assertConditionTag(!ia.c(e.actionBehavior),"This action type does not support toggled status",595899714),ia.d(e.actionBehavior))this.handleActionOrReturnToDraft((function(){return r.selectionManager.selectNextOrPreviousThread({direction:D.d.Previous,source:Te.a.SharedComments,expandCard:!0,iterableContentTypes:[p.b.CommentThread]},D.c.HostAction,Ve.a.None)}),t,b.W()?void 0:Xa.a.PreviousThread,s.d.reserveTag(591729750));else if(ia.b(e.actionBehavior))return Ja(i)?ia.a.Success:ia.a.Fail;return ia.a.Success;case oa.a.DeleteThread:if(Object(l.k)().assertConditionTag(!ia.c(e.actionBehavior),"This action type does not support toggled status",595899715),ia.b(e.actionBehavior)){if(!function(e){return!!e.selectedComment&&Za(e.draftState)}(i.commentState))return ia.a.Fail}else ia.d(e.actionBehavior)&&this.handleActionOrReturnToDraft((function(){var e=xe.t(i);e&&t(ye.requestDeleteThread({renderContextType:Ve.a.None,trackback:s.d.reserveTag(591738706),telemetryVisitor:r.telemetryVisitor},e.selectedCardId))}),t,Xa.a.DeleteThread,s.d.reserveTag(591729751));return ia.a.Success}return ia.a.NotHandled},e.prototype.beginDraftingHelper=function(e,t,n,a){return e(Object(Ga.a)({renderContextType:Ve.a.None,trackback:n,telemetryVisitor:this.telemetryVisitor},this.commentAPI,t,!1,this.peopleAPI)).catch(Object(j.a)(a)).then((function(){return r.e.Handled}))},e.prototype.handleCommentInterruptableCommand=function(e,t,n){switch(e.type){case"CreateComment":return this.beginDraftingHelper(t,{sessionType:"CREATE"},s.d.reserveTag(574371082),s.d.reserveTag(574371083));case"EditComment":var a,o=n(),i=xe.t(o);a=Object(ot.l)(Object(la.b)(e.commentId,xe.d(o),xe.b(o)),void 0);var d=Object(ot.b)(a,e.commentId);return d?Object(Ia.K)({comment:d,threads:a,selectedComment:i,warningType:ke.a.Edit})?(t(ye.showLowFidelityWarning({renderContextType:Ve.a.None,telemetryVisitor:this.telemetryVisitor,trackback:s.d.reserveTag(593000206)},e.commentId,ke.a.Edit)),Promise.resolve(r.e.Handled)):this.beginDraftingHelper(t,{sessionType:"EDIT",commentId:e.commentId},s.d.reserveTag(593000207),s.d.reserveTag(593000208)):(Object(l.k)().assertConditionTag(!1,"Comment not found",593000205),Promise.resolve(r.e.Handled));case"ReplyComment":return this.beginDraftingHelper(t,{sessionType:"REPLY",threadId:e.threadId},s.d.reserveTag(593000209),s.d.reserveTag(593000210));case"DiscardDraft":var c=n();if(e.mode===Ba.a.TryAutoDiscard)return t(Object(Ya.a)({renderContextType:Ve.a.None,telemetryVisitor:this.telemetryVisitor,trackback:s.d.reserveTag(575411521)},Te.a.Canvas)).then((function(e){return e.draftDiscardResult}));i=xe.t(c);if(e.mode===Ba.a.Dialog&&Object(_e.n)(xe.h(c))===Wa.a.CannotAutoDiscard)return De.a(c)?Promise.resolve(r.e.Unhandled):Promise.resolve(r.e.Canceled);var m=Object(_a.b)(De.e(c)===z.a.Visible,Object(It.a)(De.d(c).containerType),xe.h(c),i,xe.u(c));return t(Object(Ka.a)({renderContextType:Ve.a.None,telemetryVisitor:this.telemetryVisitor,trackback:s.d.reserveTag(575411522)},Te.a.Canvas,m,void 0));default:return Promise.resolve(r.e.Unhandled)}},e.prototype.handleActionOrReturnToDraft=function(e,t,n,a){t(Object(Ya.a)({renderContextType:Ve.a.None,trackback:a,telemetryVisitor:this.telemetryVisitor},Te.a.SharedComments,n)).then((function(t){void 0!==n&&t.draftDiscardBehavior!==Wa.a.NoDraft&&t.draftDiscardResult!==r.e.Handled||e()})).catch(Object(j.a)(s.d.reserveTag(591738704)))},e}(),eo=n(657),to=n(658),no=n(662),ao=n(208),oo=n(671),ro=n(672);function io(e,t,n,a){return function(o,r){var i=r();a&&o(a);var d=a?a.actionDetail.telemetryVisitor:t;if(n){if(void 0!==n.topVisibleThreadId&&o(Object(oo.a)({renderContextType:e,telemetryVisitor:d,trackback:s.d.reserveTag(595953696)},n.topVisibleThreadId||void 0)),void 0!==n.selectedCommentId){var c=xe.t(i);if(n.selectedCommentId)if(c&&c.selectedCardId===n.selectedCommentId)if(Object(ke.j)(c.selectionDetails)){var l=c.selectionDetails.selectedPostId,m=r();Object(Ae.b)(xe.d(m),l)?o(Object(ao.b)({renderContextType:e,telemetryVisitor:d,trackback:s.d.reserveTag(595953698)},n.selectedCommentId,l,ao.a.SelectPost,Te.a.Canvas)):o(Object(ao.b)({renderContextType:e,telemetryVisitor:d,trackback:s.d.reserveTag(595953699)},n.selectedCommentId,void 0,ao.a.ExpandCard,Te.a.Canvas))}else o(Object(ao.b)({renderContextType:e,telemetryVisitor:d,trackback:s.d.reserveTag(595953697)},n.selectedCommentId,void 0,ao.a.SelectCard,Te.a.Canvas));else o(Object(ao.b)({renderContextType:e,telemetryVisitor:d,trackback:s.d.reserveTag(595953728)},n.selectedCommentId,void 0,ao.a.ExpandCard,Te.a.Canvas));else if(c){var u=xe.h(i),p=u.cardIdToDraftIdMap[c.selectedCardId];p&&"CREATE"===u.drafts[p].commentDraft.sessionConfiguration.sessionType||o(Object(to.a)({renderContextType:e,telemetryVisitor:d,trackback:s.d.reserveTag(595953729)}))}}void 0!==n.highlightedCommentId&&(n.highlightedCommentId?o(Object(no.a)({renderContextType:e,telemetryVisitor:d,trackback:s.d.reserveTag(595953730)},n.highlightedCommentId,Te.a.Canvas)):o(Object(eo.a)({renderContextType:e,telemetryVisitor:d,trackback:s.d.reserveTag(578586722)},Te.a.Canvas,void 0)));var f=Yt(n);f&&o(Object(ro.a)({renderContextType:e,telemetryVisitor:d,trackback:s.d.reserveTag(595953732)},f))}}}var so=n(25),co=n(490);var lo=n(663),mo=n(665);function uo(e,t,n){return function(a){Ot.o(t)?a(Object(mo.a)(Object(so.a)(e,s.d.reserveTag(595137280)),t.threads)):(b.D()&&a(Object(co.a)(Object(so.a)(e,s.d.reserveTag(595137282)),t.comments,t.tasks,n)),a(Object(lo.a)(Object(so.a)(e,s.d.reserveTag(595137283)),t.comments,t.tasks)))}}var po=function(){function e(e,t,n,a){this.commonViewStrategy=e,this.peopleAPI=t,this.focusManager=n,this.telemetryVisitor=a}return e.prototype.processCommentEvent=function(e,t,n,a){switch(e){case aa.a.CommentsChanged:Ot.h(t)&&n(io(Ve.a.None,this.telemetryVisitor,t.contextDetails,Object(ye.applyCommentChanges)({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595937042),telemetryVisitor:this.telemetryVisitor},t.changes)));break;case aa.a.LoadComments:Ot.i(t)&&n(uo({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595899532),telemetryVisitor:this.telemetryVisitor},t,this.peopleAPI));break;case aa.a.CommentContextReload:Ot.d(t)&&n((o={renderContextType:Ve.a.None,trackback:s.d.reserveTag(595899533),telemetryVisitor:this.telemetryVisitor},r=t,i=this.peopleAPI,d=this.telemetryVisitor,function(e,t){var n=[];Object(Ot.c)(r)?(Object(l.k)().assertConditionTag(!t||xe.p(t()).virtualized,"contextReloadThunk's payload should only include comment ids when state is virtualized",595162893),n=_t(r.commentIds,(function(){return t().commentState}))):n=r.comments;var a=Object(Ot.c)(r)?[]:r.tasks;e(io(o.renderContextType,d,r.contextDetails,Object(ye.reloadComments)(Object(so.a)(o,s.d.reserveTag(595953694)),{comments:n,tasks:a}))),b.D()&&e(Object(co.a)(Object(so.a)(o,s.d.reserveTag(595932895)),n,a,i)).catch(Object(j.a)(s.d.reserveTag(595645974)))}))}var o,r,i,d;this.commonViewStrategy.processCommentEvent(e,t,n,a)},e.prototype.processCommentUIAction=function(e,t,n){if(e.actionType===r.d.AddComment&&e.actionBehavior!==r.a.CheckEnabled){var a=n();De.b(a)&&this.focusManager.onUserAction(a.paneState.componentTree,{userAction:$e.a.RequestNewCommentFromHost})}return this.commonViewStrategy.processCommentUIAction(e,t,n)},e.prototype.handleCommentInterruptableCommand=function(e,t,n){return this.commonViewStrategy.handleCommentInterruptableCommand(e,t,n)},e}();var fo=n(666);var go=function(){function e(e,t,n,a){this.commonViewStrategy=e,this.peopleAPI=t,this.lastInitializationReason=n,this.telemetryVisitor=a}return e.prototype.processCommentEvent=function(e,t,n,o){switch(e){case aa.a.CommentsChanged:Ot.h(t)&&n((r=t,i=this.telemetryVisitor,function(e,t){var n,o,d,c,m,u=t(),p=!1,f=r.contextDetails;if(""===(null==f?void 0:f.selectedCommentId)&&(f=Object(a.__assign)(Object(a.__assign)({},f),{selectedCommentId:void 0})),e(io(Ve.a.None,i,f,Object(ye.applyCommentChanges)({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595953743),telemetryVisitor:i},r.changes))),!r.contextDetails||!r.contextDetails.selectedCommentId){var g=xe.t(u),h=g?g.selectedCardId:void 0,C=t(),v=xe.t(C);Object(l.k)().assertConditionTag(!Object(Ee.g)(u),"applyCommentChangesAndPreserveSelectionPositionThunk is not presently supported with filtering enabled",526402329);var b=xe.a(u),y=xe.a(C);if(h){if(h&&r.changes.some((function(e){return e.type===vt.a.Delete&&e.model.commentId===h}))){var T=void 0;if(Object(Ae.f)(b)){var I=xe.b(u),O=[],_=0;T=-1;for(var S=0;S<b.length;S++)O.push(_),_+=I[b[S]].length,b[S]===h&&(T=S);try{for(var j=Object(a.__values)(r.changes),k=j.next();!k.done;k=j.next())switch((w=k.value).type){case vt.a.Insert:var x=void 0;for(x=O.length-1;x>=0&&w.index<=O[x];x--)O[x]+=1;Object(tt.a)(w.model)&&(x<T&&++T,O.splice(x+1,0,w.index));break;case vt.a.Delete:var E=void 0;for(E=O.length-1;E>=0;E--){if(!(w.index<O[E])){w.index===O[E]&&(E<T&&--T,O.splice(E,1));break}O[E]-=1}break;case vt.a.Modify:case vt.a.Unknown:case vt.a.Load:break;default:Object(s.m)(w)}}catch(e){n={error:e}}finally{try{k&&!k.done&&(o=j.return)&&o.call(j)}finally{if(n)throw n.error}}}else{T=b.findIndex((function(e){return e.commentId===h}));try{for(var D=Object(a.__values)(r.changes),A=D.next();!A.done;A=D.next()){var w;switch((w=A.value).type){case vt.a.Insert:w.index<=T&&++T;break;case vt.a.Delete:w.index<T&&--T;break;case vt.a.Modify:case vt.a.Unknown:case vt.a.Load:break;default:Object(s.m)(w)}}}catch(e){d={error:e}}finally{try{A&&!A.done&&(c=D.return)&&c.call(D)}finally{if(d)throw d.error}}}if(v)throw new N.a(de.l,s.d.reserveTag(589103626),-2130957551);if(y.length){var P=T;P===y.length&&(P-=1);var R=Object(Ae.f)(y)?y[P]:Object(tt.b)(y[P]);e(Object(ye.selectComment)({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595953744),telemetryVisitor:i},R,void 0,ao.a.ExpandCard,Te.a.SharedComments)),p=!0}}}else!b.length&&y.length&&(e(Object(ye.selectComment)({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595947723),telemetryVisitor:i},Object(Ae.f)(y)?y[0]:y[0].commentId,void 0,ao.a.ExpandCard,Te.a.SharedComments)),p=!0);Object(l.k)().assertConditionTag(p||0===y.length||""!==(null===(m=r.contextDetails)||void 0===m?void 0:m.selectedCommentId),"Received empty selection from context details with existing comments and without setting selection afterwards in applyCommentChangesAndPreserveSelectionPositionThunk",590991767)}}));break;case aa.a.LoadComments:Ot.i(t)&&(o().paneState.initializationStatus!==Kt.a.Initialized&&this.lastInitializationReason===F.a.NewThread||!De.b(o())?n(uo({renderContextType:Ve.a.None,trackback:s.d.reserveTag(595899531),telemetryVisitor:this.telemetryVisitor},t,this.peopleAPI)):n(function(e,t,n,a){return function(o,r){o(uo({renderContextType:e,trackback:s.d.reserveTag(595899530),telemetryVisitor:a},t,n));var i=r();Object(l.k)().assertConditionTag(void 0===Object(Ee.g)(i),"Half pane specific logic should not run with filtering enabled.",523866629);var d=xe.p(i).virtualized,c=xe.t(i),m=xe.k(i);!Object(Oe.a)(xe.q(i),d,!!Object(Ee.g)(r()))||!m.length||c&&Object(Ie.b)(i,c.selectedCardId)||o(Object(ye.selectComment)({renderContextType:e,trackback:s.d.reserveTag(595953680),telemetryVisitor:a},Object(Ae.f)(m)?m[0]:m[0].commentId,void 0,ao.a.ExpandCard,Te.a.SharedComments))}}(Ve.a.HalfPane,t,this.peopleAPI,this.telemetryVisitor)));break;case aa.a.CommentContextReload:Ot.d(t)&&n(function(e,t,n,o){return function(r,i){var d,c,m=i(),u=!1,p=[];Object(Ot.c)(t)?(Object(l.k)().assertConditionTag(xe.p(m).virtualized,"reloadCommentsAndPreserveSelectionPositionThunk's payload should only include comment ids when state is virtualized",595162891),p=_t(t.commentIds)):p=t.comments;var f=t.contextDetails;""===(null==f?void 0:f.selectedCommentId)&&(f=Object(a.__assign)(Object(a.__assign)({},f),{selectedCommentId:void 0}));var g=Object(Ot.c)(t)?[]:t.tasks;r(io(e,o,f,Object(fo.a)({renderContextType:e,telemetryVisitor:o,trackback:s.d.reserveTag(595953677)},{comments:p,tasks:g}))),b.D()&&r(Object(co.a)({renderContextType:e,telemetryVisitor:o,trackback:s.d.reserveTag(595162892)},p,g,n)).catch(Object(j.a)(s.d.reserveTag(595645962))),Object(l.k)().assertConditionTag(!Object(Ee.g)(m),"reloadCommentsAndPreserveSelectionPositionThunk is not presently supported with filtering enabled",526402328);var h=null===(d=xe.t(m))||void 0===d?void 0:d.selectedCardId,C=xe.a(m),v=i(),y=xe.a(v);if(h){if(!xe.t(v)){var T=Object(Ae.f)(C)?C.findIndex((function(e){return e===h})):C.findIndex((function(e){return e.commentId===h}));if(T<0)return;if(y.length){var I=T;I===y.length&&(I-=1);var O=Object(Ae.f)(y)?y[I]:Object(tt.b)(y[I]);r(Object(ye.selectComment)({renderContextType:e,telemetryVisitor:o,trackback:s.d.reserveTag(595953678)},O,void 0,ao.a.ExpandCard,Te.a.SharedComments)),u=!0}}}else!C.length&&y.length&&(r(Object(ye.selectComment)({renderContextType:e,telemetryVisitor:o,trackback:s.d.reserveTag(595947722)},Object(Ae.f)(y)?y[0]:y[0].commentId,void 0,ao.a.ExpandCard,Te.a.SharedComments)),u=!0);Object(l.k)().assertConditionTag(u||0===y.length||""!==(null===(c=t.contextDetails)||void 0===c?void 0:c.selectedCommentId),"Received empty selection from context details with existing comments and without setting selection afterwards in reloadCommentsAndPreserveSelectionPositionThunk",590991766)}}(Ve.a.HalfPane,t,this.peopleAPI,this.telemetryVisitor))}var r,i;this.commonViewStrategy.processCommentEvent(e,t,n,o)},e.prototype.processCommentUIAction=function(e,t,n){return this.commonViewStrategy.processCommentUIAction(e,t,n,{retainSelectionOnAddComment:!0})},e.prototype.handleCommentInterruptableCommand=function(e,t,n){return this.commonViewStrategy.handleCommentInterruptableCommand(e,t,n)},e}(),ho=function(){function e(){}return e.prototype.createViewStrategy=function(e,t,n,a,o,r,i,s){var d=new $a(t,n,a,o,s);switch(e.containerType){case V.a.HalfPane:return new go(d,n,i,s);case V.a.FullPane:return new po(d,n,r,s)}},e}();function Co(e){if(void 0===e.hostCommentAPI)throw new N.a("'hostCommentAPI' was not supplied",s.d.reserveTag(589103634),-2130957511);if(void 0===e.peopleAPI)throw new N.a("'peopleAPI' was not supplied",s.d.reserveTag(589103635),-2130957511);if(void 0===e.viewContainerProvider)throw new N.a("'viewContainerProvider' was not supplied",s.d.reserveTag(589103636),-2130957511);var t=Object(D.g)(e.apiContext)?Object(D.f)(e.apiContext):void 0,n=Object(E.f)(e.apiContext)?Object(E.e)(e.apiContext):void 0,o=Object(g.b)(),r=e.themeAPI||new ge,i=new ue(e.hostCommentAPI),d=B.getTelemetryVisitor(e.apiContext),c=new lt(o.getLocaleInfo().isRightToLeft,d),l=new Ua(e.peopleAPI,d,e.correlationId||"");b.w()&&l.initializeController(!1);var m=function(e,t,n,o,r,i,s,d,c){var l=c?[Object(Vn.b)(c,o)]:[],m=Object(mt.compose)(mt.applyMiddleware.apply(void 0,Object(a.__spreadArray)([ft,pt,ut.default,Rn,qn(o),yn(e,o),xn(o),Nn(s),Zn(0,d),Ln(i),Sn(o),jn(r)],Object(a.__read)(l),!1))),u=Object(mt.createStore)(pn,n,m);return s.initialize(u,!!r),u}(i,e.viewContainerProvider,rn(e.viewContainerProvider.getViewContainer(),e.paneVisible,o.getLocaleInfo(),e.apiContext),B.getTelemetryVisitor(e.apiContext),t,o,c,l,n);return new Ha({apiContext:e.apiContext,viewProvider:e.viewContainerProvider,commentAPI:i,peopleAPI:e.peopleAPI,localizationAPI:o,themeAPI:r,focusManager:c,lppManager:l,initializationReason:e.initializationReason,commentStore:m,viewStrategyFactory:new ho,initializeImmediately:e.initializeImmediately,mockUIDriver:e.mockDriver,contentNavigationAPI:t,contentFilteredRangeAPI:n})}function vo(e,t,n,a,o,r,u,f,y){try{try{if(re())return void Object(l.k)().assertConditionTag(!1,"View manager singleton cannot be instantiated more than once!",595891844)}catch(e){if(!Object(N.b)(e))throw e}U=Co;var T=[];Object(c.d)()?T.push([!u,"App settings should not be passed in when feature gate API is already initialized. Please inspect feature gate initialization on host.",s.d.reserveTag(527754333)]):(T.push([!!u,"Must initialize feature gate API but no appSettings passed to instantiate.",s.d.reserveTag(527754332)]),Object(c.c)({appSettings:null!=u?u:{},mapping:ne.a})),Object(l.k)().hasBeenInitialized()?Object(l.k)().assertConditionTag(!t,"Telemetry details should not be passed in if telemetry API is already initialized. Please inspect telemetry API initialization on host.",527754334):Object(l.m)(oe.a,t),T.forEach((function(e){Object(l.k)().assertConditionTag(e[0],e[1],e[2])})),Object(l.k)().assertConditionTag(!!u,"appSettings should not be undefined",595616278);var I=function(){var t=Object(g.c)(o);Object(m.c)(t.getLocaleInfo().isRightToLeft),Object(ae.b)();var s,c=(s=i.a,new Y(s,a));B.ensureViewManager({apiContext:i.a,displayMode:v.b.FullPane,foldableLayoutState:v.a.Indeterminate,initializationReason:r||F.a.PaneOpen,correlationId:Object(d.a)(),viewContainerProvider:c,peopleAPI:n,hostCommentAPI:e,paneVisible:!1,initializeImmediately:!1}),Object(h.c)(f),b.N()&&y&&C.a.setThemeAPI(y),Z(),Object(p.g)().onExtensionFirstRequested.subscribe((function(e){e.contentType===p.b.CommentThread&&e.instanceId===p.c&&ie()}))};b.R()?Object(te.b)().then((function(){I()})).catch((function(e){return Object(j.a)(s.d.reserveTag(526254819))(e)})):I()}catch(e){throw Object(j.a)(s.d.reserveTag(594367139))(e),e}}Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),n=t.length,a=new Array(n);n--;)a[n]=[t[n],e[t[n]]];return a}),String.prototype.includes||(String.prototype.includes=function(e,t){if(e instanceof RegExp)throw TypeError("first argument must not be a RegExp");return-1!==this.indexOf(e,void 0===t?0:t)}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var bo,yo=n(82),To=n(2522),Io=function(){function e(e){this.getDarkModeColor=e,this.darkToLightColorMap=new Map}return e.prototype.getThemeMode=function(){return To.b.getInstance().getThemeMode()},e.prototype.registerOnThemeChanged=function(e){To.b.getInstance().registerOnThemeChanged(e)},e.prototype.convertColorForTheme=function(e,t){var n;if(!this.getDarkModeColor)return e;if(1===t){var a=this.getDarkModeColor(e);return this.darkToLightColorMap.set(a,e),a}return null!==(n=this.darkToLightColorMap.get(e))&&void 0!==n?n:e},e}();function Oo(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];vo.apply(void 0,Object(a.__spreadArray)(Object(a.__spreadArray)([],e,!1),[Object(yo.a)(),new Io(bo)],!1))}function _o(e){bo=e}},373:function(e,t,n){var a=n(374),o=n(236),r=n(641),i=n(1646),s=n(994),d=function(e,t,n){var c,l,m,u,p=e&d.F,f=e&d.G,g=e&d.S,h=e&d.P,C=e&d.B,v=f?a:g?a[t]||(a[t]={}):(a[t]||{}).prototype,b=f?o:o[t]||(o[t]={}),y=b.prototype||(b.prototype={});for(c in f&&(n=t),n)m=((l=!p&&v&&void 0!==v[c])?v:n)[c],u=C&&l?s(m,a):h&&"function"==typeof m?s(Function.call,m):m,v&&i(v,c,m,e&d.U),b[c]!=m&&r(b,c,u),h&&y[c]!=m&&(y[c]=m)};a.core=o,d.F=1,d.G=2,d.S=4,d.P=8,d.B=16,d.W=32,d.U=64,d.R=128,e.exports=d},374:function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},470:function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},471:function(e,t,n){e.exports=!n(472)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},472:function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},641:function(e,t,n){var a=n(1640),o=n(1645);e.exports=n(471)?function(e,t,n){return a.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},642:function(e,t){var n=0,a=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+a).toString(36))}},643:function(e,t,n){var a=n(236),o=n(374),r=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:a.version,mode:n(1648)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},644:function(e,t,n){var a=n(997);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==a(e)?e.split(""):Object(e)}},645:function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},646:function(e,t,n){var a=n(1e3)("unscopables"),o=Array.prototype;null==o[a]&&n(641)(o,a,{}),e.exports=function(e){o[a][e]=!0}},993:function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},994:function(e,t,n){var a=n(1649);e.exports=function(e,t,n){if(a(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,a){return e.call(t,n,a)};case 3:return function(n,a,o){return e.call(t,n,a,o)}}return function(){return e.apply(t,arguments)}}},995:function(e,t,n){var a=n(996),o=n(998),r=n(1650);e.exports=function(e){return function(t,n,i){var s,d=a(t),c=o(d.length),l=r(i,c);if(e&&n!=n){for(;c>l;)if((s=d[l++])!=s)return!0}else for(;c>l;l++)if((e||l in d)&&d[l]===n)return e||l||0;return!e&&-1}}},996:function(e,t,n){var a=n(644),o=n(645);e.exports=function(e){return a(o(e))}},997:function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},998:function(e,t,n){var a=n(999),o=Math.min;e.exports=function(e){return e>0?o(a(e),9007199254740991):0}},999:function(e,t){var n=Math.ceil,a=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?a:n)(e)}}}]);
//# sourceMappingURL=sharedComments.min.js.map